(function(j,J){typeof exports=="object"&&typeof module<"u"?J(exports):typeof define=="function"&&define.amd?define(["exports"],J):(j=typeof globalThis<"u"?globalThis:j||self,J(j["[name]"]={}))})(this,function(j){"use strict";var Wx=Object.defineProperty;var Xx=(j,J,Kt)=>J in j?Wx(j,J,{enumerable:!0,configurable:!0,writable:!0,value:Kt}):j[J]=Kt;var Jt=(j,J,Kt)=>(Xx(j,typeof J!="symbol"?J+"":J,Kt),Kt);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const J="165",Xr="",zt="srgb",Os="srgb-linear",Pa="display-p3",Yr="display-p3-linear",$s="linear",Zr="srgb",Jr="rec709",Kr="p3";class We{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const n=r.indexOf(e);n!==-1&&r.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const r=s.slice(0);for(let n=0,a=r.length;n<a;n++)r[n].call(this,t);t.target=null}}}const q=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Qt(){const i=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(q[i&255]+q[i>>8&255]+q[i>>16&255]+q[i>>24&255]+"-"+q[t&255]+q[t>>8&255]+"-"+q[t>>16&15|64]+q[t>>24&255]+"-"+q[e&63|128]+q[e>>8&255]+"-"+q[e>>16&255]+q[e>>24&255]+q[s&255]+q[s>>8&255]+q[s>>16&255]+q[s>>24&255]).toLowerCase()}function U(i,t,e){return Math.max(t,Math.min(e,i))}function za(i,t){return(i%t+t)%t}function Rs(i,t,e){return(1-e)*i+e*t}function Se(i,t){switch(t.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function K(i,t){switch(t.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}class k{constructor(t=0,e=0){k.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,r=t.elements;return this.x=r[0]*e+r[3]*s+r[6],this.y=r[1]*e+r[4]*s+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(U(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),r=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*s-a*r+t.x,this.y=n*r+a*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class gt{constructor(t,e,s,r,n,a,o,h,c){gt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,r,n,a,o,h,c)}set(t,e,s,r,n,a,o,h,c){const l=this.elements;return l[0]=t,l[1]=r,l[2]=o,l[3]=e,l[4]=n,l[5]=h,l[6]=s,l[7]=a,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,r=e.elements,n=this.elements,a=s[0],o=s[3],h=s[6],c=s[1],l=s[4],u=s[7],f=s[2],p=s[5],d=s[8],m=r[0],x=r[3],y=r[6],_=r[1],b=r[4],w=r[7],A=r[2],M=r[5],v=r[8];return n[0]=a*m+o*_+h*A,n[3]=a*x+o*b+h*M,n[6]=a*y+o*w+h*v,n[1]=c*m+l*_+u*A,n[4]=c*x+l*b+u*M,n[7]=c*y+l*w+u*v,n[2]=f*m+p*_+d*A,n[5]=f*x+p*b+d*M,n[8]=f*y+p*w+d*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],c=t[7],l=t[8];return e*a*l-e*o*c-s*n*l+s*o*h+r*n*c-r*a*h}invert(){const t=this.elements,e=t[0],s=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],c=t[7],l=t[8],u=l*a-o*c,f=o*h-l*n,p=c*n-a*h,d=e*u+s*f+r*p;if(d===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/d;return t[0]=u*m,t[1]=(r*c-l*s)*m,t[2]=(o*s-r*a)*m,t[3]=f*m,t[4]=(l*e-r*h)*m,t[5]=(r*n-o*e)*m,t[6]=p*m,t[7]=(s*h-c*e)*m,t[8]=(a*e-s*n)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,r,n,a,o){const h=Math.cos(n),c=Math.sin(n);return this.set(s*h,s*c,-s*(h*a+c*o)+a+t,-r*c,r*h,-r*(-c*a+h*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ns.makeScale(t,e)),this}rotate(t){return this.premultiply(Ns.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ns.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let r=0;r<9;r++)if(e[r]!==s[r])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ns=new gt;function Ca(i){for(let t=i.length-1;t>=0;--t)if(i[t]>=65535)return!0;return!1}function Qr(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}const ti={};function Ba(i){i in ti||(ti[i]=!0,console.warn(i))}const ei=new gt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),si=new gt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Xe={[Os]:{transfer:$s,primaries:Jr,toReference:i=>i,fromReference:i=>i},[zt]:{transfer:Zr,primaries:Jr,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[Yr]:{transfer:$s,primaries:Kr,toReference:i=>i.applyMatrix3(si),fromReference:i=>i.applyMatrix3(ei)},[Pa]:{transfer:Zr,primaries:Kr,toReference:i=>i.convertSRGBToLinear().applyMatrix3(si),fromReference:i=>i.applyMatrix3(ei).convertLinearToSRGB()}},Da=new Set([Os,Yr]),ct={enabled:!0,_workingColorSpace:Os,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!Da.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,t,e){if(this.enabled===!1||t===e||!t||!e)return i;const s=Xe[t].toReference,r=Xe[e].fromReference;return r(s(i))},fromWorkingColorSpace:function(i,t){return this.convert(i,this._workingColorSpace,t)},toWorkingColorSpace:function(i,t){return this.convert(i,t,this._workingColorSpace)},getPrimaries:function(i){return Xe[i].primaries},getTransfer:function(i){return i===Xr?$s:Xe[i].transfer}};function te(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Hs(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let ee;class Ia{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ee===void 0&&(ee=Qr("canvas")),ee.width=t.width,ee.height=t.height;const s=ee.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=ee}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Qr("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const r=s.getImageData(0,0,t.width,t.height),n=r.data;for(let a=0;a<n.length;a++)n[a]=te(n[a]/255)*255;return s.putImageData(r,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(te(e[s]/255)*255):e[s]=te(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let La=0;class Oa{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:La++}),this.uuid=Qt(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let a=0,o=r.length;a<o;a++)r[a].isDataTexture?n.push(Vs(r[a].image)):n.push(Vs(r[a]))}else n=Vs(r);s.url=n}return e||(t.images[this.uuid]=s),s}}function Vs(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?Ia.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let $a=0;class Ct extends We{constructor(t=Ct.DEFAULT_IMAGE,e=Ct.DEFAULT_MAPPING,s=1001,r=1001,n=1006,a=1008,o=1023,h=1009,c=Ct.DEFAULT_ANISOTROPY,l=Xr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:$a++}),this.uuid=Qt(),this.name="",this.source=new Oa(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=r,this.magFilter=n,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=h,this.offset=new k(0,0),this.repeat=new k(1,1),this.center=new k(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==300)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ct.DEFAULT_IMAGE=null,Ct.DEFAULT_MAPPING=300,Ct.DEFAULT_ANISOTROPY=1;let Vt=class{constructor(t=0,e=0,s=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=r}static slerpFlat(t,e,s,r,n,a,o){let h=s[r+0],c=s[r+1],l=s[r+2],u=s[r+3];const f=n[a+0],p=n[a+1],d=n[a+2],m=n[a+3];if(o===0){t[e+0]=h,t[e+1]=c,t[e+2]=l,t[e+3]=u;return}if(o===1){t[e+0]=f,t[e+1]=p,t[e+2]=d,t[e+3]=m;return}if(u!==m||h!==f||c!==p||l!==d){let x=1-o;const y=h*f+c*p+l*d+u*m,_=y>=0?1:-1,b=1-y*y;if(b>Number.EPSILON){const A=Math.sqrt(b),M=Math.atan2(A,y*_);x=Math.sin(x*M)/A,o=Math.sin(o*M)/A}const w=o*_;if(h=h*x+f*w,c=c*x+p*w,l=l*x+d*w,u=u*x+m*w,x===1-o){const A=1/Math.sqrt(h*h+c*c+l*l+u*u);h*=A,c*=A,l*=A,u*=A}}t[e]=h,t[e+1]=c,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,s,r,n,a){const o=s[r],h=s[r+1],c=s[r+2],l=s[r+3],u=n[a],f=n[a+1],p=n[a+2],d=n[a+3];return t[e]=o*d+l*u+h*p-c*f,t[e+1]=h*d+l*f+c*u-o*p,t[e+2]=c*d+l*p+o*f-h*u,t[e+3]=l*d-o*u-h*f-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,r){return this._x=t,this._y=e,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,r=t._y,n=t._z,a=t._order,o=Math.cos,h=Math.sin,c=o(s/2),l=o(r/2),u=o(n/2),f=h(s/2),p=h(r/2),d=h(n/2);switch(a){case"XYZ":this._x=f*l*u+c*p*d,this._y=c*p*u-f*l*d,this._z=c*l*d+f*p*u,this._w=c*l*u-f*p*d;break;case"YXZ":this._x=f*l*u+c*p*d,this._y=c*p*u-f*l*d,this._z=c*l*d-f*p*u,this._w=c*l*u+f*p*d;break;case"ZXY":this._x=f*l*u-c*p*d,this._y=c*p*u+f*l*d,this._z=c*l*d+f*p*u,this._w=c*l*u-f*p*d;break;case"ZYX":this._x=f*l*u-c*p*d,this._y=c*p*u+f*l*d,this._z=c*l*d-f*p*u,this._w=c*l*u+f*p*d;break;case"YZX":this._x=f*l*u+c*p*d,this._y=c*p*u+f*l*d,this._z=c*l*d-f*p*u,this._w=c*l*u-f*p*d;break;case"XZY":this._x=f*l*u-c*p*d,this._y=c*p*u-f*l*d,this._z=c*l*d+f*p*u,this._w=c*l*u+f*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,r=Math.sin(s);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],r=e[4],n=e[8],a=e[1],o=e[5],h=e[9],c=e[2],l=e[6],u=e[10],f=s+o+u;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(l-h)*p,this._y=(n-c)*p,this._z=(a-r)*p}else if(s>o&&s>u){const p=2*Math.sqrt(1+s-o-u);this._w=(l-h)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(n+c)/p}else if(o>u){const p=2*Math.sqrt(1+o-s-u);this._w=(n-c)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(h+l)/p}else{const p=2*Math.sqrt(1+u-s-o);this._w=(a-r)/p,this._x=(n+c)/p,this._y=(h+l)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(U(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const r=Math.min(1,e/s);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,r=t._y,n=t._z,a=t._w,o=e._x,h=e._y,c=e._z,l=e._w;return this._x=s*l+a*o+r*c-n*h,this._y=r*l+a*h+n*o-s*c,this._z=n*l+a*c+s*h-r*o,this._w=a*l-s*o-r*h-n*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,r=this._y,n=this._z,a=this._w;let o=a*t._w+s*t._x+r*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=s,this._y=r,this._z=n,this;const h=1-o*o;if(h<=Number.EPSILON){const p=1-e;return this._w=p*a+e*this._w,this._x=p*s+e*this._x,this._y=p*r+e*this._y,this._z=p*n+e*this._z,this.normalize(),this}const c=Math.sqrt(h),l=Math.atan2(c,o),u=Math.sin((1-e)*l)/c,f=Math.sin(e*l)/c;return this._w=a*u+this._w*f,this._x=s*u+this._x*f,this._y=r*u+this._y*f,this._z=n*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),r=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(r*Math.sin(t),r*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class g{constructor(t=0,e=0,s=0){g.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ri.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ri.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*r,this.y=n[1]*e+n[4]*s+n[7]*r,this.z=n[2]*e+n[5]*s+n[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,r=this.z,n=t.elements,a=1/(n[3]*e+n[7]*s+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*r+n[12])*a,this.y=(n[1]*e+n[5]*s+n[9]*r+n[13])*a,this.z=(n[2]*e+n[6]*s+n[10]*r+n[14])*a,this}applyQuaternion(t){const e=this.x,s=this.y,r=this.z,n=t.x,a=t.y,o=t.z,h=t.w,c=2*(a*r-o*s),l=2*(o*e-n*r),u=2*(n*s-a*e);return this.x=e+h*c+a*u-o*l,this.y=s+h*l+o*c-n*u,this.z=r+h*u+n*l-a*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*r,this.y=n[1]*e+n[5]*s+n[9]*r,this.z=n[2]*e+n[6]*s+n[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,r=t.y,n=t.z,a=e.x,o=e.y,h=e.z;return this.x=r*h-n*o,this.y=n*a-s*h,this.z=s*o-r*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return js.copy(this).projectOnVector(t),this.sub(js)}reflect(t){return this.sub(js.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(U(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,r=this.z-t.z;return e*e+s*s+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const r=Math.sin(e)*t;return this.x=r*Math.sin(s),this.y=Math.cos(e)*t,this.z=r*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const js=new g,ri=new Vt;let bt=class{constructor(t=new g(1/0,1/0,1/0),e=new g(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(lt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(lt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=lt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(s!==void 0){const n=s.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=n.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,lt):lt.fromBufferAttribute(n,a),lt.applyMatrix4(t.matrixWorld),this.expandByPoint(lt);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Ye.copy(t.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),Ye.copy(s.boundingBox)),Ye.applyMatrix4(t.matrixWorld),this.union(Ye)}const r=t.children;for(let n=0,a=r.length;n<a;n++)this.expandByObject(r[n],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,lt),lt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ke),Ze.subVectors(this.max,ke),se.subVectors(t.a,ke),re.subVectors(t.b,ke),ie.subVectors(t.c,ke),Bt.subVectors(re,se),Dt.subVectors(ie,re),jt.subVectors(se,ie);let e=[0,-Bt.z,Bt.y,0,-Dt.z,Dt.y,0,-jt.z,jt.y,Bt.z,0,-Bt.x,Dt.z,0,-Dt.x,jt.z,0,-jt.x,-Bt.y,Bt.x,0,-Dt.y,Dt.x,0,-jt.y,jt.x,0];return!qs(e,se,re,ie,Ze)||(e=[1,0,0,0,1,0,0,0,1],!qs(e,se,re,ie,Ze))?!1:(Je.crossVectors(Bt,Dt),e=[Je.x,Je.y,Je.z],qs(e,se,re,ie,Ze))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,lt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(lt).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_t),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};const _t=[new g,new g,new g,new g,new g,new g,new g,new g],lt=new g,Ye=new bt,se=new g,re=new g,ie=new g,Bt=new g,Dt=new g,jt=new g,ke=new g,Ze=new g,Je=new g,qt=new g;function qs(i,t,e,s,r){for(let n=0,a=i.length-3;n<=a;n+=3){qt.fromArray(i,n);const o=r.x*Math.abs(qt.x)+r.y*Math.abs(qt.y)+r.z*Math.abs(qt.z),h=t.dot(qt),c=e.dot(qt),l=s.dot(qt);if(Math.max(-Math.max(h,c,l),Math.min(h,c,l))>o)return!1}return!0}const Ra=new bt,Fe=new g,Us=new g;class Gs{constructor(t=new g,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):Ra.setFromPoints(t).getCenter(s);let r=0;for(let n=0,a=t.length;n<a;n++)r=Math.max(r,s.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Fe.subVectors(t,this.center);const e=Fe.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),r=(s-this.radius)*.5;this.center.addScaledVector(Fe,r/s),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Us.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Fe.copy(t.center).add(Us)),this.expandByPoint(Fe.copy(t.center).sub(Us))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const wt=new g,Ws=new g,Ke=new g,It=new g,Xs=new g,Qe=new g,Ys=new g;class Zs{constructor(t=new g,e=new g(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,wt)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=wt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(wt.copy(this.origin).addScaledVector(this.direction,e),wt.distanceToSquared(t))}distanceSqToSegment(t,e,s,r){Ws.copy(t).add(e).multiplyScalar(.5),Ke.copy(e).sub(t).normalize(),It.copy(this.origin).sub(Ws);const n=t.distanceTo(e)*.5,a=-this.direction.dot(Ke),o=It.dot(this.direction),h=-It.dot(Ke),c=It.lengthSq(),l=Math.abs(1-a*a);let u,f,p,d;if(l>0)if(u=a*h-o,f=a*o-h,d=n*l,u>=0)if(f>=-d)if(f<=d){const m=1/l;u*=m,f*=m,p=u*(u+a*f+2*o)+f*(a*u+f+2*h)+c}else f=n,u=Math.max(0,-(a*f+o)),p=-u*u+f*(f+2*h)+c;else f=-n,u=Math.max(0,-(a*f+o)),p=-u*u+f*(f+2*h)+c;else f<=-d?(u=Math.max(0,-(-a*n+o)),f=u>0?-n:Math.min(Math.max(-n,-h),n),p=-u*u+f*(f+2*h)+c):f<=d?(u=0,f=Math.min(Math.max(-n,-h),n),p=f*(f+2*h)+c):(u=Math.max(0,-(a*n+o)),f=u>0?n:Math.min(Math.max(-n,-h),n),p=-u*u+f*(f+2*h)+c);else f=a>0?-n:n,u=Math.max(0,-(a*f+o)),p=-u*u+f*(f+2*h)+c;return s&&s.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(Ws).addScaledVector(Ke,f),p}intersectSphere(t,e){wt.subVectors(t.center,this.origin);const s=wt.dot(this.direction),r=wt.dot(wt)-s*s,n=t.radius*t.radius;if(r>n)return null;const a=Math.sqrt(n-r),o=s-a,h=s+a;return h<0?null:o<0?this.at(h,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,r,n,a,o,h;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,f=this.origin;return c>=0?(s=(t.min.x-f.x)*c,r=(t.max.x-f.x)*c):(s=(t.max.x-f.x)*c,r=(t.min.x-f.x)*c),l>=0?(n=(t.min.y-f.y)*l,a=(t.max.y-f.y)*l):(n=(t.max.y-f.y)*l,a=(t.min.y-f.y)*l),s>a||n>r||((n>s||isNaN(s))&&(s=n),(a<r||isNaN(r))&&(r=a),u>=0?(o=(t.min.z-f.z)*u,h=(t.max.z-f.z)*u):(o=(t.max.z-f.z)*u,h=(t.min.z-f.z)*u),s>h||o>r)||((o>s||s!==s)&&(s=o),(h<r||r!==r)&&(r=h),r<0)?null:this.at(s>=0?s:r,e)}intersectsBox(t){return this.intersectBox(t,wt)!==null}intersectTriangle(t,e,s,r,n){Xs.subVectors(e,t),Qe.subVectors(s,t),Ys.crossVectors(Xs,Qe);let a=this.direction.dot(Ys),o;if(a>0){if(r)return null;o=1}else if(a<0)o=-1,a=-a;else return null;It.subVectors(this.origin,t);const h=o*this.direction.dot(Qe.crossVectors(It,Qe));if(h<0)return null;const c=o*this.direction.dot(Xs.cross(It));if(c<0||h+c>a)return null;const l=-o*It.dot(Ys);return l<0?null:this.at(l/a,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Q{constructor(t,e,s,r,n,a,o,h,c,l,u,f,p,d,m,x){Q.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,r,n,a,o,h,c,l,u,f,p,d,m,x)}set(t,e,s,r,n,a,o,h,c,l,u,f,p,d,m,x){const y=this.elements;return y[0]=t,y[4]=e,y[8]=s,y[12]=r,y[1]=n,y[5]=a,y[9]=o,y[13]=h,y[2]=c,y[6]=l,y[10]=u,y[14]=f,y[3]=p,y[7]=d,y[11]=m,y[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Q().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,r=1/ne.setFromMatrixColumn(t,0).length(),n=1/ne.setFromMatrixColumn(t,1).length(),a=1/ne.setFromMatrixColumn(t,2).length();return e[0]=s[0]*r,e[1]=s[1]*r,e[2]=s[2]*r,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*a,e[9]=s[9]*a,e[10]=s[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,r=t.y,n=t.z,a=Math.cos(s),o=Math.sin(s),h=Math.cos(r),c=Math.sin(r),l=Math.cos(n),u=Math.sin(n);if(t.order==="XYZ"){const f=a*l,p=a*u,d=o*l,m=o*u;e[0]=h*l,e[4]=-h*u,e[8]=c,e[1]=p+d*c,e[5]=f-m*c,e[9]=-o*h,e[2]=m-f*c,e[6]=d+p*c,e[10]=a*h}else if(t.order==="YXZ"){const f=h*l,p=h*u,d=c*l,m=c*u;e[0]=f+m*o,e[4]=d*o-p,e[8]=a*c,e[1]=a*u,e[5]=a*l,e[9]=-o,e[2]=p*o-d,e[6]=m+f*o,e[10]=a*h}else if(t.order==="ZXY"){const f=h*l,p=h*u,d=c*l,m=c*u;e[0]=f-m*o,e[4]=-a*u,e[8]=d+p*o,e[1]=p+d*o,e[5]=a*l,e[9]=m-f*o,e[2]=-a*c,e[6]=o,e[10]=a*h}else if(t.order==="ZYX"){const f=a*l,p=a*u,d=o*l,m=o*u;e[0]=h*l,e[4]=d*c-p,e[8]=f*c+m,e[1]=h*u,e[5]=m*c+f,e[9]=p*c-d,e[2]=-c,e[6]=o*h,e[10]=a*h}else if(t.order==="YZX"){const f=a*h,p=a*c,d=o*h,m=o*c;e[0]=h*l,e[4]=m-f*u,e[8]=d*u+p,e[1]=u,e[5]=a*l,e[9]=-o*l,e[2]=-c*l,e[6]=p*u+d,e[10]=f-m*u}else if(t.order==="XZY"){const f=a*h,p=a*c,d=o*h,m=o*c;e[0]=h*l,e[4]=-u,e[8]=c*l,e[1]=f*u+m,e[5]=a*l,e[9]=p*u-d,e[2]=d*u-p,e[6]=o*l,e[10]=m*u+f}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Na,t,Ha)}lookAt(t,e,s){const r=this.elements;return tt.subVectors(t,e),tt.lengthSq()===0&&(tt.z=1),tt.normalize(),Lt.crossVectors(s,tt),Lt.lengthSq()===0&&(Math.abs(s.z)===1?tt.x+=1e-4:tt.z+=1e-4,tt.normalize(),Lt.crossVectors(s,tt)),Lt.normalize(),ts.crossVectors(tt,Lt),r[0]=Lt.x,r[4]=ts.x,r[8]=tt.x,r[1]=Lt.y,r[5]=ts.y,r[9]=tt.y,r[2]=Lt.z,r[6]=ts.z,r[10]=tt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,r=e.elements,n=this.elements,a=s[0],o=s[4],h=s[8],c=s[12],l=s[1],u=s[5],f=s[9],p=s[13],d=s[2],m=s[6],x=s[10],y=s[14],_=s[3],b=s[7],w=s[11],A=s[15],M=r[0],v=r[4],S=r[8],F=r[12],T=r[1],C=r[5],rt=r[9],I=r[13],it=r[2],yt=r[6],Me=r[10],Zt=r[14],Ht=r[3],V=r[7],W=r[11],nt=r[15];return n[0]=a*M+o*T+h*it+c*Ht,n[4]=a*v+o*C+h*yt+c*V,n[8]=a*S+o*rt+h*Me+c*W,n[12]=a*F+o*I+h*Zt+c*nt,n[1]=l*M+u*T+f*it+p*Ht,n[5]=l*v+u*C+f*yt+p*V,n[9]=l*S+u*rt+f*Me+p*W,n[13]=l*F+u*I+f*Zt+p*nt,n[2]=d*M+m*T+x*it+y*Ht,n[6]=d*v+m*C+x*yt+y*V,n[10]=d*S+m*rt+x*Me+y*W,n[14]=d*F+m*I+x*Zt+y*nt,n[3]=_*M+b*T+w*it+A*Ht,n[7]=_*v+b*C+w*yt+A*V,n[11]=_*S+b*rt+w*Me+A*W,n[15]=_*F+b*I+w*Zt+A*nt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],r=t[8],n=t[12],a=t[1],o=t[5],h=t[9],c=t[13],l=t[2],u=t[6],f=t[10],p=t[14],d=t[3],m=t[7],x=t[11],y=t[15];return d*(+n*h*u-r*c*u-n*o*f+s*c*f+r*o*p-s*h*p)+m*(+e*h*p-e*c*f+n*a*f-r*a*p+r*c*l-n*h*l)+x*(+e*c*u-e*o*p-n*a*u+s*a*p+n*o*l-s*c*l)+y*(-r*o*l-e*h*u+e*o*f+r*a*u-s*a*f+s*h*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],c=t[7],l=t[8],u=t[9],f=t[10],p=t[11],d=t[12],m=t[13],x=t[14],y=t[15],_=u*x*c-m*f*c+m*h*p-o*x*p-u*h*y+o*f*y,b=d*f*c-l*x*c-d*h*p+a*x*p+l*h*y-a*f*y,w=l*m*c-d*u*c+d*o*p-a*m*p-l*o*y+a*u*y,A=d*u*h-l*m*h-d*o*f+a*m*f+l*o*x-a*u*x,M=e*_+s*b+r*w+n*A;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/M;return t[0]=_*v,t[1]=(m*f*n-u*x*n-m*r*p+s*x*p+u*r*y-s*f*y)*v,t[2]=(o*x*n-m*h*n+m*r*c-s*x*c-o*r*y+s*h*y)*v,t[3]=(u*h*n-o*f*n-u*r*c+s*f*c+o*r*p-s*h*p)*v,t[4]=b*v,t[5]=(l*x*n-d*f*n+d*r*p-e*x*p-l*r*y+e*f*y)*v,t[6]=(d*h*n-a*x*n-d*r*c+e*x*c+a*r*y-e*h*y)*v,t[7]=(a*f*n-l*h*n+l*r*c-e*f*c-a*r*p+e*h*p)*v,t[8]=w*v,t[9]=(d*u*n-l*m*n-d*s*p+e*m*p+l*s*y-e*u*y)*v,t[10]=(a*m*n-d*o*n+d*s*c-e*m*c-a*s*y+e*o*y)*v,t[11]=(l*o*n-a*u*n-l*s*c+e*u*c+a*s*p-e*o*p)*v,t[12]=A*v,t[13]=(l*m*r-d*u*r+d*s*f-e*m*f-l*s*x+e*u*x)*v,t[14]=(d*o*r-a*m*r-d*s*h+e*m*h+a*s*x-e*o*x)*v,t[15]=(a*u*r-l*o*r+l*s*h-e*u*h-a*s*f+e*o*f)*v,this}scale(t){const e=this.elements,s=t.x,r=t.y,n=t.z;return e[0]*=s,e[4]*=r,e[8]*=n,e[1]*=s,e[5]*=r,e[9]*=n,e[2]*=s,e[6]*=r,e[10]*=n,e[3]*=s,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,r))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),r=Math.sin(e),n=1-s,a=t.x,o=t.y,h=t.z,c=n*a,l=n*o;return this.set(c*a+s,c*o-r*h,c*h+r*o,0,c*o+r*h,l*o+s,l*h-r*a,0,c*h-r*o,l*h+r*a,n*h*h+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,r,n,a){return this.set(1,s,n,0,t,1,a,0,e,r,1,0,0,0,0,1),this}compose(t,e,s){const r=this.elements,n=e._x,a=e._y,o=e._z,h=e._w,c=n+n,l=a+a,u=o+o,f=n*c,p=n*l,d=n*u,m=a*l,x=a*u,y=o*u,_=h*c,b=h*l,w=h*u,A=s.x,M=s.y,v=s.z;return r[0]=(1-(m+y))*A,r[1]=(p+w)*A,r[2]=(d-b)*A,r[3]=0,r[4]=(p-w)*M,r[5]=(1-(f+y))*M,r[6]=(x+_)*M,r[7]=0,r[8]=(d+b)*v,r[9]=(x-_)*v,r[10]=(1-(f+m))*v,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,s){const r=this.elements;let n=ne.set(r[0],r[1],r[2]).length();const a=ne.set(r[4],r[5],r[6]).length(),o=ne.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],ut.copy(this);const c=1/n,l=1/a,u=1/o;return ut.elements[0]*=c,ut.elements[1]*=c,ut.elements[2]*=c,ut.elements[4]*=l,ut.elements[5]*=l,ut.elements[6]*=l,ut.elements[8]*=u,ut.elements[9]*=u,ut.elements[10]*=u,e.setFromRotationMatrix(ut),s.x=n,s.y=a,s.z=o,this}makePerspective(t,e,s,r,n,a,o=2e3){const h=this.elements,c=2*n/(e-t),l=2*n/(s-r),u=(e+t)/(e-t),f=(s+r)/(s-r);let p,d;if(o===2e3)p=-(a+n)/(a-n),d=-2*a*n/(a-n);else if(o===2001)p=-a/(a-n),d=-a*n/(a-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return h[0]=c,h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=l,h[9]=f,h[13]=0,h[2]=0,h[6]=0,h[10]=p,h[14]=d,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,s,r,n,a,o=2e3){const h=this.elements,c=1/(e-t),l=1/(s-r),u=1/(a-n),f=(e+t)*c,p=(s+r)*l;let d,m;if(o===2e3)d=(a+n)*u,m=-2*u;else if(o===2001)d=n*u,m=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return h[0]=2*c,h[4]=0,h[8]=0,h[12]=-f,h[1]=0,h[5]=2*l,h[9]=0,h[13]=-p,h[2]=0,h[6]=0,h[10]=m,h[14]=-d,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let r=0;r<16;r++)if(e[r]!==s[r])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const ne=new g,ut=new Q,Na=new g(0,0,0),Ha=new g(1,1,1),Lt=new g,ts=new g,tt=new g,ii=new Q,ni=new Vt;class Te{constructor(t=0,e=0,s=0,r=Te.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,r=this._order){return this._x=t,this._y=e,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const r=t.elements,n=r[0],a=r[4],o=r[8],h=r[1],c=r[5],l=r[9],u=r[2],f=r[6],p=r[10];switch(e){case"XYZ":this._y=Math.asin(U(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-U(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(U(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(h,n));break;case"ZYX":this._y=Math.asin(-U(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(h,n)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(U(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-U(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return ii.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ii,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ni.setFromEuler(this),this.setFromQuaternion(ni,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Te.DEFAULT_ORDER="XYZ";class ai{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Va=0;const oi=new g,ae=new Vt,vt=new Q,es=new g,Ee=new g,ja=new g,qa=new Vt,hi=new g(1,0,0),ci=new g(0,1,0),li=new g(0,0,1),ui={type:"added"},Ua={type:"removed"},oe={type:"childadded",child:null},Js={type:"childremoved",child:null};class ft extends We{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Va++}),this.uuid=Qt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ft.DEFAULT_UP.clone();const t=new g,e=new Te,s=new Vt,r=new g(1,1,1);function n(){s.setFromEuler(e,!1)}function a(){e.setFromQuaternion(s,void 0,!1)}e._onChange(n),s._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Q},normalMatrix:{value:new gt}}),this.matrix=new Q,this.matrixWorld=new Q,this.matrixAutoUpdate=ft.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ai,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ae.setFromAxisAngle(t,e),this.quaternion.multiply(ae),this}rotateOnWorldAxis(t,e){return ae.setFromAxisAngle(t,e),this.quaternion.premultiply(ae),this}rotateX(t){return this.rotateOnAxis(hi,t)}rotateY(t){return this.rotateOnAxis(ci,t)}rotateZ(t){return this.rotateOnAxis(li,t)}translateOnAxis(t,e){return oi.copy(t).applyQuaternion(this.quaternion),this.position.add(oi.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(hi,t)}translateY(t){return this.translateOnAxis(ci,t)}translateZ(t){return this.translateOnAxis(li,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(vt.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?es.copy(t):es.set(t,e,s);const r=this.parent;this.updateWorldMatrix(!0,!1),Ee.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vt.lookAt(Ee,es,this.up):vt.lookAt(es,Ee,this.up),this.quaternion.setFromRotationMatrix(vt),r&&(vt.extractRotation(r.matrixWorld),ae.setFromRotationMatrix(vt),this.quaternion.premultiply(ae.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(ui),oe.child=t,this.dispatchEvent(oe),oe.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ua),Js.child=t,this.dispatchEvent(Js),Js.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),vt.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),vt.multiply(t.parent.matrixWorld)),t.applyMatrix4(vt),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(ui),oe.child=t,this.dispatchEvent(oe),oe.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,r=this.children.length;s<r;s++){const a=this.children[s].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const r=this.children;for(let n=0,a=r.length;n<a;n++)r[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ee,t,ja),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ee,qa,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,r=e.length;s<r;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,r=e.length;s<r;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,r=e.length;s<r;s++){const n=e[s];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const r=this.children;for(let n=0,a=r.length;n<a;n++){const o=r[n];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function n(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let c=0,l=h.length;c<l;c++){const u=h[c];n(t.shapes,u)}else n(t.shapes,h)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,c=this.material.length;h<c;h++)o.push(n(t.materials,this.material[h]));r.material=o}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];r.animations.push(n(t.animations,h))}}if(e){const o=a(t.geometries),h=a(t.materials),c=a(t.textures),l=a(t.images),u=a(t.shapes),f=a(t.skeletons),p=a(t.animations),d=a(t.nodes);o.length>0&&(s.geometries=o),h.length>0&&(s.materials=h),c.length>0&&(s.textures=c),l.length>0&&(s.images=l),u.length>0&&(s.shapes=u),f.length>0&&(s.skeletons=f),p.length>0&&(s.animations=p),d.length>0&&(s.nodes=d)}return s.object=r,s;function a(o){const h=[];for(const c in o){const l=o[c];delete l.metadata,h.push(l)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const r=t.children[s];this.add(r.clone())}return this}}ft.DEFAULT_UP=new g(0,1,0),ft.DEFAULT_MATRIX_AUTO_UPDATE=!0,ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const pt=new g,Mt=new g,Ks=new g,At=new g,he=new g,ce=new g,fi=new g,Qs=new g,tr=new g,er=new g;class dt{constructor(t=new g,e=new g,s=new g){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,r){r.subVectors(s,e),pt.subVectors(t,e),r.cross(pt);const n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,s,r,n){pt.subVectors(r,e),Mt.subVectors(s,e),Ks.subVectors(t,e);const a=pt.dot(pt),o=pt.dot(Mt),h=pt.dot(Ks),c=Mt.dot(Mt),l=Mt.dot(Ks),u=a*c-o*o;if(u===0)return n.set(0,0,0),null;const f=1/u,p=(c*h-o*l)*f,d=(a*l-o*h)*f;return n.set(1-p-d,d,p)}static containsPoint(t,e,s,r){return this.getBarycoord(t,e,s,r,At)===null?!1:At.x>=0&&At.y>=0&&At.x+At.y<=1}static getInterpolation(t,e,s,r,n,a,o,h){return this.getBarycoord(t,e,s,r,At)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(n,At.x),h.addScaledVector(a,At.y),h.addScaledVector(o,At.z),h)}static isFrontFacing(t,e,s,r){return pt.subVectors(s,e),Mt.subVectors(t,e),pt.cross(Mt).dot(r)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,r){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,s,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return pt.subVectors(this.c,this.b),Mt.subVectors(this.a,this.b),pt.cross(Mt).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return dt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return dt.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,r,n){return dt.getInterpolation(t,this.a,this.b,this.c,e,s,r,n)}containsPoint(t){return dt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return dt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,r=this.b,n=this.c;let a,o;he.subVectors(r,s),ce.subVectors(n,s),Qs.subVectors(t,s);const h=he.dot(Qs),c=ce.dot(Qs);if(h<=0&&c<=0)return e.copy(s);tr.subVectors(t,r);const l=he.dot(tr),u=ce.dot(tr);if(l>=0&&u<=l)return e.copy(r);const f=h*u-l*c;if(f<=0&&h>=0&&l<=0)return a=h/(h-l),e.copy(s).addScaledVector(he,a);er.subVectors(t,n);const p=he.dot(er),d=ce.dot(er);if(d>=0&&p<=d)return e.copy(n);const m=p*c-h*d;if(m<=0&&c>=0&&d<=0)return o=c/(c-d),e.copy(s).addScaledVector(ce,o);const x=l*d-p*u;if(x<=0&&u-l>=0&&p-d>=0)return fi.subVectors(n,r),o=(u-l)/(u-l+(p-d)),e.copy(r).addScaledVector(fi,o);const y=1/(x+m+f);return a=m*y,o=f*y,e.copy(s).addScaledVector(he,a).addScaledVector(ce,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const pi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ot={h:0,s:0,l:0},ss={h:0,s:0,l:0};function sr(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*6*(2/3-e):i}class le{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(e===void 0&&s===void 0){const r=t;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=zt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ct.toWorkingColorSpace(this,e),this}setRGB(t,e,s,r=ct.workingColorSpace){return this.r=t,this.g=e,this.b=s,ct.toWorkingColorSpace(this,r),this}setHSL(t,e,s,r=ct.workingColorSpace){if(t=za(t,1),e=U(e,0,1),s=U(s,0,1),e===0)this.r=this.g=this.b=s;else{const n=s<=.5?s*(1+e):s+e-s*e,a=2*s-n;this.r=sr(a,n,t+1/3),this.g=sr(a,n,t),this.b=sr(a,n,t-1/3)}return ct.toWorkingColorSpace(this,r),this}setStyle(t,e=zt){function s(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],a=n.length;if(a===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=zt){const s=pi[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=te(t.r),this.g=te(t.g),this.b=te(t.b),this}copyLinearToSRGB(t){return this.r=Hs(t.r),this.g=Hs(t.g),this.b=Hs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=zt){return ct.fromWorkingColorSpace(G.copy(this),t),Math.round(U(G.r*255,0,255))*65536+Math.round(U(G.g*255,0,255))*256+Math.round(U(G.b*255,0,255))}getHexString(t=zt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ct.workingColorSpace){ct.fromWorkingColorSpace(G.copy(this),e);const s=G.r,r=G.g,n=G.b,a=Math.max(s,r,n),o=Math.min(s,r,n);let h,c;const l=(o+a)/2;if(o===a)h=0,c=0;else{const u=a-o;switch(c=l<=.5?u/(a+o):u/(2-a-o),a){case s:h=(r-n)/u+(r<n?6:0);break;case r:h=(n-s)/u+2;break;case n:h=(s-r)/u+4;break}h/=6}return t.h=h,t.s=c,t.l=l,t}getRGB(t,e=ct.workingColorSpace){return ct.fromWorkingColorSpace(G.copy(this),e),t.r=G.r,t.g=G.g,t.b=G.b,t}getStyle(t=zt){ct.fromWorkingColorSpace(G.copy(this),t);const e=G.r,s=G.g,r=G.b;return t!==zt?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(s*255)},${Math.round(r*255)})`}offsetHSL(t,e,s){return this.getHSL(Ot),this.setHSL(Ot.h+t,Ot.s+e,Ot.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Ot),t.getHSL(ss);const s=Rs(Ot.h,ss.h,e),r=Rs(Ot.s,ss.s,e),n=Rs(Ot.l,ss.l,e);return this.setHSL(s,r,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,r=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*r,this.g=n[1]*e+n[4]*s+n[7]*r,this.b=n[2]*e+n[5]*s+n[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const G=new le;le.NAMES=pi;let Ga=0;class di extends We{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ga++}),this.uuid=Qt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new le(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];if(r===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(s):r&&r.isVector3&&s&&s.isVector3?r.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(s.blending=this.blending),this.side!==0&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==204&&(s.blendSrc=this.blendSrc),this.blendDst!==205&&(s.blendDst=this.blendDst),this.blendEquation!==100&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==3&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==519&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==7680&&(s.stencilFail=this.stencilFail),this.stencilZFail!==7680&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==7680&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function r(n){const a=[];for(const o in n){const h=n[o];delete h.metadata,a.push(h)}return a}if(e){const n=r(t.textures),a=r(t.images);n.length>0&&(s.textures=n),a.length>0&&(s.images=a)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const r=e.length;s=new Array(r);for(let n=0;n!==r;++n)s[n]=e[n].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Pe extends di{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new le(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Te,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const L=new g,rs=new k;class X{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return Ba("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[s+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)rs.fromBufferAttribute(this,e),rs.applyMatrix3(t),this.setXY(e,rs.x,rs.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)L.fromBufferAttribute(this,e),L.applyMatrix3(t),this.setXYZ(e,L.x,L.y,L.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)L.fromBufferAttribute(this,e),L.applyMatrix4(t),this.setXYZ(e,L.x,L.y,L.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)L.fromBufferAttribute(this,e),L.applyNormalMatrix(t),this.setXYZ(e,L.x,L.y,L.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)L.fromBufferAttribute(this,e),L.transformDirection(t),this.setXYZ(e,L.x,L.y,L.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=Se(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=K(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Se(e,this.array)),e}setX(t,e){return this.normalized&&(e=K(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Se(e,this.array)),e}setY(t,e){return this.normalized&&(e=K(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Se(e,this.array)),e}setZ(t,e){return this.normalized&&(e=K(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Se(e,this.array)),e}setW(t,e){return this.normalized&&(e=K(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=K(e,this.array),s=K(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,r){return t*=this.itemSize,this.normalized&&(e=K(e,this.array),s=K(s,this.array),r=K(r,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=r,this}setXYZW(t,e,s,r,n){return t*=this.itemSize,this.normalized&&(e=K(e,this.array),s=K(s,this.array),r=K(r,this.array),n=K(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==35044&&(t.usage=this.usage),t}}class Wa extends X{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Xa extends X{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class St extends X{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Ya=0;const at=new Q,rr=new ft,ue=new g,et=new bt,ze=new bt,R=new g;class ot extends We{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ya++}),this.uuid=Qt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ca(t)?Xa:Wa)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const n=new gt().getNormalMatrix(t);s.applyNormalMatrix(n),s.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return at.makeRotationFromQuaternion(t),this.applyMatrix4(at),this}rotateX(t){return at.makeRotationX(t),this.applyMatrix4(at),this}rotateY(t){return at.makeRotationY(t),this.applyMatrix4(at),this}rotateZ(t){return at.makeRotationZ(t),this.applyMatrix4(at),this}translate(t,e,s){return at.makeTranslation(t,e,s),this.applyMatrix4(at),this}scale(t,e,s){return at.makeScale(t,e,s),this.applyMatrix4(at),this}lookAt(t){return rr.lookAt(t),rr.updateMatrix(),this.applyMatrix4(rr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ue).negate(),this.translate(ue.x,ue.y,ue.z),this}setFromPoints(t){const e=[];for(let s=0,r=t.length;s<r;s++){const n=t[s];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new St(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new bt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new g(-1/0,-1/0,-1/0),new g(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,r=e.length;s<r;s++){const n=e[s];et.setFromBufferAttribute(n),this.morphTargetsRelative?(R.addVectors(this.boundingBox.min,et.min),this.boundingBox.expandByPoint(R),R.addVectors(this.boundingBox.max,et.max),this.boundingBox.expandByPoint(R)):(this.boundingBox.expandByPoint(et.min),this.boundingBox.expandByPoint(et.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Gs);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new g,1/0);return}if(t){const s=this.boundingSphere.center;if(et.setFromBufferAttribute(t),e)for(let n=0,a=e.length;n<a;n++){const o=e[n];ze.setFromBufferAttribute(o),this.morphTargetsRelative?(R.addVectors(et.min,ze.min),et.expandByPoint(R),R.addVectors(et.max,ze.max),et.expandByPoint(R)):(et.expandByPoint(ze.min),et.expandByPoint(ze.max))}et.getCenter(s);let r=0;for(let n=0,a=t.count;n<a;n++)R.fromBufferAttribute(t,n),r=Math.max(r,s.distanceToSquared(R));if(e)for(let n=0,a=e.length;n<a;n++){const o=e[n],h=this.morphTargetsRelative;for(let c=0,l=o.count;c<l;c++)R.fromBufferAttribute(o,c),h&&(ue.fromBufferAttribute(t,c),R.add(ue)),r=Math.max(r,s.distanceToSquared(R))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.position,r=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new X(new Float32Array(4*s.count),4));const a=this.getAttribute("tangent"),o=[],h=[];for(let S=0;S<s.count;S++)o[S]=new g,h[S]=new g;const c=new g,l=new g,u=new g,f=new k,p=new k,d=new k,m=new g,x=new g;function y(S,F,T){c.fromBufferAttribute(s,S),l.fromBufferAttribute(s,F),u.fromBufferAttribute(s,T),f.fromBufferAttribute(n,S),p.fromBufferAttribute(n,F),d.fromBufferAttribute(n,T),l.sub(c),u.sub(c),p.sub(f),d.sub(f);const C=1/(p.x*d.y-d.x*p.y);isFinite(C)&&(m.copy(l).multiplyScalar(d.y).addScaledVector(u,-p.y).multiplyScalar(C),x.copy(u).multiplyScalar(p.x).addScaledVector(l,-d.x).multiplyScalar(C),o[S].add(m),o[F].add(m),o[T].add(m),h[S].add(x),h[F].add(x),h[T].add(x))}let _=this.groups;_.length===0&&(_=[{start:0,count:t.count}]);for(let S=0,F=_.length;S<F;++S){const T=_[S],C=T.start,rt=T.count;for(let I=C,it=C+rt;I<it;I+=3)y(t.getX(I+0),t.getX(I+1),t.getX(I+2))}const b=new g,w=new g,A=new g,M=new g;function v(S){A.fromBufferAttribute(r,S),M.copy(A);const F=o[S];b.copy(F),b.sub(A.multiplyScalar(A.dot(F))).normalize(),w.crossVectors(M,F);const C=w.dot(h[S])<0?-1:1;a.setXYZW(S,b.x,b.y,b.z,C)}for(let S=0,F=_.length;S<F;++S){const T=_[S],C=T.start,rt=T.count;for(let I=C,it=C+rt;I<it;I+=3)v(t.getX(I+0)),v(t.getX(I+1)),v(t.getX(I+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new X(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let f=0,p=s.count;f<p;f++)s.setXYZ(f,0,0,0);const r=new g,n=new g,a=new g,o=new g,h=new g,c=new g,l=new g,u=new g;if(t)for(let f=0,p=t.count;f<p;f+=3){const d=t.getX(f+0),m=t.getX(f+1),x=t.getX(f+2);r.fromBufferAttribute(e,d),n.fromBufferAttribute(e,m),a.fromBufferAttribute(e,x),l.subVectors(a,n),u.subVectors(r,n),l.cross(u),o.fromBufferAttribute(s,d),h.fromBufferAttribute(s,m),c.fromBufferAttribute(s,x),o.add(l),h.add(l),c.add(l),s.setXYZ(d,o.x,o.y,o.z),s.setXYZ(m,h.x,h.y,h.z),s.setXYZ(x,c.x,c.y,c.z)}else for(let f=0,p=e.count;f<p;f+=3)r.fromBufferAttribute(e,f+0),n.fromBufferAttribute(e,f+1),a.fromBufferAttribute(e,f+2),l.subVectors(a,n),u.subVectors(r,n),l.cross(u),s.setXYZ(f+0,l.x,l.y,l.z),s.setXYZ(f+1,l.x,l.y,l.z),s.setXYZ(f+2,l.x,l.y,l.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)R.fromBufferAttribute(t,e),R.normalize(),t.setXYZ(e,R.x,R.y,R.z)}toNonIndexed(){function t(o,h){const c=o.array,l=o.itemSize,u=o.normalized,f=new c.constructor(h.length*l);let p=0,d=0;for(let m=0,x=h.length;m<x;m++){o.isInterleavedBufferAttribute?p=h[m]*o.data.stride+o.offset:p=h[m]*l;for(let y=0;y<l;y++)f[d++]=c[p++]}return new X(f,l,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ot,s=this.index.array,r=this.attributes;for(const o in r){const h=r[o],c=t(h,s);e.setAttribute(o,c)}const n=this.morphAttributes;for(const o in n){const h=[],c=n[o];for(let l=0,u=c.length;l<u;l++){const f=c[l],p=t(f,s);h.push(p)}e.morphAttributes[o]=h}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,h=a.length;o<h;o++){const c=a[o];e.addGroup(c.start,c.count,c.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const c in h)h[c]!==void 0&&(t[c]=h[c]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const h in s){const c=s[h];t.data.attributes[h]=c.toJSON(t.data)}const r={};let n=!1;for(const h in this.morphAttributes){const c=this.morphAttributes[h],l=[];for(let u=0,f=c.length;u<f;u++){const p=c[u];l.push(p.toJSON(t.data))}l.length>0&&(r[h]=l,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const r=t.attributes;for(const c in r){const l=r[c];this.setAttribute(c,l.clone(e))}const n=t.morphAttributes;for(const c in n){const l=[],u=n[c];for(let f=0,p=u.length;f<p;f++)l.push(u[f].clone(e));this.morphAttributes[c]=l}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,l=a.length;c<l;c++){const u=a[c];this.addGroup(u.start,u.count,u.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const mi=new Q,Ut=new Zs,is=new Gs,xi=new g,fe=new g,pe=new g,de=new g,ir=new g,ns=new g,as=new k,os=new k,hs=new k,yi=new g,gi=new g,bi=new g,cs=new g,ls=new g;class kt extends ft{constructor(t=new ot,e=new Pe){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const r=e[s[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=r.length;n<a;n++){const o=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(t,e){const s=this.geometry,r=s.attributes.position,n=s.morphAttributes.position,a=s.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(n&&o){ns.set(0,0,0);for(let h=0,c=n.length;h<c;h++){const l=o[h],u=n[h];l!==0&&(ir.fromBufferAttribute(u,t),a?ns.addScaledVector(ir,l):ns.addScaledVector(ir.sub(e),l))}e.add(ns)}return e}raycast(t,e){const s=this.geometry,r=this.material,n=this.matrixWorld;r!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),is.copy(s.boundingSphere),is.applyMatrix4(n),Ut.copy(t.ray).recast(t.near),!(is.containsPoint(Ut.origin)===!1&&(Ut.intersectSphere(is,xi)===null||Ut.origin.distanceToSquared(xi)>(t.far-t.near)**2))&&(mi.copy(n).invert(),Ut.copy(t.ray).applyMatrix4(mi),!(s.boundingBox!==null&&Ut.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(t,e,Ut)))}_computeIntersections(t,e,s){let r;const n=this.geometry,a=this.material,o=n.index,h=n.attributes.position,c=n.attributes.uv,l=n.attributes.uv1,u=n.attributes.normal,f=n.groups,p=n.drawRange;if(o!==null)if(Array.isArray(a))for(let d=0,m=f.length;d<m;d++){const x=f[d],y=a[x.materialIndex],_=Math.max(x.start,p.start),b=Math.min(o.count,Math.min(x.start+x.count,p.start+p.count));for(let w=_,A=b;w<A;w+=3){const M=o.getX(w),v=o.getX(w+1),S=o.getX(w+2);r=us(this,y,t,s,c,l,u,M,v,S),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=x.materialIndex,e.push(r))}}else{const d=Math.max(0,p.start),m=Math.min(o.count,p.start+p.count);for(let x=d,y=m;x<y;x+=3){const _=o.getX(x),b=o.getX(x+1),w=o.getX(x+2);r=us(this,a,t,s,c,l,u,_,b,w),r&&(r.faceIndex=Math.floor(x/3),e.push(r))}}else if(h!==void 0)if(Array.isArray(a))for(let d=0,m=f.length;d<m;d++){const x=f[d],y=a[x.materialIndex],_=Math.max(x.start,p.start),b=Math.min(h.count,Math.min(x.start+x.count,p.start+p.count));for(let w=_,A=b;w<A;w+=3){const M=w,v=w+1,S=w+2;r=us(this,y,t,s,c,l,u,M,v,S),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=x.materialIndex,e.push(r))}}else{const d=Math.max(0,p.start),m=Math.min(h.count,p.start+p.count);for(let x=d,y=m;x<y;x+=3){const _=x,b=x+1,w=x+2;r=us(this,a,t,s,c,l,u,_,b,w),r&&(r.faceIndex=Math.floor(x/3),e.push(r))}}}}function Za(i,t,e,s,r,n,a,o){let h;if(t.side===1?h=s.intersectTriangle(a,n,r,!0,o):h=s.intersectTriangle(r,n,a,t.side===0,o),h===null)return null;ls.copy(o),ls.applyMatrix4(i.matrixWorld);const c=e.ray.origin.distanceTo(ls);return c<e.near||c>e.far?null:{distance:c,point:ls.clone(),object:i}}function us(i,t,e,s,r,n,a,o,h,c){i.getVertexPosition(o,fe),i.getVertexPosition(h,pe),i.getVertexPosition(c,de);const l=Za(i,t,e,s,fe,pe,de,cs);if(l){r&&(as.fromBufferAttribute(r,o),os.fromBufferAttribute(r,h),hs.fromBufferAttribute(r,c),l.uv=dt.getInterpolation(cs,fe,pe,de,as,os,hs,new k)),n&&(as.fromBufferAttribute(n,o),os.fromBufferAttribute(n,h),hs.fromBufferAttribute(n,c),l.uv1=dt.getInterpolation(cs,fe,pe,de,as,os,hs,new k)),a&&(yi.fromBufferAttribute(a,o),gi.fromBufferAttribute(a,h),bi.fromBufferAttribute(a,c),l.normal=dt.getInterpolation(cs,fe,pe,de,yi,gi,bi,new g),l.normal.dot(s.direction)>0&&l.normal.multiplyScalar(-1));const u={a:o,b:h,c,normal:new g,materialIndex:0};dt.getNormal(fe,pe,de,u.normal),l.face=u}return l}class nr extends ot{constructor(t=1,e=1,s=1,r=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:s,widthSegments:r,heightSegments:n,depthSegments:a};const o=this;r=Math.floor(r),n=Math.floor(n),a=Math.floor(a);const h=[],c=[],l=[],u=[];let f=0,p=0;d("z","y","x",-1,-1,s,e,t,a,n,0),d("z","y","x",1,-1,s,e,-t,a,n,1),d("x","z","y",1,1,t,s,e,r,a,2),d("x","z","y",1,-1,t,s,-e,r,a,3),d("x","y","z",1,-1,t,e,s,r,n,4),d("x","y","z",-1,-1,t,e,-s,r,n,5),this.setIndex(h),this.setAttribute("position",new St(c,3)),this.setAttribute("normal",new St(l,3)),this.setAttribute("uv",new St(u,2));function d(m,x,y,_,b,w,A,M,v,S,F){const T=w/v,C=A/S,rt=w/2,I=A/2,it=M/2,yt=v+1,Me=S+1;let Zt=0,Ht=0;const V=new g;for(let W=0;W<Me;W++){const nt=W*C-I;for(let Ae=0;Ae<yt;Ae++){const Ls=Ae*T-rt;V[m]=Ls*_,V[x]=nt*b,V[y]=it,c.push(V.x,V.y,V.z),V[m]=0,V[x]=0,V[y]=M>0?1:-1,l.push(V.x,V.y,V.z),u.push(Ae/v),u.push(1-W/S),Zt+=1}}for(let W=0;W<S;W++)for(let nt=0;nt<v;nt++){const Ae=f+nt+yt*W,Ls=f+nt+yt*(W+1),Gx=f+(nt+1)+yt*(W+1),Ea=f+(nt+1)+yt*W;h.push(Ae,Ls,Ea),h.push(Ls,Gx,Ea),Ht+=6}o.addGroup(p,Ht,F),p+=Ht,f+=Zt}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new nr(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}const ar=new g,Ja=new g,Ka=new gt;class Qa{constructor(t=new g(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,r){return this.normal.set(t,e,s),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const r=ar.subVectors(s,e).cross(Ja.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(ar),r=this.normal.dot(s);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||Ka.getNormalMatrix(t),r=this.coplanarPoint(ar).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}class to extends Ct{constructor(t,e,s,r,n,a,o,h,c,l=1026){if(l!==1026&&l!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&l===1026&&(s=1014),s===void 0&&l===1027&&(s=1020),super(null,r,n,a,o,h,l,s,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:1003,this.minFilter=h!==void 0?h:1003,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const eo=new to(1,1);eo.compareFunction=515;class st extends ft{constructor(){super(),this.isGroup=!0,this.type="Group"}}class or extends di{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new le(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const fs=new g,ps=new g,_i=new Q,Ce=new Zs,ds=new Gs,hr=new g,wi=new g;class Ft extends ft{constructor(t=new ot,e=new or){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[0];for(let r=1,n=e.count;r<n;r++)fs.fromBufferAttribute(e,r-1),ps.fromBufferAttribute(e,r),s[r]=s[r-1],s[r]+=fs.distanceTo(ps);t.setAttribute("lineDistance",new St(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const s=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,a=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),ds.copy(s.boundingSphere),ds.applyMatrix4(r),ds.radius+=n,t.ray.intersectsSphere(ds)===!1)return;_i.copy(r).invert(),Ce.copy(t.ray).applyMatrix4(_i);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),h=o*o,c=this.isLineSegments?2:1,l=s.index,f=s.attributes.position;if(l!==null){const p=Math.max(0,a.start),d=Math.min(l.count,a.start+a.count);for(let m=p,x=d-1;m<x;m+=c){const y=l.getX(m),_=l.getX(m+1),b=ms(this,t,Ce,h,y,_);b&&e.push(b)}if(this.isLineLoop){const m=l.getX(d-1),x=l.getX(p),y=ms(this,t,Ce,h,m,x);y&&e.push(y)}}else{const p=Math.max(0,a.start),d=Math.min(f.count,a.start+a.count);for(let m=p,x=d-1;m<x;m+=c){const y=ms(this,t,Ce,h,m,m+1);y&&e.push(y)}if(this.isLineLoop){const m=ms(this,t,Ce,h,d-1,p);m&&e.push(m)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const r=e[s[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=r.length;n<a;n++){const o=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}}function ms(i,t,e,s,r,n){const a=i.geometry.attributes.position;if(fs.fromBufferAttribute(a,r),ps.fromBufferAttribute(a,n),e.distanceSqToSegment(fs,ps,hr,wi)>s)return;hr.applyMatrix4(i.matrixWorld);const h=t.ray.origin.distanceTo(hr);if(!(h<t.near||h>t.far))return{distance:h,point:wi.clone().applyMatrix4(i.matrixWorld),index:r,face:null,faceIndex:null,object:i}}const vi=new g,Mi=new g;class cr extends Ft{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[];for(let r=0,n=e.count;r<n;r+=2)vi.fromBufferAttribute(e,r),Mi.fromBufferAttribute(e,r+1),s[r]=r===0?0:s[r-1],s[r+1]=s[r]+vi.distanceTo(Mi);t.setAttribute("lineDistance",new St(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class mt{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const s=this.getUtoTmapping(t);return this.getPoint(s,e)}getPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return e}getSpacedPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPointAt(s/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let s,r=this.getPoint(0),n=0;e.push(0);for(let a=1;a<=t;a++)s=this.getPoint(a/t),n+=s.distanceTo(r),e.push(n),r=s;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const s=this.getLengths();let r=0;const n=s.length;let a;e?a=e:a=t*s[n-1];let o=0,h=n-1,c;for(;o<=h;)if(r=Math.floor(o+(h-o)/2),c=s[r]-a,c<0)o=r+1;else if(c>0)h=r-1;else{h=r;break}if(r=h,s[r]===a)return r/(n-1);const l=s[r],f=s[r+1]-l,p=(a-l)/f;return(r+p)/(n-1)}getTangent(t,e){let r=t-1e-4,n=t+1e-4;r<0&&(r=0),n>1&&(n=1);const a=this.getPoint(r),o=this.getPoint(n),h=e||(a.isVector2?new k:new g);return h.copy(o).sub(a).normalize(),h}getTangentAt(t,e){const s=this.getUtoTmapping(t);return this.getTangent(s,e)}computeFrenetFrames(t,e){const s=new g,r=[],n=[],a=[],o=new g,h=new Q;for(let p=0;p<=t;p++){const d=p/t;r[p]=this.getTangentAt(d,new g)}n[0]=new g,a[0]=new g;let c=Number.MAX_VALUE;const l=Math.abs(r[0].x),u=Math.abs(r[0].y),f=Math.abs(r[0].z);l<=c&&(c=l,s.set(1,0,0)),u<=c&&(c=u,s.set(0,1,0)),f<=c&&s.set(0,0,1),o.crossVectors(r[0],s).normalize(),n[0].crossVectors(r[0],o),a[0].crossVectors(r[0],n[0]);for(let p=1;p<=t;p++){if(n[p]=n[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();const d=Math.acos(U(r[p-1].dot(r[p]),-1,1));n[p].applyMatrix4(h.makeRotationAxis(o,d))}a[p].crossVectors(r[p],n[p])}if(e===!0){let p=Math.acos(U(n[0].dot(n[t]),-1,1));p/=t,r[0].dot(o.crossVectors(n[0],n[t]))>0&&(p=-p);for(let d=1;d<=t;d++)n[d].applyMatrix4(h.makeRotationAxis(r[d],p*d)),a[d].crossVectors(r[d],n[d])}return{tangents:r,normals:n,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Be extends mt{constructor(t=0,e=0,s=1,r=1,n=0,a=Math.PI*2,o=!1,h=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=s,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o,this.aRotation=h}getPoint(t,e=new k){const s=e,r=Math.PI*2;let n=this.aEndAngle-this.aStartAngle;const a=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(a?n=0:n=r),this.aClockwise===!0&&!a&&(n===r?n=-r:n=n-r);const o=this.aStartAngle+t*n;let h=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const l=Math.cos(this.aRotation),u=Math.sin(this.aRotation),f=h-this.aX,p=c-this.aY;h=f*l-p*u+this.aX,c=f*u+p*l+this.aY}return s.set(h,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class lr extends Be{constructor(t,e,s,r,n,a){super(t,e,s,s,r,n,a),this.isArcCurve=!0,this.type="ArcCurve"}}function ur(){let i=0,t=0,e=0,s=0;function r(n,a,o,h){i=n,t=o,e=-3*n+3*a-2*o-h,s=2*n-2*a+o+h}return{initCatmullRom:function(n,a,o,h,c){r(a,o,c*(o-n),c*(h-a))},initNonuniformCatmullRom:function(n,a,o,h,c,l,u){let f=(a-n)/c-(o-n)/(c+l)+(o-a)/l,p=(o-a)/l-(h-a)/(l+u)+(h-o)/u;f*=l,p*=l,r(a,o,f,p)},calc:function(n){const a=n*n,o=a*n;return i+t*n+e*a+s*o}}}const xs=new g,fr=new ur,pr=new ur,dr=new ur;class so extends mt{constructor(t=[],e=!1,s="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=s,this.tension=r}getPoint(t,e=new g){const s=e,r=this.points,n=r.length,a=(n-(this.closed?0:1))*t;let o=Math.floor(a),h=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:h===0&&o===n-1&&(o=n-2,h=1);let c,l;this.closed||o>0?c=r[(o-1)%n]:(xs.subVectors(r[0],r[1]).add(r[0]),c=xs);const u=r[o%n],f=r[(o+1)%n];if(this.closed||o+2<n?l=r[(o+2)%n]:(xs.subVectors(r[n-1],r[n-2]).add(r[n-1]),l=xs),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let d=Math.pow(c.distanceToSquared(u),p),m=Math.pow(u.distanceToSquared(f),p),x=Math.pow(f.distanceToSquared(l),p);m<1e-4&&(m=1),d<1e-4&&(d=m),x<1e-4&&(x=m),fr.initNonuniformCatmullRom(c.x,u.x,f.x,l.x,d,m,x),pr.initNonuniformCatmullRom(c.y,u.y,f.y,l.y,d,m,x),dr.initNonuniformCatmullRom(c.z,u.z,f.z,l.z,d,m,x)}else this.curveType==="catmullrom"&&(fr.initCatmullRom(c.x,u.x,f.x,l.x,this.tension),pr.initCatmullRom(c.y,u.y,f.y,l.y,this.tension),dr.initCatmullRom(c.z,u.z,f.z,l.z,this.tension));return s.set(fr.calc(h),pr.calc(h),dr.calc(h)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const r=t.points[e];this.points.push(new g().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ai(i,t,e,s,r){const n=(s-t)*.5,a=(r-e)*.5,o=i*i,h=i*o;return(2*e-2*s+n+a)*h+(-3*e+3*s-2*n-a)*o+n*i+e}function ro(i,t){const e=1-i;return e*e*t}function io(i,t){return 2*(1-i)*i*t}function no(i,t){return i*i*t}function De(i,t,e,s){return ro(i,t)+io(i,e)+no(i,s)}function ao(i,t){const e=1-i;return e*e*e*t}function oo(i,t){const e=1-i;return 3*e*e*i*t}function ho(i,t){return 3*(1-i)*i*i*t}function co(i,t){return i*i*i*t}function Ie(i,t,e,s,r){return ao(i,t)+oo(i,e)+ho(i,s)+co(i,r)}class Si extends mt{constructor(t=new k,e=new k,s=new k,r=new k){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=s,this.v3=r}getPoint(t,e=new k){const s=e,r=this.v0,n=this.v1,a=this.v2,o=this.v3;return s.set(Ie(t,r.x,n.x,a.x,o.x),Ie(t,r.y,n.y,a.y,o.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class lo extends mt{constructor(t=new g,e=new g,s=new g,r=new g){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=s,this.v3=r}getPoint(t,e=new g){const s=e,r=this.v0,n=this.v1,a=this.v2,o=this.v3;return s.set(Ie(t,r.x,n.x,a.x,o.x),Ie(t,r.y,n.y,a.y,o.y),Ie(t,r.z,n.z,a.z,o.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class ki extends mt{constructor(t=new k,e=new k){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new k){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new k){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class uo extends mt{constructor(t=new g,e=new g){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new g){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new g){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Fi extends mt{constructor(t=new k,e=new k,s=new k){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new k){const s=e,r=this.v0,n=this.v1,a=this.v2;return s.set(De(t,r.x,n.x,a.x),De(t,r.y,n.y,a.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class fo extends mt{constructor(t=new g,e=new g,s=new g){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new g){const s=e,r=this.v0,n=this.v1,a=this.v2;return s.set(De(t,r.x,n.x,a.x),De(t,r.y,n.y,a.y),De(t,r.z,n.z,a.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ti extends mt{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new k){const s=e,r=this.points,n=(r.length-1)*t,a=Math.floor(n),o=n-a,h=r[a===0?a:a-1],c=r[a],l=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return s.set(Ai(o,h.x,c.x,l.x,u.x),Ai(o,h.y,c.y,l.y,u.y)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const r=t.points[e];this.points.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const r=t.points[e];this.points.push(new k().fromArray(r))}return this}}var Ei=Object.freeze({__proto__:null,ArcCurve:lr,CatmullRomCurve3:so,CubicBezierCurve:Si,CubicBezierCurve3:lo,EllipseCurve:Be,LineCurve:ki,LineCurve3:uo,QuadraticBezierCurve:Fi,QuadraticBezierCurve3:fo,SplineCurve:Ti});class po extends mt{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const s=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Ei[s](e,t))}return this}getPoint(t,e){const s=t*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=s){const a=r[n]-s,o=this.curves[n],h=o.getLength(),c=h===0?0:1-a/h;return o.getPointAt(c,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let s=0,r=this.curves.length;s<r;s++)e+=this.curves[s].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let s;for(let r=0,n=this.curves;r<n.length;r++){const a=n[r],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,h=a.getPoints(o);for(let c=0;c<h.length;c++){const l=h[c];s&&s.equals(l)||(e.push(l),s=l)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,s=this.curves.length;e<s;e++){const r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const r=t.curves[e];this.curves.push(new Ei[r.type]().fromJSON(r))}return this}}class mr extends po{constructor(t){super(),this.type="Path",this.currentPoint=new k,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const s=new ki(this.currentPoint.clone(),new k(t,e));return this.curves.push(s),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,s,r){const n=new Fi(this.currentPoint.clone(),new k(t,e),new k(s,r));return this.curves.push(n),this.currentPoint.set(s,r),this}bezierCurveTo(t,e,s,r,n,a){const o=new Si(this.currentPoint.clone(),new k(t,e),new k(s,r),new k(n,a));return this.curves.push(o),this.currentPoint.set(n,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),s=new Ti(e);return this.curves.push(s),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,s,r,n,a){const o=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(t+o,e+h,s,r,n,a),this}absarc(t,e,s,r,n,a){return this.absellipse(t,e,s,s,r,n,a),this}ellipse(t,e,s,r,n,a,o,h){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,s,r,n,a,o,h),this}absellipse(t,e,s,r,n,a,o,h){const c=new Be(t,e,s,r,n,a,o,h);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Gt extends mr{constructor(t){super(t),this.uuid=Qt(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let s=0,r=this.holes.length;s<r;s++)e[s]=this.holes[s].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,s=this.holes.length;e<s;e++){const r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const r=t.holes[e];this.holes.push(new mr().fromJSON(r))}return this}}const mo={triangulate:function(i,t,e=2){const s=t&&t.length,r=s?t[0]*e:i.length;let n=Pi(i,0,r,e,!0);const a=[];if(!n||n.next===n.prev)return a;let o,h,c,l,u,f,p;if(s&&(n=_o(i,t,n,e)),i.length>80*e){o=c=i[0],h=l=i[1];for(let d=e;d<r;d+=e)u=i[d],f=i[d+1],u<o&&(o=u),f<h&&(h=f),u>c&&(c=u),f>l&&(l=f);p=Math.max(c-o,l-h),p=p!==0?32767/p:0}return Le(n,a,e,o,h,p,0),a}};function Pi(i,t,e,s,r){let n,a;if(r===zo(i,t,e,s)>0)for(n=t;n<e;n+=s)a=Bi(n,i[n],i[n+1],a);else for(n=e-s;n>=t;n-=s)a=Bi(n,i[n],i[n+1],a);return a&&ys(a,a.next)&&($e(a),a=a.next),a}function Wt(i,t){if(!i)return i;t||(t=i);let e=i,s;do if(s=!1,!e.steiner&&(ys(e,e.next)||B(e.prev,e,e.next)===0)){if($e(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function Le(i,t,e,s,r,n,a){if(!i)return;!a&&n&&So(i,s,r,n);let o=i,h,c;for(;i.prev!==i.next;){if(h=i.prev,c=i.next,n?yo(i,s,r,n):xo(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(c.i/e|0),$e(i),i=c.next,o=c.next;continue}if(i=c,i===o){a?a===1?(i=go(Wt(i),t,e),Le(i,t,e,s,r,n,2)):a===2&&bo(i,t,e,s,r,n):Le(Wt(i),t,e,s,r,n,1);break}}}function xo(i){const t=i.prev,e=i,s=i.next;if(B(t,e,s)>=0)return!1;const r=t.x,n=e.x,a=s.x,o=t.y,h=e.y,c=s.y,l=r<n?r<a?r:a:n<a?n:a,u=o<h?o<c?o:c:h<c?h:c,f=r>n?r>a?r:a:n>a?n:a,p=o>h?o>c?o:c:h>c?h:c;let d=s.next;for(;d!==t;){if(d.x>=l&&d.x<=f&&d.y>=u&&d.y<=p&&me(r,o,n,h,a,c,d.x,d.y)&&B(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function yo(i,t,e,s){const r=i.prev,n=i,a=i.next;if(B(r,n,a)>=0)return!1;const o=r.x,h=n.x,c=a.x,l=r.y,u=n.y,f=a.y,p=o<h?o<c?o:c:h<c?h:c,d=l<u?l<f?l:f:u<f?u:f,m=o>h?o>c?o:c:h>c?h:c,x=l>u?l>f?l:f:u>f?u:f,y=xr(p,d,t,e,s),_=xr(m,x,t,e,s);let b=i.prevZ,w=i.nextZ;for(;b&&b.z>=y&&w&&w.z<=_;){if(b.x>=p&&b.x<=m&&b.y>=d&&b.y<=x&&b!==r&&b!==a&&me(o,l,h,u,c,f,b.x,b.y)&&B(b.prev,b,b.next)>=0||(b=b.prevZ,w.x>=p&&w.x<=m&&w.y>=d&&w.y<=x&&w!==r&&w!==a&&me(o,l,h,u,c,f,w.x,w.y)&&B(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;b&&b.z>=y;){if(b.x>=p&&b.x<=m&&b.y>=d&&b.y<=x&&b!==r&&b!==a&&me(o,l,h,u,c,f,b.x,b.y)&&B(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=_;){if(w.x>=p&&w.x<=m&&w.y>=d&&w.y<=x&&w!==r&&w!==a&&me(o,l,h,u,c,f,w.x,w.y)&&B(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function go(i,t,e){let s=i;do{const r=s.prev,n=s.next.next;!ys(r,n)&&zi(r,s,s.next,n)&&Oe(r,n)&&Oe(n,r)&&(t.push(r.i/e|0),t.push(s.i/e|0),t.push(n.i/e|0),$e(s),$e(s.next),s=i=n),s=s.next}while(s!==i);return Wt(s)}function bo(i,t,e,s,r,n){let a=i;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&To(a,o)){let h=Ci(a,o);a=Wt(a,a.next),h=Wt(h,h.next),Le(a,t,e,s,r,n,0),Le(h,t,e,s,r,n,0);return}o=o.next}a=a.next}while(a!==i)}function _o(i,t,e,s){const r=[];let n,a,o,h,c;for(n=0,a=t.length;n<a;n++)o=t[n]*s,h=n<a-1?t[n+1]*s:i.length,c=Pi(i,o,h,s,!1),c===c.next&&(c.steiner=!0),r.push(Fo(c));for(r.sort(wo),n=0;n<r.length;n++)e=vo(r[n],e);return e}function wo(i,t){return i.x-t.x}function vo(i,t){const e=Mo(i,t);if(!e)return t;const s=Ci(e,i);return Wt(s,s.next),Wt(e,e.next)}function Mo(i,t){let e=t,s=-1/0,r;const n=i.x,a=i.y;do{if(a<=e.y&&a>=e.next.y&&e.next.y!==e.y){const f=e.x+(a-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(f<=n&&f>s&&(s=f,r=e.x<e.next.x?e:e.next,f===n))return r}e=e.next}while(e!==t);if(!r)return null;const o=r,h=r.x,c=r.y;let l=1/0,u;e=r;do n>=e.x&&e.x>=h&&n!==e.x&&me(a<c?n:s,a,h,c,a<c?s:n,a,e.x,e.y)&&(u=Math.abs(a-e.y)/(n-e.x),Oe(e,i)&&(u<l||u===l&&(e.x>r.x||e.x===r.x&&Ao(r,e)))&&(r=e,l=u)),e=e.next;while(e!==o);return r}function Ao(i,t){return B(i.prev,i,t.prev)<0&&B(t.next,i,i.next)<0}function So(i,t,e,s){let r=i;do r.z===0&&(r.z=xr(r.x,r.y,t,e,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,ko(r)}function ko(i){let t,e,s,r,n,a,o,h,c=1;do{for(e=i,i=null,n=null,a=0;e;){for(a++,s=e,o=0,t=0;t<c&&(o++,s=s.nextZ,!!s);t++);for(h=c;o>0||h>0&&s;)o!==0&&(h===0||!s||e.z<=s.z)?(r=e,e=e.nextZ,o--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:i=r,r.prevZ=n,n=r;e=s}n.nextZ=null,c*=2}while(a>1);return i}function xr(i,t,e,s,r){return i=(i-e)*r|0,t=(t-s)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function Fo(i){let t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function me(i,t,e,s,r,n,a,o){return(r-a)*(t-o)>=(i-a)*(n-o)&&(i-a)*(s-o)>=(e-a)*(t-o)&&(e-a)*(n-o)>=(r-a)*(s-o)}function To(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!Eo(i,t)&&(Oe(i,t)&&Oe(t,i)&&Po(i,t)&&(B(i.prev,i,t.prev)||B(i,t.prev,t))||ys(i,t)&&B(i.prev,i,i.next)>0&&B(t.prev,t,t.next)>0)}function B(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function ys(i,t){return i.x===t.x&&i.y===t.y}function zi(i,t,e,s){const r=bs(B(i,t,e)),n=bs(B(i,t,s)),a=bs(B(e,s,i)),o=bs(B(e,s,t));return!!(r!==n&&a!==o||r===0&&gs(i,e,t)||n===0&&gs(i,s,t)||a===0&&gs(e,i,s)||o===0&&gs(e,t,s))}function gs(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function bs(i){return i>0?1:i<0?-1:0}function Eo(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&zi(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Oe(i,t){return B(i.prev,i,i.next)<0?B(i,t,i.next)>=0&&B(i,i.prev,t)>=0:B(i,t,i.prev)<0||B(i,i.next,t)<0}function Po(i,t){let e=i,s=!1;const r=(i.x+t.x)/2,n=(i.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==i);return s}function Ci(i,t){const e=new yr(i.i,i.x,i.y),s=new yr(t.i,t.x,t.y),r=i.next,n=t.prev;return i.next=t,t.prev=i,e.next=r,r.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}function Bi(i,t,e,s){const r=new yr(i,t,e);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function $e(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function yr(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zo(i,t,e,s){let r=0;for(let n=t,a=e-s;n<e;n+=s)r+=(i[a]-i[n])*(i[n+1]+i[a+1]),a=n;return r}class xe{static area(t){const e=t.length;let s=0;for(let r=e-1,n=0;n<e;r=n++)s+=t[r].x*t[n].y-t[n].x*t[r].y;return s*.5}static isClockWise(t){return xe.area(t)<0}static triangulateShape(t,e){const s=[],r=[],n=[];Di(t),Ii(s,t);let a=t.length;e.forEach(Di);for(let h=0;h<e.length;h++)r.push(a),a+=e[h].length,Ii(s,e[h]);const o=mo.triangulate(s,r);for(let h=0;h<o.length;h+=3)n.push(o.slice(h,h+3));return n}}function Di(i){const t=i.length;t>2&&i[t-1].equals(i[0])&&i.pop()}function Ii(i,t){for(let e=0;e<t.length;e++)i.push(t[e].x),i.push(t[e].y)}class Re extends ot{constructor(t=new Gt([new k(0,.5),new k(-.5,-.5),new k(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const s=[],r=[],n=[],a=[];let o=0,h=0;if(Array.isArray(t)===!1)c(t);else for(let l=0;l<t.length;l++)c(t[l]),this.addGroup(o,h,l),o+=h,h=0;this.setIndex(s),this.setAttribute("position",new St(r,3)),this.setAttribute("normal",new St(n,3)),this.setAttribute("uv",new St(a,2));function c(l){const u=r.length/3,f=l.extractPoints(e);let p=f.shape;const d=f.holes;xe.isClockWise(p)===!1&&(p=p.reverse());for(let x=0,y=d.length;x<y;x++){const _=d[x];xe.isClockWise(_)===!0&&(d[x]=_.reverse())}const m=xe.triangulateShape(p,d);for(let x=0,y=d.length;x<y;x++){const _=d[x];p=p.concat(_)}for(let x=0,y=p.length;x<y;x++){const _=p[x];r.push(_.x,_.y,0),n.push(0,0,1),a.push(_.x,_.y)}for(let x=0,y=m.length;x<y;x++){const _=m[x],b=_[0]+u,w=_[1]+u,A=_[2]+u;s.push(b,w,A),h+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return Co(e,t)}static fromJSON(t,e){const s=[];for(let r=0,n=t.shapes.length;r<n;r++){const a=e[t.shapes[r]];s.push(a)}return new Re(s,t.curveSegments)}}function Co(i,t){if(t.shapes=[],Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const r=i[e];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return t}class Bo extends or{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}const Li={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class Do{constructor(t,e,s){const r=this;let n=!1,a=0,o=0,h;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s,this.itemStart=function(l){o++,n===!1&&r.onStart!==void 0&&r.onStart(l,a,o),n=!0},this.itemEnd=function(l){a++,r.onProgress!==void 0&&r.onProgress(l,a,o),a===o&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(l){r.onError!==void 0&&r.onError(l)},this.resolveURL=function(l){return h?h(l):l},this.setURLModifier=function(l){return h=l,this},this.addHandler=function(l,u){return c.push(l,u),this},this.removeHandler=function(l){const u=c.indexOf(l);return u!==-1&&c.splice(u,2),this},this.getHandler=function(l){for(let u=0,f=c.length;u<f;u+=2){const p=c[u],d=c[u+1];if(p.global&&(p.lastIndex=0),p.test(l))return d}return null}}}const Io=new Do;class gr{constructor(t){this.manager=t!==void 0?t:Io,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const s=this;return new Promise(function(r,n){s.load(t,r,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}gr.DEFAULT_MATERIAL_NAME="__DEFAULT";const Tt={};class Lo extends Error{constructor(t,e){super(t),this.response=e}}class Oo extends gr{constructor(t){super(t)}load(t,e,s,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=Li.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Tt[t]!==void 0){Tt[t].push({onLoad:e,onProgress:s,onError:r});return}Tt[t]=[],Tt[t].push({onLoad:e,onProgress:s,onError:r});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,h=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const l=Tt[t],u=c.body.getReader(),f=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=f?parseInt(f):0,d=p!==0;let m=0;const x=new ReadableStream({start(y){_();function _(){u.read().then(({done:b,value:w})=>{if(b)y.close();else{m+=w.byteLength;const A=new ProgressEvent("progress",{lengthComputable:d,loaded:m,total:p});for(let M=0,v=l.length;M<v;M++){const S=l[M];S.onProgress&&S.onProgress(A)}y.enqueue(w),_()}},b=>{y.error(b)})}}});return new Response(x)}else throw new Lo(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(h){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(l=>new DOMParser().parseFromString(l,o));case"json":return c.json();default:if(o===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(o),f=u&&u[1]?u[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(d=>p.decode(d))}}}).then(c=>{Li.add(t,c);const l=Tt[t];delete Tt[t];for(let u=0,f=l.length;u<f;u++){const p=l[u];p.onLoad&&p.onLoad(c)}}).catch(c=>{const l=Tt[t];if(l===void 0)throw this.manager.itemError(t),c;delete Tt[t];for(let u=0,f=l.length;u<f;u++){const p=l[u];p.onError&&p.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}const Oi=new Q;let $i=class{constructor(t,e,s=0,r=1/0){this.ray=new Zs(t,e),this.near=s,this.far=r,this.camera=null,this.layers=new ai,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Oi.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Oi),this}intersectObject(t,e=!0,s=[]){return br(t,this,s,e),s.sort(Ri),s}intersectObjects(t,e=!0,s=[]){for(let r=0,n=t.length;r<n;r++)br(t[r],this,s,e);return s.sort(Ri),s}};function Ri(i,t){return i.distance-t.distance}function br(i,t,e,s){let r=!0;if(i.layers.test(t.layers)&&i.raycast(t,e)===!1&&(r=!1),r===!0&&s===!0){const n=i.children;for(let a=0,o=n.length;a<o;a++)br(n[a],t,e,!0)}}class $o{constructor(){this.type="ShapePath",this.color=new le,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new mr,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,s,r){return this.currentPath.quadraticCurveTo(t,e,s,r),this}bezierCurveTo(t,e,s,r,n,a){return this.currentPath.bezierCurveTo(t,e,s,r,n,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(y){const _=[];for(let b=0,w=y.length;b<w;b++){const A=y[b],M=new Gt;M.curves=A.curves,_.push(M)}return _}function s(y,_){const b=_.length;let w=!1;for(let A=b-1,M=0;M<b;A=M++){let v=_[A],S=_[M],F=S.x-v.x,T=S.y-v.y;if(Math.abs(T)>Number.EPSILON){if(T<0&&(v=_[M],F=-F,S=_[A],T=-T),y.y<v.y||y.y>S.y)continue;if(y.y===v.y){if(y.x===v.x)return!0}else{const C=T*(y.x-v.x)-F*(y.y-v.y);if(C===0)return!0;if(C<0)continue;w=!w}}else{if(y.y!==v.y)continue;if(S.x<=y.x&&y.x<=v.x||v.x<=y.x&&y.x<=S.x)return!0}}return w}const r=xe.isClockWise,n=this.subPaths;if(n.length===0)return[];let a,o,h;const c=[];if(n.length===1)return o=n[0],h=new Gt,h.curves=o.curves,c.push(h),c;let l=!r(n[0].getPoints());l=t?!l:l;const u=[],f=[];let p=[],d=0,m;f[d]=void 0,p[d]=[];for(let y=0,_=n.length;y<_;y++)o=n[y],m=o.getPoints(),a=r(m),a=t?!a:a,a?(!l&&f[d]&&d++,f[d]={s:new Gt,p:m},f[d].s.curves=o.curves,l&&d++,p[d]=[]):p[d].push({h:o,p:m[0]});if(!f[0])return e(n);if(f.length>1){let y=!1,_=0;for(let b=0,w=f.length;b<w;b++)u[b]=[];for(let b=0,w=f.length;b<w;b++){const A=p[b];for(let M=0;M<A.length;M++){const v=A[M];let S=!0;for(let F=0;F<f.length;F++)s(v.p,f[F].p)&&(b!==F&&_++,S?(S=!1,u[F].push(v)):y=!0);S&&u[b].push(v)}}_>0&&y===!1&&(p=u)}let x;for(let y=0,_=f.length;y<_;y++){h=f[y].s,c.push(h),x=p[y];for(let b=0,w=x.length;b<w;b++)h.holes.push(x[b].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:J}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=J);class Ro extends gr{constructor(t){super(t)}load(t,e,s,r){const n=this,a=new Oo(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){const h=n.parse(JSON.parse(o));e&&e(h)},s,r)}parse(t){return new No(t)}}class No{constructor(t){this.isFont=!0,this.type="Font",this.data=t}generateShapes(t,e=100){const s=[],r=Ho(t,e,this.data);for(let n=0,a=r.length;n<a;n++)s.push(...r[n].toShapes());return s}}function Ho(i,t,e){const s=Array.from(i),r=t/e.resolution,n=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*r,a=[];let o=0,h=0;for(let c=0;c<s.length;c++){const l=s[c];if(l===`
`)o=0,h-=n;else{const u=Vo(l,r,o,h,e);o+=u.offsetX,a.push(u.path)}}return a}function Vo(i,t,e,s,r){const n=r.glyphs[i]||r.glyphs["?"];if(!n){console.error('THREE.Font: character "'+i+'" does not exists in font family '+r.familyName+".");return}const a=new $o;let o,h,c,l,u,f,p,d;if(n.o){const m=n._cachedOutline||(n._cachedOutline=n.o.split(" "));for(let x=0,y=m.length;x<y;)switch(m[x++]){case"m":o=m[x++]*t+e,h=m[x++]*t+s,a.moveTo(o,h);break;case"l":o=m[x++]*t+e,h=m[x++]*t+s,a.lineTo(o,h);break;case"q":c=m[x++]*t+e,l=m[x++]*t+s,u=m[x++]*t+e,f=m[x++]*t+s,a.quadraticCurveTo(u,f,c,l);break;case"b":c=m[x++]*t+e,l=m[x++]*t+s,u=m[x++]*t+e,f=m[x++]*t+s,p=m[x++]*t+e,d=m[x++]*t+s,a.bezierCurveTo(u,f,p,d,c,l);break}}return{offsetX:n.ha*t,path:a}}class O{}Jt(O,"cache",!0),Jt(O,"showFrozen",!1),Jt(O,"showLocked",!0),Jt(O,"paperSpace",0),Jt(O,"decimals",6),Jt(O,"onBeforeTextDraw",null);var Ni={},Hi=1;class jo{constructor(){this.cache=!0}_getCached(t){return t._cache&&O.cache?Ni[t._cache]:null}_setCache(t,e){t._cache="e"+Hi,Hi++,Ni[t._cache]=e}}var _r={};class wr{constructor(){}getMaterial(t,e,s){let r=this._getColorHex(t,s.layers),n=t.lineTypeName+e+r;if(_r[n])return _r[n];let a=e==="shape"?new Pe({side:2}):e==="line"?new or:this._createDashedMaterial(t,s.ltypes);return a.color.setHex(r),a.color.convertSRGBToLinear(),a.name=n,_r[n]=a,a}_createDashedMaterial(t,e){let s=4,r=4,n=t.lineTypeName&&Object.prototype.hasOwnProperty.call(e,t.lineTypeName)?e[t.lineTypeName]:null;return r=n.pattern&&n.pattern.length>0?Math.max(...n.pattern.map(a=>a.length)):4,s=n.pattern&&n.pattern.length>0?n.pattern.map(a=>a.length===-1).length:4,r=r===0?4:r,new Bo({gapSize:s,dashSize:r})}_getColorHex(t,e){let s=t.fillColor?t.fillColor:t.colorNumber;if(!s||s===0){let r=Object.prototype.hasOwnProperty.call(e,t.layer)?e[t.layer]:null;if(r)return r.color}return this.getColorByNumber(s)}getColorByNumber(t){switch(t){case 0:return 0;case 1:return 16711680;case 2:return 16776960;case 3:return 65280;case 4:return 65535;case 5:return 255;case 6:return 16711935;case 7:return 16777215;case 8:return 4276545;case 9:return 8421504;case 10:return 16711680;case 11:return 16755370;case 12:return 12386304;case 13:return 12418686;case 14:return 8454144;case 15:return 8476246;case 16:return 6815744;case 17:return 6833477;case 18:return 5177344;case 19:return 5190965;case 20:return 16727808;case 21:return 16760746;case 22:return 12398080;case 23:return 12422526;case 24:return 8462080;case 25:return 8478806;case 26:return 6822144;case 27:return 6835781;case 28:return 5182208;case 29:return 5192501;case 30:return 16744192;case 31:return 16766122;case 32:return 12410368;case 33:return 12426622;case 34:return 8470528;case 35:return 8481622;case 36:return 6829056;case 37:return 6837829;case 38:return 5187328;case 39:return 5194293;case 40:return 16760576;case 41:return 16771754;case 42:return 12422400;case 43:return 12430718;case 44:return 8478720;case 45:return 8484438;case 46:return 6835712;case 47:return 6840133;case 48:return 5192448;case 49:return 5196085;case 50:return 16776960;case 51:return 16777130;case 52:return 12434688;case 53:return 12434814;case 54:return 8487168;case 55:return 8487254;case 56:return 6842368;case 57:return 6842437;case 58:return 5197568;case 59:return 5197621;case 60:return 12582656;case 61:return 15400874;case 62:return 9288960;case 63:return 11386238;case 64:return 6324480;case 65:return 7766358;case 66:return 5138432;case 67:return 6252613;case 68:return 3886848;case 69:return 4804405;case 70:return 8388352;case 71:return 13959082;case 72:return 6208768;case 73:return 10337662;case 74:return 4227328;case 75:return 7045462;case 76:return 3434496;case 77:return 5662789;case 78:return 2576128;case 79:return 4345653;case 80:return 4194048;case 81:return 12582826;case 82:return 3063040;case 83:return 9289086;case 84:return 2064640;case 85:return 6324566;case 86:return 1665024;case 87:return 5138501;case 88:return 1265408;case 89:return 3886901;case 90:return 65280;case 91:return 11206570;case 92:return 48384;case 93:return 8306046;case 94:return 33024;case 95:return 5669206;case 96:return 26624;case 97:return 4548677;case 98:return 20224;case 99:return 3493685;case 100:return 65343;case 101:return 11206591;case 102:return 48430;case 103:return 8306061;case 104:return 33055;case 105:return 5669216;case 106:return 26649;case 107:return 4548686;case 108:return 20243;case 109:return 3493691;case 110:return 65407;case 111:return 11206612;case 112:return 48478;case 113:return 8306077;case 114:return 33088;case 115:return 5669227;case 116:return 26676;case 117:return 4548694;case 118:return 20263;case 119:return 3493698;case 120:return 65471;case 121:return 11206634;case 122:return 48525;case 123:return 8306093;case 124:return 33120;case 125:return 5669238;case 126:return 26702;case 127:return 4548703;case 128:return 20283;case 129:return 3493705;case 130:return 65535;case 131:return 11206655;case 132:return 48573;case 133:return 8306109;case 134:return 33153;case 135:return 5669249;case 136:return 26728;case 137:return 4548712;case 138:return 20303;case 139:return 3493711;case 140:return 49151;case 141:return 11201279;case 142:return 36285;case 143:return 8302013;case 144:return 24705;case 145:return 5666433;case 146:return 20072;case 147:return 4546408;case 148:return 15183;case 149:return 3492175;case 150:return 32767;case 151:return 11195647;case 152:return 24253;case 153:return 8297917;case 154:return 16513;case 155:return 5663617;case 156:return 13416;case 157:return 4544104;case 158:return 10063;case 159:return 3490383;case 160:return 16383;case 161:return 11190271;case 162:return 11965;case 163:return 8293821;case 164:return 8065;case 165:return 5660801;case 166:return 6504;case 167:return 4542056;case 168:return 4943;case 169:return 3488591;case 170:return 255;case 171:return 11184895;case 172:return 189;case 173:return 8289981;case 174:return 129;case 175:return 5658241;case 176:return 104;case 177:return 4539752;case 178:return 79;case 179:return 3487055;case 180:return 4129023;case 181:return 12561151;case 182:return 3014845;case 183:return 9273021;case 184:return 2031745;case 185:return 6313601;case 186:return 1638504;case 187:return 5129576;case 188:return 1245263;case 189:return 3880271;case 190:return 8323327;case 191:return 13937407;case 192:return 6160573;case 193:return 10321597;case 194:return 4194433;case 195:return 7034497;case 196:return 3407976;case 197:return 5653864;case 198:return 2555983;case 199:return 4339023;case 200:return 12517631;case 201:return 15379199;case 202:return 9240765;case 203:return 11370173;case 204:return 6291585;case 205:return 7755393;case 206:return 5111912;case 207:return 6243688;case 208:return 3866703;case 209:return 4797775;case 210:return 16711935;case 211:return 16755455;case 212:return 12386493;case 213:return 12418749;case 214:return 8454273;case 215:return 8476289;case 216:return 6815848;case 217:return 6833512;case 218:return 5177423;case 219:return 5190991;case 220:return 16711871;case 221:return 16755434;case 222:return 12386445;case 223:return 12418733;case 224:return 8454240;case 225:return 8476278;case 226:return 6815822;case 227:return 6833503;case 228:return 5177403;case 229:return 5190985;case 230:return 16711807;case 231:return 16755412;case 232:return 12386398;case 233:return 12418717;case 234:return 8454208;case 235:return 8476267;case 236:return 6815796;case 237:return 6833494;case 238:return 5177383;case 239:return 5190978;case 240:return 16711743;case 241:return 16755391;case 242:return 12386350;case 243:return 12418701;case 244:return 8454175;case 245:return 8476256;case 246:return 6815769;case 247:return 6833486;case 248:return 5177363;case 249:return 5190971;case 250:return 3355443;case 251:return 5263440;case 252:return 6908265;case 253:return 8553090;case 254:return 12500670;case 255:return 16777215}return 16777215}}class qo{constructor(){this.xAxis=new g(1,0,0),this.yAxis=new g(0,1,0),this.zAxis=new g(0,0,1)}generatePointIndex(t){let e=[];for(let s=1;s<t.length;s++)e.push(s-1),e.push(s);return e}fixMeshToDrawDashedLines(t){t.geometry.index&&(t.geometry=t.geometry.toNonIndexed()),t.computeLineDistances()}}class Vi{constructor(){}parse(t){const e={};let s=new wr;const r=Object.keys(t);for(let n=0;n<r.length;n++){const a=t[r[n]];e[r[n]]={name:a.name,lineTypeName:a.lineTypeName,lineWeightEnum:a.lineWeightEnum,color:s.getColorByNumber(a.colorNumber),visible:this.isVisible(a),flags:this.parseFlags(a.flags)}}return e}parseFlags(t){if(t===0)return[];let e=[];return t%2!==0&&e.push("frozen"),(4<=t&&t<16||t===20||t===36||t===52)&&e.push("locked"),16<=t&&t<64&&e.push("dependent"),e}isVisible(t){return!(t.colorNumber<0||typeof t.plot<"u"&&!t.plot)}}class Et extends jo{constructor(t){super(),this.data=t,this._colorHelper=new wr,this._geometryHelper=new qo,this._layerHelper=new Vi}_hideEntity(t){if(typeof t.visible<"u"&&!t.visible||typeof t.paperSpace<"u"&&O.showFrozen!==t.paperSpace||t.lineTypeName==="HIDDEN")return!0;let e=Object.prototype.hasOwnProperty.call(this.data.tables.layers,t.layer)?this.data.tables.layers[t.layer]:null;return!!(e&&(!e.visible||!O.showFrozen&&e.flags.includes("frozen")||!O.showLocked&&e.flags.includes("locked")))}_getBlock(t,e){for(let s=0;s<t.length;s++)if(t[s].name===e)return t[s];return null}}/**
 * @license
 * Credits to vagran (https://github.com/vagran/dxf-viewer) for the original code.
 */const $=Object.freeze({TEXT:0,ESCAPE:1,SKIP_FORMAT:2,PARAGRAPH1:3,PARAGRAPH2:4,PARAGRAPH3:5}),$t=Object.freeze({TEXT:0,SCOPE:1,PARAGRAPH:2,NON_BREAKING_SPACE:3,PARAGRAPH_ALIGNMENT:4}),Uo=new Set(["L","l","O","o","K","k","P","X","~"]),Go=new Set(["f","F","p","Q","H","W","S","A","C","T"]),Wo=new Set(["\\","{","}"]);class Ne{constructor(){this.entities=[]}Parse(t){const e=t.length;let s=0,r=$.TEXT,n=[],a=this.entities,o=0;const h=this;function c(){r!==$.TEXT||s===o||(a.push({type:$t.TEXT,content:t.slice(s,o)}),s=o)}function l(p){a.push({type:p})}function u(){const p={type:$t.SCOPE,content:[]};a.push(p),a=p.content,n.push(p)}function f(){n.length!==0&&(n.pop(),n.length===0?a=h.entities:a=n[n.length-1].content)}for(;o<e;o++){const p=t.charAt(o);switch(r){case $.TEXT:if(p==="{"){c(),u(),s=o+1;continue}if(p==="}"){c(),f(),s=o+1;continue}if(p==="\\"){c(),r=$.ESCAPE;continue}continue;case $.ESCAPE:if(Uo.has(p)){switch(p){case"P":l($t.PARAGRAPH);break;case"~":l($t.NON_BREAKING_SPACE);break}r=$.TEXT,s=o+1;continue}if(Go.has(p)){switch(p){case"p":r=$.PARAGRAPH1;continue}r=$.SKIP_FORMAT;continue}Wo.has(p)?s=o:s=o-1,r=$.TEXT;continue;case $.PARAGRAPH1:r=p==="x"?$.PARAGRAPH2:$.SKIP_FORMAT;continue;case $.PARAGRAPH2:r=p==="q"?$.PARAGRAPH3:$.SKIP_FORMAT;continue;case $.PARAGRAPH3:a.push({type:$t.PARAGRAPH_ALIGNMENT,alignment:p}),r=$.SKIP_FORMAT;continue;case $.SKIP_FORMAT:p===";"&&(s=o+1,r=$.TEXT);continue;default:throw new Error("Unhandled state")}}return c(),this}GetContent(){return this.entities}*GetText(){function*t(e){for(const s of e)s.type===$t.TEXT?yield s.content:s.type===$t.SCOPE&&(yield*t(s.content))}yield*t(this.GetContent())}}Ne.EntityType=$t;class vr extends Et{constructor(t,e){super(t),this._font=e,this._textParser=new Ne}draw(t){let e=t.entities.filter(r=>r.type==="MTEXT"||r.type==="TEXT"||r.type==="ATTRIB");if(e.length===0)return null;let s=new st;s.name="TEXTS";for(let r=0;r<e.length;r++){let n=e[r];if(this._hideEntity(n))continue;let a=this._getCached(n),o=null,h=null;if(a)o=a.geometry,h=a.material;else{let l=this.drawText(n);o=l.geometry,h=l.material,O.onBeforeTextDraw||this._setCache(n,l)}let c=new kt(o,h);c.userData={entity:n},s.add(c)}return s}drawText(t){if(t.type==="ATTRIB")return Object.keys(t.mtext).length!==0?this.drawText(t.mtext):this.drawText(t.text);let e=this._getTextGeometry(t);this._scaleText(e,t);let s=this._getPosAndRotation(t);s.rotation&&e.applyQuaternion(s.rotation),e.translate(s.pos.x,s.pos.y,s.pos.z),this._alignText(e,t,s.pos),this._translateCenter(e,t,s.pos);let r=this._colorHelper.getMaterial(t,"shape",this.data.tables);return{geometry:e,material:r}}_getTextGeometry(t){let s=this._getTextStrings(t).join("");if(O.onBeforeTextDraw){let a={text:s};O.onBeforeTextDraw(a),s=a.text}let r=this._getTextHeight(t),n=this._font.generateShapes(s,r);return new Re(n)}_getTextHeight(t){let e=12;return typeof t.nominalTextHeight<"u"?e=t.nominalTextHeight:typeof t.textHeight<"u"&&(e=t.textHeight),e}_scaleText(t,e){t.computeBoundingBox();let s=t.boundingBox.max.x-t.boundingBox.min.x,r=t.boundingBox.max.y-t.boundingBox.min.y,n=typeof e.horizontalWidth<"u"?e.horizontalWidth/s:1,a=typeof e.verticalHeight<"u"?e.verticalHeight/r:1;t.scale(n,a,1)}_getTextStrings(t){let e=n=>{let a=[];for(let o=0;o<n.length;o++){const h=n[o];if((h.type===Ne.EntityType.PARAGRAPH||h.type===Ne.EntityType.PARAGRAPH_ALIGNMENT)&&a.push(`
`),typeof h.content=="string")a.push(h.content);else if(h.content instanceof Array){let c=e(h.content);c&&a.push(c)}}return a},s=new Ne().Parse(t.string);return e(s.entities)}_getPosAndRotation(t){let e={pos:{x:0,y:0,z:0},rotation:null},s=t.x,r=t.y,n=t.z,a=t.rotation,o=t.xAxisX,h=t.xAxisY,c=t.xAxisZ,l=t.drawingDirection,u="0".repeat(O.decimals),f="0."+u,p="1."+u,d=typeof s<"u"?s.toFixed(O.decimals):f,m=typeof r<"u"?r.toFixed(O.decimals):f,x=typeof n<"u"?n.toFixed(O.decimals):f,y=d===p&&m===f&&x===f||d===f&&m===p&&x===f||d===f&&m===f&&x===p;return e.pos.x=y?o:s,e.pos.y=y?h:r,e.pos.z=y?c:n,a?e.rotation=new Vt().setFromAxisAngle(this._geometryHelper.zAxis,a*Math.PI/180):(l===3||y&&r===1||!y&&h===1)&&(e.rotation=new Vt().setFromAxisAngle(this._geometryHelper.zAxis,Math.PI/2)),e}_translateCenter(t,e,s){let r=e.attachmentPoint;if(!r)return;t.computeBoundingBox();let n=t.boundingBox.max.x-t.boundingBox.min.x,a=t.boundingBox.max.y-t.boundingBox.min.y,o=t.boundingBox.max.z-t.boundingBox.min.z,h={x:t.boundingBox.min.x+n/2,y:t.boundingBox.min.y+a/2};switch(r){case 1:t.translate(s.x-t.boundingBox.min.x,s.y-t.boundingBox.max.y,-.5*o);break;case 2:t.translate(s.x-h.x,s.y-t.boundingBox.max.y,-.5*o);break;case 3:t.translate(s.x-t.boundingBox.max.x,s.y-t.boundingBox.max.y,-.5*o);break;case 4:t.translate(s.x-t.boundingBox.min.x,s.y-h.y,-.5*o);break;case 5:t.translate(s.x-h.x,s.y-h.y,-.5*o);break;case 6:t.translate(s.x-t.boundingBox.max.x,s.y-h.y,-.5*o);break;case 7:t.translate(s.x-t.boundingBox.min.x,s.y-t.boundingBox.min.y,-.5*o);break;case 8:t.translate(s.x-h.x,t.boundingBox.min.y,-.5*o);break;case 9:t.translate(s.x-t.boundingBox.max.x,t.boundingBox.min.y,-.5*o);break}}_alignText(t,e,s){t.computeBoundingBox();let r=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,a={x:t.boundingBox.min.x+r/2,y:t.boundingBox.min.y+n/2},o=0,h=n;switch(e.hAlign){case 0:o=s.x-t.boundingBox.min.x;break;case 1:o=s.x-a.x;break;case 2:o=s.x-t.boundingBox.max.x;break}switch(e.vAlign){case 0:h=s.y-a.y;break;case 1:h=n/2;break;case 2:h=s.y-a.y;break;case 3:h=s.y-t.boundingBox.max.y;break}t.translate(o,h,0)}_replaceSpecialChars(t){return t.replaceAll("\\P",`
`).replaceAll("\\X",`
`).replaceAll("%%d","°").replaceAll("%%p","±").replaceAll("%%c","∅").replaceAll("%%%","%")}}var _s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ji={},N={},ws={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;function t(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(c){return typeof c}:t=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},t(o)}function e(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")}function s(o,h){for(var c=0;c<h.length;c++){var l=h[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,l.key,l)}}function r(o,h,c){return h&&s(o.prototype,h),o}var n=function(){function o(h,c){e(this,o),t(h)==="object"?(this.x=h.x,this.y=h.y):(this.x=h,this.y=c)}return r(o,[{key:"equals",value:function(c){return this.x===c.x&&this.y===c.y}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"neg",value:function(){return new o(-this.x,-this.y)}},{key:"add",value:function(c){return new o(this.x+c.x,this.y+c.y)}},{key:"sub",value:function(c){return new o(this.x-c.x,this.y-c.y)}},{key:"multiply",value:function(c){return new o(this.x*c,this.y*c)}},{key:"norm",value:function(){return this.multiply(1/this.length())}},{key:"dot",value:function(c){return this.x*c.x+this.y*c.y}}]),o}(),a=n;i.default=a})(ws);var He={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;function t(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(c){return typeof c}:t=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},t(o)}function e(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")}function s(o,h){for(var c=0;c<h.length;c++){var l=h[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,l.key,l)}}function r(o,h,c){return h&&s(o.prototype,h),o}var n=function(){function o(h,c,l){e(this,o),t(h)==="object"?(this.x=h.x,this.y=h.y,this.z=h.z):h===void 0?(this.x=0,this.y=0,this.z=0):(this.x=h,this.y=c,this.z=l)}return r(o,[{key:"equals",value:function(c,l){return l===void 0&&(l=0),Math.abs(this.x-c.x)<=l&&Math.abs(this.y-c.y)<=l&&Math.abs(this.z-c.z)<=l}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"neg",value:function(){return new o(-this.x,-this.y,-this.z)}},{key:"add",value:function(c){return new o(this.x+c.x,this.y+c.y,this.z+c.z)}},{key:"sub",value:function(c){return new o(this.x-c.x,this.y-c.y,this.z-c.z)}},{key:"multiply",value:function(c){return new o(this.x*c,this.y*c,this.z*c)}},{key:"norm",value:function(){return this.multiply(1/this.length())}},{key:"dot",value:function(c){return this.x*c.x+this.y*c.y+this.z*c.z}},{key:"cross",value:function(c){return new o(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x)}}]),o}(),a=n;i.default=a})(He);var qi={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=e(ws);function e(c){return c&&c.__esModule?c:{default:c}}function s(c){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function(u){return typeof u}:s=function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},s(c)}function r(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")}function n(c,l){for(var u=0;u<l.length;u++){var f=l[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}function a(c,l,u){return l&&n(c.prototype,l),c}var o=function(){function c(l,u){if(r(this,c),s(l)==="object"&&s(u)==="object"&&l.x!==void 0&&l.y!==void 0&&u.x!==void 0&&u.y!==void 0)this.min=new t.default(l),this.max=new t.default(u),this.valid=!0;else if(l===void 0&&u===void 0)this.min=new t.default(1/0,1/0),this.max=new t.default(-1/0,-1/0),this.valid=!1;else throw Error("Illegal construction - must use { x, y } objects")}return a(c,[{key:"equals",value:function(u){if(!this.valid)throw Error("Box2 is invalid");return this.min.equals(u.min)&&this.max.equals(u.max)}},{key:"expandByPoint",value:function(u){return this.min=new t.default(Math.min(this.min.x,u.x),Math.min(this.min.y,u.y)),this.max=new t.default(Math.max(this.max.x,u.x),Math.max(this.max.y,u.y)),this.valid=!0,this}},{key:"expandByPoints",value:function(u){var f=this;return u.forEach(function(p){f.expandByPoint(p)},this),this}},{key:"isPointInside",value:function(u){return u.x>=this.min.x&&u.y>=this.min.y&&u.x<=this.max.x&&u.y<=this.max.y}},{key:"width",get:function(){if(!this.valid)throw Error("Box2 is invalid");return this.max.x-this.min.x}},{key:"height",get:function(){if(!this.valid)throw Error("Box2 is invalid");return this.max.y-this.min.y}}]),c}();o.fromPoints=function(c){return new o().expandByPoints(c)};var h=o;i.default=h})(qi);var Ui={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=e(He);function e(c){return c&&c.__esModule?c:{default:c}}function s(c){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function(u){return typeof u}:s=function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},s(c)}function r(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")}function n(c,l){for(var u=0;u<l.length;u++){var f=l[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}function a(c,l,u){return l&&n(c.prototype,l),c}var o=function(){function c(l,u){if(r(this,c),s(l)==="object"&&s(u)==="object"&&l.x!==void 0&&l.y!==void 0&&l.z!==void 0&&u.x!==void 0&&u.y!==void 0&&u.z!==void 0)this.min=new t.default(l),this.max=new t.default(u),this.valid=!0;else if(l===void 0&&u===void 0)this.min=new t.default(1/0,1/0,1/0),this.max=new t.default(-1/0,-1/0,-1/0),this.valid=!1;else throw Error("Illegal construction - must use { x, y, z } objects")}return a(c,[{key:"equals",value:function(u){if(!this.valid)throw Error("Box3 is invalid");return this.min.equals(u.min)&&this.max.equals(u.max)}},{key:"expandByPoint",value:function(u){return this.min=new t.default(Math.min(this.min.x,u.x),Math.min(this.min.y,u.y),Math.min(this.min.z,u.z)),this.max=new t.default(Math.max(this.max.x,u.x),Math.max(this.max.y,u.y),Math.max(this.max.z,u.z)),this.valid=!0,this}},{key:"expandByPoints",value:function(u){var f=this;return u.forEach(function(p){f.expandByPoint(p)},this),this}},{key:"isPointInside",value:function(u){return u.x>=this.min.x&&u.y>=this.min.y&&u.z>=this.min.z&&u.x<=this.max.x&&u.y<=this.max.y&&u.z<=this.max.z}},{key:"width",get:function(){if(!this.valid)throw Error("Box3 is invalid");return this.max.x-this.min.x}},{key:"depth",get:function(){if(!this.valid)throw Error("Box3 is invalid");return this.max.y-this.min.y}},{key:"height",get:function(){if(!this.valid)throw Error("Box3 is invalid");return this.max.z-this.min.z}}]),c}();o.fromPoints=function(c){return new o().expandByPoints(c)};var h=o;i.default=h})(Ui);var Gi={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;function t(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function e(a,o){for(var h=0;h<o.length;h++){var c=o[h];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}}function s(a,o,h){return o&&e(a.prototype,o),a}var r=function(){function a(o,h,c,l){t(this,a),this.a=o,this.b=h,this.c=c,this.d=l}return s(a,[{key:"distanceToPoint",value:function(h){var c=(this.a*h.x+this.b*h.y+this.c*h.z+this.d)/Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);return c}},{key:"equals",value:function(h){return this.a===h.a&&this.b===h.b&&this.c===h.c&&this.d===h.d}},{key:"coPlanar",value:function(h){var c=this.a===h.a&&this.b===h.b&&this.c===h.c&&this.d===h.d,l=this.a===-h.a&&this.b===-h.b&&this.c===-h.c&&this.d===-h.d;return c||l}}]),a}();r.fromPointAndNormal=function(a,o){var h=o.x,c=o.y,l=o.z,u=-(a.x*h+a.y*c+a.z*l);return new r(o.x,o.y,o.z,u)},r.fromPoints=function(a){for(var o,h=0,c=a.length;h<c;++h){var l=a[(h+1)%c].sub(a[h]),u=a[(h+2)%c].sub(a[(h+1)%c]),f=l.cross(u);if(!(isNaN(f.length())||f.length()===0))if(!o)o=f.norm();else{var p=f.norm().equals(o,1e-6),d=f.neg().norm().equals(o,1e-6);if(!(p||d))throw Error("points not on a plane")}}if(!o)throw Error("points not on a plane");return r.fromPointAndNormal(a[0],o.norm())};var n=r;i.default=n})(Gi);var Wi={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=e(He);function e(h){return h&&h.__esModule?h:{default:h}}function s(h,c){if(!(h instanceof c))throw new TypeError("Cannot call a class as a function")}function r(h,c){for(var l=0;l<c.length;l++){var u=c[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(h,u.key,u)}}function n(h,c,l){return c&&r(h.prototype,c),h}var a=function(){function h(c,l,u,f){s(this,h),this.x=c,this.y=l,this.z=u,this.w=f}return n(h,[{key:"applyToVec3",value:function(l){var u=l.x,f=l.y,p=l.z,d=this.x,m=this.y,x=this.z,y=this.w,_=y*u+m*p-x*f,b=y*f+x*u-d*p,w=y*p+d*f-m*u,A=-d*u-m*f-x*p;return new t.default(_*y+A*-d+b*-x-w*-m,b*y+A*-m+w*-d-_*-x,w*y+A*-x+_*-m-b*-d)}}]),h}();a.fromAxisAngle=function(h,c){var l=h.norm(),u=c/2,f=Math.sin(u);return new a(l.x*f,l.y*f,l.z*f,Math.cos(u))};var o=a;i.default=o})(Wi);var Xi={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=e(ws);function e(p){return p&&p.__esModule?p:{default:p}}function s(p){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function(m){return typeof m}:s=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},s(p)}function r(p,d){if(!(p instanceof d))throw new TypeError("Cannot call a class as a function")}function n(p,d){for(var m=0;m<d.length;m++){var x=d[m];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(p,x.key,x)}}function a(p,d,m){return d&&n(p.prototype,d),p}var o=function(d,m,x){var y=d.x,_=d.y,b=m.x,w=m.y,A=x.x,M=x.y,v=(M-_)*(b-y),S=(w-_)*(A-y);return v>S+Number.EPSILON?1:v+Number.EPSILON<S?-1:0},h=function(d,m){var x=d.a,y=d.b,_=m.a,b=m.b;return o(x,_,b)!==o(y,_,b)&&o(x,y,_)!==o(x,y,b)},c=function(d,m){var x=d.a.x,y=d.b.x,_=d.a.y,b=d.b.y,w=m.a.x,A=m.b.x,M=m.a.y,v=m.b.y,S=x-y,F=w-A,T=_-b,C=M-v,rt=S*C-T*F,I=((x*b-_*y)*F-S*(w*v-M*A))/rt,it=((x*b-_*y)*C-T*(w*v-M*A))/rt;return isNaN(I)||isNaN(it)?null:new t.default(I,it)},l=function(d,m){return Math.sqrt(Math.pow(d.x-m.x,2)+Math.pow(d.y-m.y,2))},u=function(){function p(d,m){if(r(this,p),s(d)!=="object"||d.x===void 0||d.y===void 0)throw Error("expected first argument to have x and y properties");if(s(m)!=="object"||m.x===void 0||m.y===void 0)throw Error("expected second argument to have x and y properties");this.a=new t.default(d),this.b=new t.default(m)}return a(p,[{key:"length",value:function(){return this.a.sub(this.b).length()}},{key:"intersects",value:function(m){if(!(m instanceof p))throw new Error("expected argument to be an instance of vecks.Line2");return h(this,m)}},{key:"getIntersection",value:function(m){return this.intersects(m)?c(this,m):null}},{key:"containsPoint",value:function(m){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e-12;return Math.abs(l(this.a,this.b)-l(m,this.a)-l(m,this.b))<x}}]),p}(),f=u;i.default=f})(Xi);var Yi={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=e(He);function e(l){return l&&l.__esModule?l:{default:l}}function s(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function(f){return typeof f}:s=function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}function r(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}function n(l,u){for(var f=0;f<u.length;f++){var p=u[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}function a(l,u,f){return u&&n(l.prototype,u),l}var o=function(u,f){return Math.sqrt(Math.pow(u.x-f.x,2)+Math.pow(u.y-f.y,2)+Math.pow(u.z-f.z,2))},h=function(){function l(u,f){if(r(this,l),s(u)!=="object"||u.x===void 0||u.y===void 0||u.z===void 0)throw Error("expected first argument to have x, y and z properties");if(s(f)!=="object"||f.x===void 0||f.y===void 0||f.y===void 0)throw Error("expected second argument to have x, y and z properties");this.a=new t.default(u),this.b=new t.default(f)}return a(l,[{key:"length",value:function(){return this.a.sub(this.b).length()}},{key:"containsPoint",value:function(f){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e-12;return Math.abs(o(this.a,this.b)-o(f,this.a)-o(f,this.b))<p}}]),l}(),c=h;i.default=c})(Yi),function(i){Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"V2",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(i,"V3",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(i,"Box2",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(i,"Box3",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(i,"Plane3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(i,"Quaternion",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(i,"Line2",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(i,"Line3",{enumerable:!0,get:function(){return h.default}});var t=c(ws),e=c(He),s=c(qi),r=c(Ui),n=c(Gi),a=c(Wi),o=c(Xi),h=c(Yi);function c(l){return l&&l.__esModule?l:{default:l}}}(N),function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=N,e=function(r,n,a,o){o||(o=5);var h,c,l;a<0?(h=Math.atan(-a)*4,c=new t.V2(r[0],r[1]),l=new t.V2(n[0],n[1])):(h=Math.atan(a)*4,c=new t.V2(n[0],n[1]),l=new t.V2(r[0],r[1]));var u=l.sub(c),f=u.length(),p=c.add(u.multiply(.5)),d=Math.abs(f/2/Math.tan(h/2)),m=u.norm(),x;if(h<Math.PI){var y=new t.V2(m.x*Math.cos(Math.PI/2)-m.y*Math.sin(Math.PI/2),m.y*Math.cos(Math.PI/2)+m.x*Math.sin(Math.PI/2));x=p.add(y.multiply(-d))}else{var _=new t.V2(m.x*Math.cos(Math.PI/2)-m.y*Math.sin(Math.PI/2),m.y*Math.cos(Math.PI/2)+m.x*Math.sin(Math.PI/2));x=p.add(_.multiply(d))}var b=Math.atan2(l.y-x.y,l.x-x.x)/Math.PI*180,w=Math.atan2(c.y-x.y,c.x-x.x)/Math.PI*180;w<b&&(w+=360);for(var A=l.sub(x).length(),M=Math.floor(b/o)*o+o,v=Math.ceil(w/o)*o-o,S=[],F=M;F<=v;F+=o)S.push(x.add(new t.V2(Math.cos(F/180*Math.PI)*A,Math.sin(F/180*Math.PI)*A)));return a<0&&S.reverse(),S.map(function(T){return[T.x,T.y]})};i.default=e}(ji);const Xo=Mr(ji);class vs extends Et{constructor(t){super(t)}draw(t){let e=new st;e.name="LINES";let s=t.entities.filter(r=>r.type==="LINE"||r.type==="POLYLINE"||r.type==="LWPOLYLINE");if(s.length===0)return null;for(let r=0;r<s.length;r++){let n=s[r];if(this._hideEntity(n))continue;let a=this._getCached(n),o=null,h=null;if(a)o=a.geometry,h=a.material;else{let l=n.type==="LINE"?this.drawLine(n):this.drawPolyLine(n);o=l.geometry,h=l.material,this._setCache(n,l)}let c=new Ft(o,h);h.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(c),c.userData={entity:n},e.add(c)}return e}drawLine(t,e=1){let s="line";if(t.lineTypeName){let a=this.data.tables.ltypes[t.lineTypeName];a&&a.pattern.length>0&&(s="dashed")}let r=this._colorHelper.getMaterial(t,s,this.data.tables),n=new ot().setFromPoints([new g(e*t.start.x,t.start.y,t.start.z),new g(e*t.end.x,t.end.y,t.end.z)]);return n.setIndex(new X(new Uint16Array([0,1]),1)),{geometry:n,material:r}}drawPolyLine(t){let e="line";if(t.lineTypeName){let a=this.data.tables.ltypes[t.lineTypeName];a&&a.pattern.length>0&&(e="dashed")}let s=this._colorHelper.getMaterial(t,e,this.data.tables),r=this._getPolyLinePoints(t.vertices,t.closed),n=new ot().setFromPoints(r);return n.setIndex(new X(new Uint16Array(this._geometryHelper.generatePointIndex(r)),1)),{geometry:n,material:s}}_getPolyLinePoints(t,e,s=1){let r=[];for(let n=0,a=t.length;n<a-1;++n){let o=t[n],h=t[n+1],c=t[n].bulge,l=new g(o.x,o.y,o.z),u=new g(h.x,h.y,h.z);if(r.push(l),c){let f=Xo([l.x,l.y,l.z],[u.x,u.y,u.z],c);for(let p=0,d=f.length;p<d;++p){const m=f[p];r.push(new g(s*m[0],m[1],m.length>2?m[2]:0))}}n===a-2&&r.push(u)}return e&&r.push(r[0]),r}}class Ar extends Et{constructor(t){super(t)}draw(t){let e=t.entities.filter(r=>r.type==="SOLID");if(e.length===0)return null;let s=new st;s.name="SOLIDS";for(let r=0;r<e.length;r++){let n=e[r];if(this._hideEntity(n))continue;let a=this._getCached(n),o=null,h=null;if(a)o=a.geometry,h=a.material;else{let l=this.drawSolid(n);o=l.geometry,h=l.material,this._setCache(n,l)}let c=new kt(o,h);c.userData={entity:n},s.add(c)}return s}drawSolid(t){let e=this._colorHelper.getMaterial(t,"shape",this.data.tables),s=t.corners.map(a=>new g(a.x,a.y,a.z));s.splice(0,0,s.pop());const r=new Gt(s);let n=new Re(r);return this._extrusionTransform(t,n),{geometry:n,material:e}}_extrusionTransform(t,e){t.extrusionZ<0&&e.scale(-1,1,1)}}class Zi extends Et{constructor(t){super(t)}draw(t){let e=t.entities.filter(r=>r.type==="ARC"||r.type==="CIRCLE"||r.type==="ELLIPSE");if(e.length===0)return null;let s=new st;s.name="CIRCLES";for(let r=0;r<e.length;r++){let n=e[r];if(this._hideEntity(n))continue;let a=this._getCached(n),o=null,h=null;if(a)o=a.geometry,h=a.material;else{let l=n.type==="ELLIPSE"?this.drawEllipse(n):this.drawCircle(n);o=l.geometry,h=l.material,this._setCache(n,l)}let c=new Ft(o,h);h.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(c),c.userData={entity:n},s.add(c)}return s}drawCircle(t){let e="line";if(t.lineTypeName){let l=this.data.tables.ltypes[t.lineTypeName];l&&l.pattern.length>0&&(e="dashed")}let s=this._colorHelper.getMaterial(t,e,this.data.tables),r,n;if(t.type==="CIRCLE")r=t.startAngle||0,n=r+2*Math.PI;else if(r=t.startAngle,n=t.endAngle,t.extrusionZ<0){let l=this._rotateXY(t.startAngle,t.endAngle);r=l[1],n=l[0]}let o=new lr(0,0,t.r,r,n).getPoints(32);var h=new ot().setFromPoints(o);h.setIndex(new X(new Uint16Array(this._geometryHelper.generatePointIndex(o)),1));let c={x:t.center?t.center.x:t.x,y:t.center?t.center.y:t.y,z:t.center?t.center.z:t.z};return h.translate(t.extrusionZ<0?-c.x:c.x,c.y,c.z),{geometry:h,material:s}}drawEllipse(t){let e="line";if(t.lineTypeName){let u=this.data.tables.ltypes[t.lineTypeName];u&&u.pattern.length>0&&(e="dashed")}let s=this._colorHelper.getMaterial(t,e,this.data.tables),r=Math.sqrt(Math.pow(t.majorX,2)+Math.pow(t.majorY,2)),n=r*t.axisRatio,a=Math.atan2(t.majorY,t.majorX),o={x:t.center?t.center.x:t.x,y:t.center?t.center.y:t.y,z:t.center?t.center.z:t.z},c=new Be(o.x,o.y,r,n,t.startAngle,t.endAngle,!1,a).getPoints(32),l=new ot().setFromPoints(c);return l.setIndex(new X(new Uint16Array(this._geometryHelper.generatePointIndex(c)),1)),this._extrusionTransform(t,l,o),{geometry:l,material:s}}_extrusionTransform(t,e,s){t.extrusionZ<0&&(e.translate(-s.x,-s.y,-s.z),e.scale(-1,1,1),e.translate(s.x,s.y,s.z))}_rotateXY(t,e){const s=this._geometryHelper.xAxis.clone().applyAxisAngle(this._geometryHelper.zAxis,t),r=this._geometryHelper.xAxis.clone().applyAxisAngle(this._geometryHelper.zAxis,e);return s.applyAxisAngle(this._geometryHelper.yAxis,Math.PI),r.applyAxisAngle(this._geometryHelper.yAxis,Math.PI),[Math.atan2(s.y,s.x),Math.atan2(r.y,r.x)]}}var Ji={},Ki={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=function(s,r){return typeof r>"u"||+r==0?Math.round(s):(s=+s,r=+r,isNaN(s)||!(typeof r=="number"&&r%1===0)?NaN:(s=s.toString().split("e"),s=Math.round(+(s[0]+"e"+(s[1]?+s[1]-r:-r))),s=s.toString().split("e"),+(s[0]+"e"+(s[1]?+s[1]+r:r))))};i.default=t})(Ki),function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=e(Ki);function e(r){return r&&r.__esModule?r:{default:r}}var s=function(n,a,o,h,c){var l=o.length,u=o[0].length;if(n<0||n>1)throw new Error("t out of bounds [0,1]: "+n);if(a<1)throw new Error("degree must be at least 1 (linear)");if(a>l-1)throw new Error("degree must be less than or equal to point count - 1");if(!c){c=[];for(var f=0;f<l;f++)c[f]=1}if(h){if(h.length!==l+a+1)throw new Error("bad knot vector length")}else{h=[];for(var p=0;p<l+a+1;p++)h[p]=p}var d=[a,h.length-1-a],m=h[d[0]],x=h[d[1]];n=n*(x-m)+m,n=Math.max(n,m),n=Math.min(n,x);var y;for(y=d[0];y<d[1]&&!(n>=h[y]&&n<=h[y+1]);y++);for(var _=[],b=0;b<l;b++){_[b]=[];for(var w=0;w<u;w++)_[b][w]=o[b][w]*c[b];_[b][u]=c[b]}for(var A,M=1;M<=a+1;M++)for(var v=y;v>y-a-1+M;v--){A=(n-h[v])/(h[v+a+1-M]-h[v]);for(var S=0;S<u+1;S++)_[v][S]=(1-A)*_[v-1][S]+A*_[v][S]}for(var F=[],T=0;T<u;T++)F[T]=(0,t.default)(_[y][T]/_[y][u],-9);return F};i.default=s}(Ji);const Yo=Mr(Ji);class Sr extends Et{constructor(t){super(t)}draw(t){let e=t.entities.filter(r=>r.type==="SPLINE");if(e.length===0)return null;let s=new st;s.name="SPLINES";for(let r=0;r<e.length;r++){let n=e[r];if(this._hideEntity(n))continue;let a=this._getCached(n),o=null,h=null;if(a)o=a.geometry,h=a.material;else{let l=this.drawSpline(n);o=l.geometry,h=l.material,this._setCache(n,l)}let c=new Ft(o,h);h.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(c),c.userData={entity:n},s.add(c)}return s}drawSpline(t){let e="line";if(t.lineTypeName){let a=this.data.tables.ltypes[t.lineTypeName];a&&a.pattern.length>0&&(e="dashed")}let s=this._colorHelper.getMaterial(t,e,this.data.tables);var r=this.getBSplinePolyline(t.controlPoints,t.degree,t.knots,t.weights);let n=new ot().setFromPoints(r);return n.setIndex(new X(new Uint16Array(this._geometryHelper.generatePointIndex(r)),1)),{geometry:n,material:s}}getBSplinePolyline(t,e,s,r=null,n=25){const a=[],o=t.map(function(l){return[l.x,l.y]}),h=[s[e]],c=[s[e],s[s.length-1-e]];for(let l=e+1;l<s.length-e;++l)h[h.length-1]!==s[l]&&h.push(s[l]);for(let l=1;l<h.length;++l){const u=h[l-1],f=h[l];for(let p=0;p<=n;++p){let m=(p/n*(f-u)+u-c[0])/(c[1]-c[0]);m=Math.max(m,0),m=Math.min(m,1);const x=Yo(m,e,o,s,r);a.push(new g(x[0],x[1],0))}}return a}}class Qi extends Et{constructor(t,e){super(t),this._font=e,this._lineEntity=new vs(t),this._splineEntity=new Sr(t),this._patternHelper={dir:new g(0,1,0)}}draw(t){let e=new st;e.name="HATCHES";let s=t.entities.filter(r=>r.type==="HATCH");if(s.length===0)return null;for(let r=0;r<s.length;r++){let n=s[r];if(this._hideEntity(n))continue;let a=this._getCached(n),o=null,h=null;if(a)o=a.geometry,h=a.material;else{let c=this.drawHatch(n);o=c.geometry,h=c.material,this._setCache(n,c)}if(o){let c=new kt(o,h);c.userData={entity:n},c.renderOrder=n.fillType==="SOLID"?-1:0,c.position.z=n.fillType==="SOLID"?-.1:0,e.add(c)}}return e}drawHatch(t){let e=null,s=null;return this._calculatePoints(t),e=this._generateBoundary(t),t.fillType==="SOLID"?s=this._colorHelper.getMaterial(t,"shape",this.data.tables):t.fillType==="PATTERN"&&(s=this._getPatternMaterial(t)),e&&this._extrusionTransform(t,e),{geometry:e,material:s}}_calculatePoints(t){const e=t.boundary;for(let s=0;s<e.count;s++){const r=e.loops[s];for(let n=0;n<r.entities.length;n++){let a=r.entities[n];if(!(!a||!a.type))switch(a.type){case"LINE":this._getLinePoints(a);break;case"POLYLINE":this._getPolyLinePoints(a);break;case"ARC":this._getArcPoints(a,t);break;case"ELLIPSE":this._getEllipsePoints(a);break;case"SPLINE":this._getSplinePoints(a);break}}}}_getPatternMaterial(t){if(this.__cachedPatternMaterial)return this.__cachedPatternMaterial;const e=t.pattern;return this._patternHelper.dir.applyAxisAngle(new g(0,0,1),e.angle*Math.PI/180),this.__cachedPatternMaterial=new Pe,this.__cachedPatternMaterial.transparent=!0,this.__cachedPatternMaterial.color.setHex(this._colorHelper._getColorHex(t,this.data.tables.layers)),this.__cachedPatternMaterial.color.convertSRGBToLinear(),this.__cachedPatternMaterial.onBeforeCompile=s=>{s.vertexShader=`
			  varying vec4 vPos;
			  varying vec4 vCenter;
			  ${s.vertexShader}
			`.replace("#include <begin_vertex>",`
						#include <begin_vertex>
						vPos = modelMatrix * vec4(position, 1.);
						vCenter = modelMatrix * vec4(0);
			`),s.fragmentShader=`
			  #define ss(a, b, c) smoothstep(a, b, c)
			  varying vec4 vPos;
			  varying vec4 vCenter;
			  ${s.fragmentShader}
			`.replace("vec4 diffuseColor = vec4( diffuse, opacity );",`
			  vec3 col = diffuse;
			  vec3 dir = normalize(vec3(${this._patternHelper.dir.x}, ${this._patternHelper.dir.y}, 0.));
			  float dist = fract(dot(vPos.xyz * 2., dir));
			  float fw = length(fwidth(vPos.xy));
			  float line_size = 0.3;
			  float empty_size = 1.0 - line_size;
			  float f = ss(line_size - fw, line_size, dist) - ss(empty_size, empty_size + fw, dist);
			  col = mix(col , col * 0., f);
			  vec4 diffuseColor = vec4( col, opacity );
			  `)},this.__cachedPatternMaterial}_getLinePoints(t){t.points=[],t.points.push(new g(t.start.x,t.start.y,0)),t.points.push(new g(t.end.x,t.end.y,0))}_getPolyLinePoints(){}_getArcPoints(t,e){t.points=[];let s=t.startAngle*Math.PI/180,r=t.endAngle*Math.PI/180;if(!t.counterClockWise&&e.extrusionDir.z>0){const o=-s;s=-r,r=o}let a=new lr(t.center.x,t.center.y,t.radius,s,r,!1).getPoints(32);for(let o=0;o<a.length;o++)t.points.push(new g(a[o].x,a[o].y,0))}_getEllipsePoints(t){t.points=[];let e=t.startAngle*Math.PI/180,s=t.endAngle*Math.PI/180,n=new Be(t.center.x,t.center.y,t.major.x,t.major.y,e,s,!1,t.minor).getPoints(32);for(let a=0;a<n.length;a++)t.points.push(new g(n[a].x,n[a].y,0))}_getSplinePoints(t){t.points=this._splineEntity.getBSplinePolyline(t.controlPoints.points,t.degree,t.knots.knots,t.weights)}_generateBoundary(t){const e=t.boundary;this._calculateBoxes(e);const s=this._getBiggestLoop(e),r=e.loops.filter(o=>o!==s&&this._isLoopHole(o,t.style));if(this._mergeLoopPoints(s).length===0)return null;const a=new Gt;a.setFromPoints(this._mergeLoopPoints(s));for(let o=0;o<r.length;o++){const h=this._mergeLoopPoints(r[o]);if(h.length===0)continue;const c=new Gt;c.setFromPoints(h),a.holes.push(c)}return new Re(a)}_calculateBoxes(t){for(let e=0;e<t.loops.length;e++){const s=t.loops[e];s.box=this._getLoopBox(s)}}_getLoopBox(t){let e=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new g(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(let r=0;r<t.entities.length;r++){const n=t.entities[r];for(let a=0;a<n.points.length;a++){const o=n.points[a];e.min(o),s.max(o)}}return new bt(e,s)}_getBiggestLoop(t){if(t.loops.length===1)return t.loops[0];let e=t.loops[0],s=this._getLoopArea(e);for(let r=1;r<t.loops.length;r++){const n=t.loops[r],a=this._getLoopArea(n);a>s&&(e=n,s=a)}return e}_getLoopArea(t){let e=0;const s=t.box;return e=(s.max.x-s.min.x)*(s.max.y-s.min.y),e}_mergeLoopPoints(t){let e=[];const s=this._orderEntityPoints(t.entities);if(!s)return console.warn("loops with separated entities not supproted yet"),e;for(let r=0;r<s.length;r++){const n=s[r];if(n)if(n.type==="POLYLINE"){let a=this._lineEntity._getPolyLinePoints(n.points,n.closed);e=e.concat(a)}else{if(!n.points)continue;let a=e.length>0?e[e.length-1]:null;for(let o=0;o<n.points.length;o++){const h=n.points[o];o===0&&a&&a.x===h.x&&a.y===h.y||e.push(h)}}}return e}_orderEntityPoints(t){let e=[];e.push(t[0]);let s=e[0];for(;e.length<t.length;){let r=s.points[0],n=s.points[s.points.length-1];const a=e.length;for(let o=e.length;o<t.length;o++){const h=t[o];if(h){if(this._samePoints(n,h.points[0])){e.push(h),s=h;break}if(this._samePoints(n,h.points[h.points.length-1])){h.points.reverse(),e.push(h),s=h;break}if(this._samePoints(r,h.points[0])){for(let c=0;c<e.length;c++)e[c].points.reverse();e.push(h),s=h;break}if(this._samePoints(r,h.points[h.points.length-1])){for(let c=0;c<e.length;c++)e[c].points.reverse();h.points.reverse(),e.push(h),s=h;break}}}if(a===e.length)return null}return e}_samePoints(t,e){return t.distanceTo(e)<1e-4}_isLoopHole(t,e){return e===1?(t.type&16)===16&&(t.type&1)!==1:!0}_isLoopOuter(t){return(t.type&1)===1&&(t.type&16)!==16}_extrusionTransform(t,e){t.extrusionDir.z<0&&e&&e.scale(-1,1,1)}}function tn(i,t=!1){const e=i[0].index!==null,s=new Set(Object.keys(i[0].attributes)),r=new Set(Object.keys(i[0].morphAttributes)),n={},a={},o=i[0].morphTargetsRelative,h=new ot;let c=0;for(let l=0;l<i.length;++l){const u=i[l];let f=0;if(e!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+l+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in u.attributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+l+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;n[p]===void 0&&(n[p]=[]),n[p].push(u.attributes[p]),f++}if(f!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+l+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+l+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in u.morphAttributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+l+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(u.morphAttributes[p])}if(t){let p;if(e)p=u.index.count;else if(u.attributes.position!==void 0)p=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+l+". The geometry must have either an index or a position attribute"),null;h.addGroup(c,p,l),c+=p}}if(e){let l=0;const u=[];for(let f=0;f<i.length;++f){const p=i[f].index;for(let d=0;d<p.count;++d)u.push(p.getX(d)+l);l+=i[f].attributes.position.count}h.setIndex(u)}for(const l in n){const u=en(n[l]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+l+" attribute."),null;h.setAttribute(l,u)}for(const l in a){const u=a[l][0].length;if(u===0)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[l]=[];for(let f=0;f<u;++f){const p=[];for(let m=0;m<a[l].length;++m)p.push(a[l][m][f]);const d=en(p);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+l+" morphAttribute."),null;h.morphAttributes[l].push(d)}}return h}function en(i){let t,e,s,r=-1,n=0;for(let c=0;c<i.length;++c){const l=i[c];if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(e===void 0&&(e=l.itemSize),e!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=l.normalized),s!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=l.gpuType),r!==l.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;n+=l.count*e}const a=new t(n),o=new X(a,e,s);let h=0;for(let c=0;c<i.length;++c){const l=i[c];if(l.isInterleavedBufferAttribute){const u=h/e;for(let f=0,p=l.count;f<p;f++)for(let d=0;d<e;d++){const m=l.getComponent(f,d);o.setComponent(f+u,d,m)}}else a.set(l.array,h);h+=l.count*e}return r!==void 0&&(o.gpuType=r),o}class sn{constructor(){}merge(t,e=!0,s=[]){let{mesh:r,line:n}=this._getMergedObjects(t,e,s);if((r||n)&&t.userData&&t.userData.entity){let a=t.userData.entity.scaleX?t.userData.entity.scaleX:1,o=t.userData.entity.scaleY?t.userData.entity.scaleY:1,h=t.userData.entity.scaleZ?t.userData.entity.scaleZ:1;r&&(r.scale.set(a,o,h),t.userData.entity.rotation&&(r.rotation.z=t.userData.entity.rotation*Math.PI/180),r.position.set(t.userData.entity.x,t.userData.entity.y,t.userData.entity.z),t.add(r)),n&&(n.scale.set(a,o,h),t.userData.entity.rotation&&(n.rotation.z=t.userData.entity.rotation*Math.PI/180),n.position.set(t.userData.entity.x,t.userData.entity.y,t.userData.entity.z),t.add(n))}else r&&r.add(r),n&&t.add(n);return this._removeEmptyGroups(t),t}_getMergedObjects(t,e,s){let{mesh:r,line:n}=this._getMergedGeometry(t,e,s);const a=r.geometry?new kt(r.geometry,r.materials):null,o=n.geometry?new cr(n.geometry,n.materials):null;return a&&(a.userData={entities:r.userData,entity:t.userData.entity}),o&&(o.userData={entities:n.userData,entity:t.userData.entity}),{mesh:a,line:o}}_getMergedGeometry(t,e,s){let r=[],n=[],a=[],o=[],h=null;t.updateWorldMatrix(!1,!0);let c={};s.forEach(f=>c[f]=!0),this._removableTraverse(t,f=>{if(!(f.isMesh||f.isLineSegments||f.isLine)||s.length>0&&!c[f.uuid])return;let p=e?f.geometry.clone():f.geometry;if(p.applyMatrix4(f.matrixWorld),f.isMesh){p.index&&(p=p.toNonIndexed()),p.hasAttribute("normal")||p.computeVertexNormals();let x=p.getAttribute("uv");if(x||(x=new X(new Float32Array(p.attributes.position.count*2),2),p.setAttribute("uv",x)),p.attributes.uv.itemSize>2){let y=new X(new Float32Array(p.attributes.uv.count*2),2);for(let _=0;_<p.attributes.uv.count;_++)y.set(p.attributes.uv.getX(_),_*2),y.set(p.attributes.uv.getY(_),_*2+1);p.deleteAttribute("uv"),p.setAttribute("uv",y)}h=a}else f.geometry.index&&(f.geometry=f.geometry.toNonIndexed()),f.computeLineDistances(),p=f.geometry.clone(),p.applyMatrix4(f.matrixWorld),this._indexLineGeometry(p),p.deleteAttribute("uv"),p.deleteAttribute("normal"),h=o;h.push({uuid:f.uuid,userData:f.userData});let d=f.isMesh?r:n,m=this._findGroup(d,f.material);m||(m={material:f.material,geometries:[]},d.push(m)),m.geometries.push(p),p.ent=f,f.parent&&f.parent.remove(f)});let l=r.length>0?this._mergeByMaterial(r):null,u=n.length>0?this._mergeByMaterial(n):null;return{mesh:{geometry:l?l.geometry:null,materials:l?l.materials:null,userData:a},line:{geometry:u?u.geometry:null,materials:u?u.materials:null,userData:o}}}_mergeByMaterial(t){let e=t.map(r=>r.material);return{geometry:tn(t.map(r=>tn(r.geometries,!1)),!0),materials:e}}_removeEmptyGroups(t){for(let e=t.children.length-1;e>-1;e--){let s=t.children[e];this._removeEmptyGroups(s),s.isGroup&&s.children.length===0&&t.remove(s)}}_indexLineGeometry(t){let e=[],s=t.attributes.position.count;for(let r=0;r<s;r++)r>0&&(e.push(r-1),e.push(r));t.setIndex(new X(new Uint16Array(e),1))}_findGroup(t,e){for(let s=0;s<t.length;s++)if(t[s].material===e)return t[s];return null}_removableTraverse(t,e){for(let s=t.children.length-1;s>-1;s--)this._removableTraverse(t.children[s],e);e(t)}}class Zo extends sn{constructor(){super()}merge(t,e=!0,s=[]){let{mesh:r,line:n}=this._getMergedObjects(t,e,s);if((r||n)&&t.userData&&t.userData.entity){let a=t.userData.entity.scaleX?t.userData.entity.scaleX:1,o=t.userData.entity.scaleY?t.userData.entity.scaleY:1,h=t.userData.entity.scaleZ?t.userData.entity.scaleZ:1;r&&(r.scale.set(a,o,h),t.userData.entity.rotation&&(r.rotation.z=t.userData.entity.rotation*Math.PI/180),r.position.set(t.userData.entity.x,t.userData.entity.y,t.userData.entity.z),t.add(r)),n&&(n.scale.set(a,o,h),t.userData.entity.rotation&&(n.rotation.z=t.userData.entity.rotation*Math.PI/180),n.position.set(t.userData.entity.x,t.userData.entity.y,t.userData.entity.z),t.add(n))}else r&&r.add(r),n&&t.add(n);return this._removeEmptyGroups(t),t}_getMergedObjects(t,e,s){let{mesh:r,line:n}=this._getMergedGeometry(t,e,s);const a=r.geometry?new kt(r.geometry,r.materials):null,o=n.geometry?new cr(n.geometry,n.materials):null;return a&&(a.userData={entities:r.userData,entity:t.userData.entity}),o&&(o.userData={entities:n.userData,entity:t.userData.entity}),{mesh:a,line:o}}}class rn extends Et{constructor(t,e){super(t),this._font=e,this._lineEntity=new vs(t,e),this._textEntity=new vr(t,e),this._solidEntity=new Ar(t),this._circleEntity=new Zi(t),this._splineEntity=new Sr(t),this._hatchEntity=new Qi(t)}drawBlock(t,e=1){let s=new st;s.name="BLOCK",s.position.set(-t.x,-t.y,-t.z),s.userData={entity:t,entities:[]};for(let r=0;r<t.entities.length;r++){let n=t.entities[r];if(!this._hideEntity(n))switch(n.type){case"LINE":{let a=this._lineEntity.drawLine(n,e),o=new Ft(a.geometry,a.material);a.material.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(o),o.userData={entity:n},s.add(o)}break;case"POLYLINE":case"LWPOLYLINE":{let a=this._lineEntity.drawPolyLine(n,e),o=new Ft(a.geometry,a.material);a.material.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(o),o.userData={entity:n},s.add(o)}break;case"ARC":case"CIRCLE":{let a=this._circleEntity.drawCircle(n,e),o=new Ft(a.geometry,a.material);a.material.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(o),o.userData={entity:n},s.add(o)}break;case"ELLIPSE":{let a=this._circleEntity.drawEllipse(n,e),o=new Ft(a.geometry,a.material);a.material.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(o),o.userData={entity:n},s.add(o)}break;case"SPLINE":{let a=this._splineEntity.drawSpline(n,e),o=new Ft(a.geometry,a.material);a.material.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(o),o.userData={entity:n},s.add(o)}break;case"SOLID":{let a=this._solidEntity.drawSolid(n,e),o=new kt(a.geometry,a.material);o.userData={entity:n},s.add(o)}break;case"ATTRIB":case"TEXT":case"MTEXT":{let a=this._textEntity.drawText(n,e),o=new kt(a.geometry,a.material);o.userData={entity:n},s.add(o)}break;case"INSERT":{let a=n.blockObj?n.blockObj:this._getBlock(this.data.blocks,n.block);if(a&&a.entities.length>0&&!this._hideBlockEntity(a)){let o=new st;o.name="INSERT",o.add(this.drawBlock(a,e)),o.userData={entity:n};let h=n.scaleX?n.scaleX:1,c=n.scaleY?n.scaleY:1,l=n.scaleZ?n.scaleZ:1;o.scale.set(h,c,l),n.rotation&&(o.rotation.z=n.rotation*Math.PI/180),o.position.set(n.x,n.y,n.z),s.add(o)}}break;case"HATCH":{let a=this._hatchEntity.drawHatch(n,e);if(a.geometry){let o=n.fillType==="SOLID"?new kt(a.geometry,a.material):new cr(a.geometry,a.material);a.material.type==="LineDashedMaterial"&&this._geometryHelper.fixMeshToDrawDashedLines(o),o.userData={entity:n},o.renderOrder=n.fillType==="SOLID"?-1:0,o.position.z=n.fillType==="SOLID"?-.1:0,s.add(o)}}break;case"POINT":break;case"ATTDEF":break;case"DIMENSION":break;default:console.log("unknown entity type: "+n.type);break}}return this._mergeGroup(s),s}_rotate(t,e){!e||e===0||t.rotateOnAxis(this._geometryHelper.zAxis,e*Math.PI/180)}_hideBlockEntity(t){return t&&t.name.toLowerCase().startsWith("*paper_space")?!0:this._hideEntity(t)}_mergeGroup(t){const e=new Zo,s=a=>a.name==="BLOCK"||a.name==="INSERT"||a.name==="DIMENSION",r=[],n=[];for(let a=0;a<t.children.length;a++){const o=t.children[a];s(o)?r.push(o):n.push(o)}for(let a=0;a<r.length;a++)t.remove(r[a]);n.length>0&&(t.userData.entities=[],n.forEach(a=>t.userData.entities.push(a)),e.merge(t));for(let a=0;a<r.length;a++)t.add(r[a])}}class nn extends Et{constructor(t,e){super(t),this._font=e,this._blockEntity=new rn(t,e)}draw(t){this.data=t;let e=t.entities.filter(r=>r.type==="INSERT");if(e.length===0)return null;for(let r=0;r<e.length;r++){let n=e[r];if(typeof n.blockObj<"u")continue;let a=this._getBlock(this.data.blocks,n.block);a&&(n.blockObj=a)}let s=new st;s.name="INSERTS";for(let r=0;r<e.length;r++){let n=e[r];if(this._hideEntity(n))continue;let a=this.drawInsert(n);a&&s.add(a)}return s}drawInsert(t){let e=this._getCached(t);if(e)return e;let s=typeof t.scaleX<"u"?t.scaleX:1,r=typeof t.scaleY<"u"?t.scaleY:1,n=typeof t.scaleZ<"u"?t.scaleZ:1,a=t.blockObj?t.blockObj:this._getBlock(this.data.blocks,t.block),o=null;if(a&&!this._blockEntity._hideBlockEntity(a)){o=new st,o.name="INSERT",o.userData={entity:t};const h=t.extrusionZ<0?-1:1;o.add(this._blockEntity.drawBlock(a,h)),o.scale.set(s,r,n),t.rotation&&(o.rotation.z=h*(t.rotation*Math.PI/180)),o.position.set(h*t.x,t.y,t.z)}return this._setCache(t,o),o}}class Jo extends Et{constructor(t,e){super(t),this._font=e,this._lineEntity=new vs(t,e),this._textEntity=new vr(t,e),this._insertEntity=new nn(t,e),this._solidEntity=new Ar(t),this._blockEntity=new rn(t,e)}draw(t){let e=t.entities.filter(r=>r.type==="DIMENSION");if(e.length===0)return null;for(let r=0;r<e.length;r++){let n=e[r],a=this._getBlock(t.blocks,n.block);a&&(n.blockObj=a)}let s=new st;s.name="DIMENSIONS";for(let r=0;r<e.length;r++){let n=e[r];if(!n.blockObj)continue;let a=new st;a.name="DIMENSION",a.userData={entity:n};let o=this._blockEntity.drawBlock(n.blockObj);a.add(o),s.add(a)}return s}}function Ko(){}function Qo(){}function th(){console.error.apply(void 0,arguments)}const Rt={info:Ko,warn:Qo,error:th},eh=i=>{let t;const e={};return i.forEach(s=>{const r=s[0],n=s[1];switch(n){case"$MEASUREMENT":{t="measurement";break}case"$INSUNITS":{t="insUnits";break}case"$EXTMIN":e.extMin={},t="extMin";break;case"$EXTMAX":e.extMax={},t="extMax";break;case"$DIMASZ":e.dimArrowSize={},t="dimArrowSize";break;default:switch(t){case"extMin":case"extMax":{switch(r){case 10:e[t].x=n;break;case 20:e[t].y=n;break;case 30:e[t].z=n,t=void 0;break}break}case"measurement":case"insUnits":{switch(r){case 70:{e[t]=n,t=void 0;break}}break}case"dimArrowSize":{switch(r){case 40:{e[t]=n,t=void 0;break}}break}}}}),e},sh=i=>{let t=null,e=null;return i.reduce((s,r)=>{const n=r[0],a=r[1];switch(n){case 2:s.name=a;break;case 3:s.description=a;break;case 70:s.flag=a;break;case 72:s.alignment=a;break;case 73:s.elementCount=parseInt(a);break;case 40:s.patternLength=a;break;case 49:t=Object.create({scales:[],offset:[]}),t.length=a,s.pattern.push(t);break;case 74:t.shape=a;break;case 75:t.shapeNumber=a;break;case 340:t.styleHandle=a;break;case 46:t.scales.push(a);break;case 50:t.rotation=a;break;case 44:e=Object.create({x:a,y:0}),t.offset.push(e);break;case 45:e.y=a;break;case 9:t.text=a;break}return s},{type:"LTYPE",pattern:[]})},rh=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 2:t.name=r;break;case 6:t.lineTypeName=r;break;case 62:t.colorNumber=r;break;case 70:t.flags=r;break;case 290:t.plot=parseInt(r)!==0;break;case 370:t.lineWeightEnum=r;break}return t},{type:"LAYER"}),ih=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 2:t.name=r;break;case 6:t.lineTypeName=r;break;case 40:t.fixedTextHeight=r;break;case 41:t.widthFactor=r;break;case 50:t.obliqueAngle=r;break;case 71:t.flags=r;break;case 42:t.lastHeightUsed=r;break;case 3:t.primaryFontFileName=r;break;case 4:t.bigFontFileName=r;break}return t},{type:"STYLE"}),nh=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 2:t.name=r;break;case 5:t.handle=r;break;case 70:t.flags=r;break;case 10:t.lowerLeft.x=parseFloat(r);break;case 20:t.lowerLeft.y=parseFloat(r);break;case 11:t.upperRight.x=parseFloat(r);break;case 21:t.upperRight.y=parseFloat(r);break;case 12:t.center.x=parseFloat(r);break;case 22:t.center.y=parseFloat(r);break;case 14:t.snapSpacing.x=parseFloat(r);break;case 24:t.snapSpacing.y=parseFloat(r);break;case 15:t.gridSpacing.x=parseFloat(r);break;case 25:t.gridSpacing.y=parseFloat(r);break;case 16:t.direction.x=parseFloat(r);break;case 26:t.direction.y=parseFloat(r);break;case 36:t.direction.z=parseFloat(r);break;case 17:t.target.x=parseFloat(r);break;case 27:t.target.y=parseFloat(r);break;case 37:t.target.z=parseFloat(r);break;case 45:t.height=parseFloat(r);break;case 50:t.snapAngle=parseFloat(r);break;case 51:t.angle=parseFloat(r);break;case 110:t.x=parseFloat(r);break;case 120:t.y=parseFloat(r);break;case 130:t.z=parseFloat(r);break;case 111:t.xAxisX=parseFloat(r);break;case 121:t.xAxisY=parseFloat(r);break;case 131:t.xAxisZ=parseFloat(r);break;case 112:t.xAxisX=parseFloat(r);break;case 122:t.xAxisY=parseFloat(r);break;case 132:t.xAxisZ=parseFloat(r);break;case 146:t.elevation=parseFloat(r);break}return t},{type:"VPORT",center:{},lowerLeft:{},upperRight:{},snap:{},snapSpacing:{},gridSpacing:{},direction:{},target:{}}),Ms=(i,t,e)=>{const s=[];let r;return i.forEach(n=>{const a=n[0],o=n[1];(a===0||a===2)&&o===t?(r=[],s.push(r)):r.push(n)}),s.reduce((n,a)=>{const o=e(a);return o.name&&(n[o.name]=o),n},{})},ah=i=>{const t=[];let e;i.forEach(o=>{const h=o[1];h==="TABLE"?(e=[],t.push(e)):h==="ENDTAB"?t.push(e):e.push(o)});let s=[],r=[],n=[],a=[];return t.forEach(o=>{o[0][1]==="STYLE"?s=o:o[0][1]==="LTYPE"?a=o:o[0][1]==="LAYER"?r=o:o[0][1]==="VPORT"&&(n=o)}),{layers:Ms(r,"LAYER",rh),styles:Ms(s,"STYLE",ih),vports:Ms(n,"VPORT",nh),ltypes:Ms(a,"LTYPE",sh)}},H=(i,t)=>{switch(i){case 5:return{handle:t};case 6:return{lineTypeName:t};case 8:return{layer:t};case 48:return{lineTypeScale:t};case 60:return{visible:t===0};case 62:return{colorNumber:t};case 67:return t===0?{}:{paperSpace:t};case 68:return{viewportOn:t};case 69:return{viewport:t};case 210:return{extrusionX:t};case 220:return{extrusionY:t};case 230:return{extrusionZ:t};case 410:return{layout:t};default:return{}}},an="POINT",oh={TYPE:an,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.x=r;break;case 20:t.y=r;break;case 30:t.z=r;break;case 39:t.thickness=r;break;default:Object.assign(t,H(s,r));break}return t},{type:an})},on="LINE",hh={TYPE:on,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.start.x=r;break;case 20:t.start.y=r;break;case 30:t.start.z=r;break;case 39:t.thickness=r;break;case 11:t.end.x=r;break;case 21:t.end.y=r;break;case 31:t.end.z=r;break;default:Object.assign(t,H(s,r));break}return t},{type:on,start:{},end:{}})},hn="LWPOLYLINE",ch={TYPE:hn,process:i=>{let t;return i.reduce((e,s)=>{const r=s[0],n=s[1];switch(r){case 70:e.closed=(n&1)===1;break;case 10:t={x:n,y:0},e.vertices.push(t);break;case 20:t.y=n;break;case 39:e.thickness=n;break;case 42:t.bulge=n;break;default:Object.assign(e,H(r,n));break}return e},{type:hn,vertices:[]})}},cn="POLYLINE",lh={TYPE:cn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 70:t.closed=(r&1)===1,t.polygonMesh=(r&16)===16,t.polyfaceMesh=(r&64)===64;break;case 39:t.thickness=r;break;default:Object.assign(t,H(s,r));break}return t},{type:cn,vertices:[]})},uh="VERTEX",As=i=>{i.faces=i.faces||[],"x"in i&&!i.x&&delete i.x,"y"in i&&!i.y&&delete i.y,"z"in i&&!i.z&&delete i.z},fh={TYPE:uh,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.x=r;break;case 20:t.y=r;break;case 30:t.z=r;break;case 42:t.bulge=r;break;case 71:As(t),t.faces[0]=r;break;case 72:As(t),t.faces[1]=r;break;case 73:As(t),t.faces[2]=r;break;case 74:As(t),t.faces[3]=r;break}return t},{})},ln="CIRCLE",ph={TYPE:ln,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.x=r;break;case 20:t.y=r;break;case 30:t.z=r;break;case 40:t.r=r;break;default:Object.assign(t,H(s,r));break}return t},{type:ln})},un="ARC",dh={TYPE:un,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.x=r;break;case 20:t.y=r;break;case 30:t.z=r;break;case 39:t.thickness=r;break;case 40:t.r=r;break;case 50:t.startAngle=r/180*Math.PI;break;case 51:t.endAngle=r/180*Math.PI;break;default:Object.assign(t,H(s,r));break}return t},{type:un})},fn="ELLIPSE",mh={TYPE:fn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.x=r;break;case 11:t.majorX=r;break;case 20:t.y=r;break;case 21:t.majorY=r;break;case 30:t.z=r;break;case 31:t.majorZ=r;break;case 40:t.axisRatio=r;break;case 41:t.startAngle=r;break;case 42:t.endAngle=r;break;default:Object.assign(t,H(s,r));break}return t},{type:fn})},pn="SPLINE",xh={TYPE:pn,process:i=>{let t;return i.reduce((e,s)=>{const r=s[0],n=s[1];switch(r){case 10:t={x:n,y:0},e.controlPoints.push(t);break;case 20:t.y=n;break;case 30:t.z=n;break;case 40:e.knots.push(n);break;case 41:e.weights||(e.weights=[]),e.weights.push(n);break;case 42:e.knotTolerance=n;break;case 43:e.controlPointTolerance=n;break;case 44:e.fitTolerance=n;break;case 70:e.flag=n,e.closed=(n&1)===1;break;case 71:e.degree=n;break;case 72:e.numberOfKnots=n;break;case 73:e.numberOfControlPoints=n;break;case 74:e.numberOfFitPoints=n;break;default:Object.assign(e,H(r,n));break}return e},{type:pn,controlPoints:[],knots:[]})}},dn="SOLID",yh={TYPE:dn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.corners[0].x=r;break;case 20:t.corners[0].y=r;break;case 30:t.corners[0].z=r;break;case 11:t.corners[1].x=r;break;case 21:t.corners[1].y=r;break;case 31:t.corners[1].z=r;break;case 12:t.corners[2].x=r;break;case 22:t.corners[2].y=r;break;case 32:t.corners[2].z=r;break;case 13:t.corners[3].x=r;break;case 23:t.corners[3].y=r;break;case 33:t.corners[3].z=r;break;case 39:t.thickness=r;break;default:Object.assign(t,H(s,r));break}return t},{type:dn,corners:[{},{},{},{}]})},mn="HATCH";let Y="IDLE",E={},Pt=0,Nt=!1,ye=null,ht={references:[],entities:[]},Ss=null;const gh={TYPE:mn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 100:Y="IDLE";break;case 2:t.patternName=r;break;case 10:Y==="IDLE"?t.elevation.x=parseFloat(r):Y==="POLYLINE"?(Ss={x:parseFloat(r),y:0,bulge:0},ht.entities[0].points.push(Ss)):Y==="SEED"?(ye||(ye={x:0,y:0},t.seeds.seeds.push(ye)),ye.x=parseFloat(r)):Ve(s,Pt,parseFloat(r));break;case 20:Y==="IDLE"?t.elevation.y=parseFloat(r):Y==="POLYLINE"?Ss.y=parseFloat(r):Y==="SEED"?(ye.y=parseFloat(r),ye=null):Ve(s,Pt,parseFloat(r));break;case 30:t.elevation.z=parseFloat(r);break;case 63:t.fillColor=r;break;case 70:t.fillType=parseFloat(r)===1?"SOLID":"PATTERN";break;case 210:t.extrusionDir.x=parseFloat(r);break;case 220:t.extrusionDir.y=parseFloat(r);break;case 230:t.extrusionDir.z=parseFloat(r);break;case 91:t.boundary.count=parseFloat(r);break;case 92:if(ht={references:[],entities:[]},t.boundary.loops.push(ht),ht.type=parseFloat(r),Nt=(ht.type&2)===2,Nt){const n={type:"POLYLINE",points:[]};ht.entities.push(n),Y="POLYLINE"}break;case 93:Y==="IDLE"&&(Y="ENT"),ht.count=parseFloat(r);break;case 11:case 21:case 40:case 50:case 51:case 74:case 94:case 95:case 96:Pt===4&&(Y="SPLINE"),Ve(s,Pt,parseFloat(r));break;case 42:Nt?Ss.bulge=parseFloat(r):Ve(s,Pt,parseFloat(r));break;case 72:Pt=parseFloat(r),ht[Nt?"hasBulge":"edgeType"]=Pt,Nt||(E=bh(Pt),ht.entities.push(E));break;case 73:Y==="IDLE"||Nt?ht.entities[0].closed=r:Ve(s,Pt,parseFloat(r));break;case 75:Y="IDLE",t.style=parseFloat(r);break;case 76:t.hatchType=parseFloat(r);break;case 97:Y="IDLE",Nt=!1,ht.sourceObjects=parseFloat(r);break;case 98:Y="SEED",t.seeds.count=parseFloat(r);break;case 52:t.shadowPatternAngle=parseFloat(r);break;case 41:t.spacing=parseFloat(r);break;case 77:t.double=parseFloat(r)===1;break;case 78:t.pattern.lineCount=parseFloat(r);break;case 53:t.pattern.angle=parseFloat(r);break;case 43:t.pattern.x=parseFloat(r);break;case 44:t.pattern.y=parseFloat(r);break;case 45:t.pattern.offsetX=parseFloat(r);break;case 46:t.pattern.offsetY=parseFloat(r);break;case 79:t.pattern.dashCount=parseFloat(r);break;case 49:t.pattern.length.push(r);break;case 330:ht.references.push(r);break;case 450:t.solidOrGradient=parseFloat(r)===0?"SOLID":"GRADIENT";break;case 453:t.color.count=parseFloat(r);break;case 460:t.color.rotation=r;break;case 461:t.color.gradient=r;break;case 462:t.color.tint=r;break;default:Object.assign(t,H(s,r));break}return t},{type:mn,elevation:{},extrusionDir:{x:0,y:0,z:1},pattern:{length:[]},boundary:{loops:[]},seeds:{count:0,seeds:[]},color:{}})};function bh(i){if(Nt)return{};switch(i){case 1:return{type:"LINE",start:{x:0,y:0},end:{x:0,y:0}};case 2:return{type:"ARC",center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,counterClockWise:!1};case 3:return{type:"ELLIPSE",center:{x:0,y:0},startAngle:0,endAngle:0,counterClockWise:!1,major:{x:0,y:0},minor:0};case 4:return{type:"SPLINE",degree:0,rational:0,periodic:0,knots:{count:0,knots:[]},controlPoints:{count:0,points:[]},weights:1}}return{}}function Ve(i,t,e){switch(i){case 10:switch(t){case 1:E.start.x=e;break;case 2:E.center.x=e;break;case 3:E.center.x=e;break;case 4:E.controlPoints.points.push({x:e,y:0});break}break;case 20:{switch(t){case 1:E.start.y=e;break;case 2:E.center.y=e;break;case 3:E.center.y=e;break;case 4:E.controlPoints.points[E.controlPoints.points.length-1].y=e;break}break}case 11:switch(t){case 1:E.end.x=e;break;case 3:E.major.x=e;break}break;case 21:{switch(t){case 1:E.end.y=e;break;case 3:E.major.y=e;break}break}case 40:switch(t){case 2:E.radius=e;break;case 3:E.minor=e;break;case 4:E.knots.knots.push(e);break}break;case 42:switch(t){case 4:E.weights=e;break}break;case 50:switch(t){case 2:E.startAngle=e;break;case 3:E.startAngle=e;break}break;case 51:switch(t){case 2:E.endAngle=e;break;case 3:E.endAngle=e;break}break;case 73:switch(t){case 2:E.counterClockWise=parseFloat(e)===1;break;case 3:E.counterClockWise=parseFloat(e)===1;break;case 4:E.rational=e;break}break;case 74:switch(t){case 4:E.periodic=e;break}break;case 94:switch(t){case 4:E.degree=e;break}break;case 95:switch(t){case 4:E.knots.count=e;break}break;case 96:switch(t){case 4:E.controlPoints.count=e;break}break}}const xn="MTEXT",yn={10:"x",20:"y",30:"z",40:"nominalTextHeight",41:"refRectangleWidth",71:"attachmentPoint",72:"drawingDirection",7:"styleName",11:"xAxisX",21:"xAxisY",31:"xAxisZ",42:"horizontalWidth",43:"verticalHeight",73:"lineSpacingStyle",44:"lineSpacingFactor",90:"backgroundFill",420:"bgColorRGB0",421:"bgColorRGB1",422:"bgColorRGB2",423:"bgColorRGB3",424:"bgColorRGB4",425:"bgColorRGB5",426:"bgColorRGB6",427:"bgColorRGB7",428:"bgColorRGB8",429:"bgColorRGB9",430:"bgColorName0",431:"bgColorName1",432:"bgColorName2",433:"bgColorName3",434:"bgColorName4",435:"bgColorName5",436:"bgColorName6",437:"bgColorName7",438:"bgColorName8",439:"bgColorName9",45:"fillBoxStyle",63:"bgFillColor",441:"bgFillTransparency",75:"columnType",76:"columnCount",78:"columnFlowReversed",79:"columnAutoheight",48:"columnWidth",49:"columnGutter",50:"columnHeights"},_h=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];return D(t,s,r),t},{type:xn,string:""}),D=(i,t,e)=>(yn[t]!==void 0?i[yn[t]]=e:t===1||t===3?i.string+=e:t===50?(i.xAxisX=Math.cos(e),i.xAxisY=Math.sin(e)):Object.assign(i,H(t,e)),i),wh={TYPE:xn,process:_h,assign:D},gn="TEXT",bn={1:"string",10:"x",20:"y",30:"z",11:"x2",21:"y2",31:"z2",39:"thickness",40:"textHeight",41:"relScaleX",50:"rotation",51:"obliqueAngle",7:"styleName",71:"mirror",72:"hAlign",73:"vAlign"},vh=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];return Z(t,s,r),t},{type:gn,string:""}),Z=(i,t,e)=>{bn[t]!==void 0?i[bn[t]]=e:Object.assign(i,H(t,e))},Mh={TYPE:gn,process:vh,assign:Z},_n="ATTDEF",Ah=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];return kr(t,s,r),t},{type:_n,subclassMarker:"AcDbText",thickness:0,scaleX:1,mtext:{},text:{}}),kr=(i,t,e)=>{switch(t){case 100:{i.subclassMarker=e;break}case 1:switch(i.subclassMarker){case"AcDbText":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break}break;case 2:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.tag=e;break;case"AcDbXrecord":i.attdefFlag=e;break}break;case 3:switch(i.subclassMarker){case"AcDbAttributeDefinition":i.prompt=e;break;case"AcDbMText":D(i.mtext,t,e);break}break;case 7:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break}break;case 10:switch(i.subclassMarker){case"AcDbText":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break;case"AcDbXrecord":i.x=e;break}break;case 20:switch(i.subclassMarker){case"AcDbText":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break;case"AcDbXrecord":i.y=e;break}break;case 30:switch(i.subclassMarker){case"AcDbText":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break;case"AcDbXrecord":i.z=e;break}break;case 11:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.x2=e;break;case"AcDbMText":D(i.mtext,t,e);break}break;case 21:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.y2=e;break;case"AcDbMText":D(i.mtext,t,e);break}break;case 31:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.z2=e;break;case"AcDbMText":D(i.mtext,t,e);break}break;case 39:Z(i.text,t,e);break;case 40:switch(i.subclassMarker){case"AcDbText":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break;case"AcDbXrecord":i.annotationScale=e;break}break;case 41:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break}break;case 42:case 43:case 44:case 45:D(i.mtext,t,e);break;case 46:i.mtext.annotationHeight=e;break;case 48:case 49:D(i.mtext,t,e);break;case 50:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break}break;case 51:Z(i.text,t,e);break;case 63:D(i.mtext,t,e);break;case 70:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.attributeFlags=e;break;case"AcDbXrecord":typeof i.mTextFlag>"u"?i.mTextFlag=e:typeof i.isReallyLocked>"u"?i.isReallyLocked=e:i.secondaryAttdefCount=e;break}break;case 71:case 72:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":Z(i.text,t,e);break;case"AcDbMText":D(i.mtext,t,e);break}break;case 73:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.fieldLength=e;break;case"AcDbMText":D(i.mtext,t,e);break}break;case 74:Z(i.text,73,e);break;case 75:case 76:case 78:case 79:D(i.mtext,t,e);break;case 90:D(i.mtext,t,e);break;case 210:case 220:case 230:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":Z(i.mtext,t,e);break;case"AcDbMText":D(i.mtext,t,e);break}break;case 280:switch(i.subclassMarker){case"AcDbAttributeDefinition":case"AcDbAttribute":i.lock=e;break;case"AcDbXrecord":i.clone=!0;break}break;case 340:i.attdefHandle=e;break;case 420:case 421:case 422:case 423:case 424:case 425:case 426:case 427:case 428:case 429:case 430:case 431:case 432:case 433:case 434:case 435:case 436:case 437:case 438:case 439:case 441:D(i.mtext,t,e);break;default:Object.assign(i,H(t,e));break}},Sh={TYPE:_n,process:Ah,assign:kr},wn="ATTRIB",kh={TYPE:wn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];return kr(t,s,r),t},{type:wn,subclassMarker:"AcDbText",thickness:0,scaleX:1,mtext:{},text:{}})},vn="INSERT",Fh={TYPE:vn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 2:t.block=r;break;case 10:t.x=r;break;case 20:t.y=r;break;case 30:t.z=r;break;case 41:t.scaleX=r;break;case 42:t.scaleY=r;break;case 43:t.scaleZ=r;break;case 44:t.columnSpacing=r;break;case 45:t.rowSpacing=r;break;case 50:t.rotation=r;break;case 70:t.columnCount=r;break;case 71:t.rowCount=r;break;case 210:t.extrusionX=r;break;case 220:t.extrusionY=r;break;case 230:t.extrusionZ=r;break;default:Object.assign(t,H(s,r));break}return t},{type:vn})},Mn="3DFACE",Th={TYPE:Mn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 10:t.vertices[0].x=r;break;case 20:t.vertices[0].y=r;break;case 30:t.vertices[0].z=r;break;case 11:t.vertices[1].x=r;break;case 21:t.vertices[1].y=r;break;case 31:t.vertices[1].z=r;break;case 12:t.vertices[2].x=r;break;case 22:t.vertices[2].y=r;break;case 32:t.vertices[2].z=r;break;case 13:t.vertices[3].x=r;break;case 23:t.vertices[3].y=r;break;case 33:t.vertices[3].z=r;break;default:Object.assign(t,H(s,r));break}return t},{type:Mn,vertices:[{},{},{},{}]})},An="DIMENSION",Eh=i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 2:t.block=r;break;case 10:t.start.x=r;break;case 20:t.start.y=r;break;case 30:t.start.z=r;break;case 11:t.textMidpoint.x=r;break;case 21:t.textMidpoint.y=r;break;case 31:t.textMidpoint.z=r;break;case 13:t.measureStart.x=r;break;case 23:t.measureStart.y=r;break;case 33:t.measureStart.z=r;break;case 14:t.measureEnd.x=r;break;case 24:t.measureEnd.y=r;break;case 34:t.measureEnd.z=r;break;case 50:t.rotation=r;break;case 51:t.horizonRotation=r;break;case 52:t.extensionRotation=r;break;case 53:t.textRotation=r;break;case 70:{const n=Ph(r);n.ordinateType&&(t.ordinateType=!0),n.uniqueBlockReference&&(t.uniqueBlockReference=!0),n.userDefinedLocation&&(t.userDefinedLocation=!0),t.dimensionType=n.dimensionType;break}case 71:t.attachementPoint=r;break;case 210:t.extrudeDirection=t.extrudeDirection||{},t.extrudeDirection.x=r;break;case 220:t.extrudeDirection=t.extrudeDirection||{},t.extrudeDirection.y=r;break;case 230:t.extrudeDirection=t.extrudeDirection||{},t.extrudeDirection.z=r;break;default:Object.assign(t,H(s,r));break}return t},{type:An,start:{x:0,y:0,z:0},measureStart:{x:0,y:0,z:0},measureEnd:{x:0,y:0,z:0},textMidpoint:{x:0,y:0,z:0},attachementPoint:1,dimensionType:0});function Ph(i){let t=!1,e=!1,s=!1;if(i>6){const r=i-32,n=i-64,a=i-32-64,o=i-32-128,h=i-32-64-128;r>=0&&r<=6?(t=!0,i=r):n>=0&&n<=6?(e=!0,i=n):a>=0&&a<=6?(t=!0,e=!0,i=a):o>=0&&o<=6?(t=!0,s=!0,i=o):h>=0&&h<=6&&(t=!0,e=!0,s=!0,i=h)}return{dimensionType:i,uniqueBlockReference:t,ordinateType:e,userDefinedLocation:s}}const zh={TYPE:An,process:Eh},Sn="VIEWPORT",kn=[oh,hh,ch,lh,fh,ph,dh,mh,xh,yh,gh,wh,Sh,kh,Mh,Fh,zh,Th,{TYPE:Sn,process:i=>i.reduce((t,e)=>{const s=e[0],r=e[1];switch(s){case 1:t.layout=parseFloat(r);break;case 10:t.center.x=parseFloat(r);break;case 20:t.center.y=parseFloat(r);break;case 30:t.center.z=parseFloat(r);break;case 12:t.centerDCS.x=parseFloat(r);break;case 22:t.centerDCS.y=parseFloat(r);break;case 13:t.snap.x=parseFloat(r);break;case 23:t.snap.y=parseFloat(r);break;case 14:t.snapSpacing.x=parseFloat(r);break;case 24:t.snapSpacing.y=parseFloat(r);break;case 15:t.gridSpacing.x=parseFloat(r);break;case 25:t.gridSpacing.y=parseFloat(r);break;case 16:t.direction.x=parseFloat(r);break;case 26:t.direction.y=parseFloat(r);break;case 36:t.direction.z=parseFloat(r);break;case 17:t.target.x=parseFloat(r);break;case 27:t.target.y=parseFloat(r);break;case 37:t.target.z=parseFloat(r);break;case 40:t.width=parseFloat(r);break;case 41:t.height=parseFloat(r);break;case 50:t.snapAngle=parseFloat(r);break;case 51:t.angle=parseFloat(r);break;case 68:t.status=r;break;case 69:t.id=r;break;case 90:t.flags=r;break;case 110:t.x=parseFloat(r);break;case 120:t.y=parseFloat(r);break;case 130:t.z=parseFloat(r);break;case 111:t.xAxisX=parseFloat(r);break;case 121:t.xAxisY=parseFloat(r);break;case 131:t.xAxisZ=parseFloat(r);break;case 112:t.xAxisX=parseFloat(r);break;case 122:t.xAxisY=parseFloat(r);break;case 132:t.xAxisZ=parseFloat(r);break;case 146:t.elevation=parseFloat(r);break;case 281:t.render=r;break;default:Object.assign(t,H(s,r));break}return t},{type:Sn,center:{},centerDCS:{},snap:{},snapSpacing:{},gridSpacing:{},direction:{},target:{}})}].reduce((i,t)=>(i[t.TYPE]=t,i),{}),Fn=i=>{const t=[],e=[];let s;i.forEach(n=>{n[0]===0&&(s=[],e.push(s)),s.push(n)});let r;return e.forEach(n=>{const a=n[0][1],o=n.slice(1);if(kn[a]!==void 0){const h=kn[a].process(o);a==="POLYLINE"?(r=h,t.push(h)):a==="VERTEX"?r?r.vertices.push(h):Rt.error("ignoring invalid VERTEX entity"):a==="SEQEND"?r=void 0:t.push(h)}}),t},Ch=i=>{let t;const e=[];let s,r=[];return i.forEach(n=>{const a=n[0],o=n[1];if(o==="BLOCK")t="block",s={},r=[],e.push(s);else if(o==="ENDBLK")t==="entities"?s.entities=Fn(r):s.entities=[],r=void 0,t=void 0;else if(t==="block"&&a!==0)switch(a){case 1:s.xref=o;break;case 2:s.name=o;break;case 10:s.x=o;break;case 20:s.y=o;break;case 30:s.z=o;break;case 67:o!==0&&(s.paperSpace=o);break;case 410:s.layout=o;break}else t==="block"&&a===0?(t="entities",r.push(n)):t==="entities"&&r.push(n)}),e},Bh=i=>{let t;const e={layouts:[]};let s={};return i.forEach((r,n)=>{const a=r[0],o=r[1];if(a===0&&(t="IDLE"),o==="LAYOUT"&&(t="layout",s={},e.layouts.push(s)),t==="layout"&&a!==0)switch(a){case 100:o==="AcDbLayout"&&(t="AcDbLayout");break}if(t==="AcDbLayout"&&a!==0)switch(a){case 1:s.name=o;break;case 5:s.handle=o;break;case 10:s.minLimitX=parseFloat(o);break;case 20:s.minLimitY=parseFloat(o);break;case 11:s.maxLimitX=parseFloat(o);break;case 21:s.maxLimitY=parseFloat(o);break;case 12:s.x=parseFloat(o);break;case 22:s.y=parseFloat(o);break;case 32:s.z=parseFloat(o);break;case 14:s.minX=parseFloat(o);break;case 24:s.minY=parseFloat(o);break;case 34:s.minZ=parseFloat(o);break;case 15:s.maxX=parseFloat(o);break;case 25:s.maxY=parseFloat(o);break;case 35:s.maxZ=parseFloat(o);break;case 70:s.flag=o===1?"PSLTSCALE":"LIMCHECK";break;case 71:s.tabOrder=o;break;case 146:s.elevation=parseFloat(o);break;case 13:s.ucsX=parseFloat(o);break;case 23:s.ucsY=parseFloat(o);break;case 33:s.ucsZ=parseFloat(o);break;case 16:s.ucsXaxisX=parseFloat(o);break;case 26:s.ucsXaxisY=parseFloat(o);break;case 36:s.ucsXaxisZ=parseFloat(o);break;case 17:s.ucsYaxisX=parseFloat(o);break;case 27:s.ucsYaxisY=parseFloat(o);break;case 37:s.ucsYaxisZ=parseFloat(o);break;case 76:switch(o){case 0:s.ucsType="NOT ORTHOGRAPHIC";break;case 1:s.ucsType="TOP";break;case 2:s.ucsType="BOTTOM";break;case 3:s.ucsType="FRONT";break;case 4:s.ucsType="BACK";break;case 5:s.ucsType="LEFT";break;case 6:s.ucsType="RIGHT";break}break;case 330:s.tableRecord=o;break;case 331:s.lastActiveViewport=o;break;case 333:s.shadePlot=o;break}}),e},Dh=(i,t)=>i>=10&&i<60||i>=210&&i<240?parseFloat(t,10):i>=60&&i<100?parseInt(t,10):t,Ih=i=>{let t="type",e;const s=[];for(const r of i)t==="type"?(e=parseInt(r,10),t="value"):(s.push([e,Dh(e,r)]),t="type");return s},Lh=i=>{let t;return i.reduce((e,s)=>(s[0]===0&&s[1]==="SECTION"?t=[]:s[0]===0&&s[1]==="ENDSEC"?(e.push(t),t=void 0):t!==void 0&&t.push(s),e),[])},Oh=(i,t)=>{const e=t[0][1],s=t.slice(1);switch(e){case"HEADER":i.header=eh(s);break;case"TABLES":i.tables=ah(s);break;case"BLOCKS":i.blocks=Ch(s);break;case"ENTITIES":i.entities=Fn(s);break;case"OBJECTS":i.objects=Bh(s);break}return i},$h=i=>{const t=i.split(/\r\n|\r|\n/g),e=Ih(t);return Lh(e).reduce(Oh,{header:{},blocks:[],entities:[],objects:{layouts:[]},tables:{layers:{},styles:{},ltypes:{}}})};function Rh(){this.__data__=[],this.size=0}var Nh=Rh;function Hh(i,t){return i===t||i!==i&&t!==t}var Tn=Hh,Vh=Tn;function jh(i,t){for(var e=i.length;e--;)if(Vh(i[e][0],t))return e;return-1}var ks=jh,qh=ks,Uh=Array.prototype,Gh=Uh.splice;function Wh(i){var t=this.__data__,e=qh(t,i);if(e<0)return!1;var s=t.length-1;return e==s?t.pop():Gh.call(t,e,1),--this.size,!0}var Xh=Wh,Yh=ks;function Zh(i){var t=this.__data__,e=Yh(t,i);return e<0?void 0:t[e][1]}var Jh=Zh,Kh=ks;function Qh(i){return Kh(this.__data__,i)>-1}var tc=Qh,ec=ks;function sc(i,t){var e=this.__data__,s=ec(e,i);return s<0?(++this.size,e.push([i,t])):e[s][1]=t,this}var rc=sc,ic=Nh,nc=Xh,ac=Jh,oc=tc,hc=rc;function ge(i){var t=-1,e=i==null?0:i.length;for(this.clear();++t<e;){var s=i[t];this.set(s[0],s[1])}}ge.prototype.clear=ic,ge.prototype.delete=nc,ge.prototype.get=ac,ge.prototype.has=oc,ge.prototype.set=hc;var Fs=ge,cc=Fs;function lc(){this.__data__=new cc,this.size=0}var uc=lc;function fc(i){var t=this.__data__,e=t.delete(i);return this.size=t.size,e}var pc=fc;function dc(i){return this.__data__.get(i)}var mc=dc;function xc(i){return this.__data__.has(i)}var yc=xc,gc=typeof _s=="object"&&_s&&_s.Object===Object&&_s,En=gc,bc=En,_c=typeof self=="object"&&self&&self.Object===Object&&self,wc=bc||_c||Function("return this")(),xt=wc,vc=xt,Mc=vc.Symbol,Fr=Mc,Pn=Fr,zn=Object.prototype,Ac=zn.hasOwnProperty,Sc=zn.toString,je=Pn?Pn.toStringTag:void 0;function kc(i){var t=Ac.call(i,je),e=i[je];try{i[je]=void 0;var s=!0}catch{}var r=Sc.call(i);return s&&(t?i[je]=e:delete i[je]),r}var Fc=kc,Tc=Object.prototype,Ec=Tc.toString;function Pc(i){return Ec.call(i)}var zc=Pc,Cn=Fr,Cc=Fc,Bc=zc,Dc="[object Null]",Ic="[object Undefined]",Bn=Cn?Cn.toStringTag:void 0;function Lc(i){return i==null?i===void 0?Ic:Dc:Bn&&Bn in Object(i)?Cc(i):Bc(i)}var Ts=Lc;function Oc(i){var t=typeof i;return i!=null&&(t=="object"||t=="function")}var qe=Oc,$c=Ts,Rc=qe,Nc="[object AsyncFunction]",Hc="[object Function]",Vc="[object GeneratorFunction]",jc="[object Proxy]";function qc(i){if(!Rc(i))return!1;var t=$c(i);return t==Hc||t==Vc||t==Nc||t==jc}var Dn=qc,Uc=xt,Gc=Uc["__core-js_shared__"],Wc=Gc,Tr=Wc,In=function(){var i=/[^.]+$/.exec(Tr&&Tr.keys&&Tr.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function Xc(i){return!!In&&In in i}var Yc=Xc,Zc=Function.prototype,Jc=Zc.toString;function Kc(i){if(i!=null){try{return Jc.call(i)}catch{}try{return i+""}catch{}}return""}var Ln=Kc,Qc=Dn,tl=Yc,el=qe,sl=Ln,rl=/[\\^$.*+?()[\]{}|]/g,il=/^\[object .+?Constructor\]$/,nl=Function.prototype,al=Object.prototype,ol=nl.toString,hl=al.hasOwnProperty,cl=RegExp("^"+ol.call(hl).replace(rl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ll(i){if(!el(i)||tl(i))return!1;var t=Qc(i)?cl:il;return t.test(sl(i))}var ul=ll;function fl(i,t){return i==null?void 0:i[t]}var pl=fl,dl=ul,ml=pl;function xl(i,t){var e=ml(i,t);return dl(e)?e:void 0}var Xt=xl,yl=Xt,gl=xt,bl=yl(gl,"Map"),Er=bl,_l=Xt,wl=_l(Object,"create"),Es=wl,On=Es;function vl(){this.__data__=On?On(null):{},this.size=0}var Ml=vl;function Al(i){var t=this.has(i)&&delete this.__data__[i];return this.size-=t?1:0,t}var Sl=Al,kl=Es,Fl="__lodash_hash_undefined__",Tl=Object.prototype,El=Tl.hasOwnProperty;function Pl(i){var t=this.__data__;if(kl){var e=t[i];return e===Fl?void 0:e}return El.call(t,i)?t[i]:void 0}var zl=Pl,Cl=Es,Bl=Object.prototype,Dl=Bl.hasOwnProperty;function Il(i){var t=this.__data__;return Cl?t[i]!==void 0:Dl.call(t,i)}var Ll=Il,Ol=Es,$l="__lodash_hash_undefined__";function Rl(i,t){var e=this.__data__;return this.size+=this.has(i)?0:1,e[i]=Ol&&t===void 0?$l:t,this}var Nl=Rl,Hl=Ml,Vl=Sl,jl=zl,ql=Ll,Ul=Nl;function be(i){var t=-1,e=i==null?0:i.length;for(this.clear();++t<e;){var s=i[t];this.set(s[0],s[1])}}be.prototype.clear=Hl,be.prototype.delete=Vl,be.prototype.get=jl,be.prototype.has=ql,be.prototype.set=Ul;var Gl=be,$n=Gl,Wl=Fs,Xl=Er;function Yl(){this.size=0,this.__data__={hash:new $n,map:new(Xl||Wl),string:new $n}}var Zl=Yl;function Jl(i){var t=typeof i;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?i!=="__proto__":i===null}var Kl=Jl,Ql=Kl;function tu(i,t){var e=i.__data__;return Ql(t)?e[typeof t=="string"?"string":"hash"]:e.map}var Ps=tu,eu=Ps;function su(i){var t=eu(this,i).delete(i);return this.size-=t?1:0,t}var ru=su,iu=Ps;function nu(i){return iu(this,i).get(i)}var au=nu,ou=Ps;function hu(i){return ou(this,i).has(i)}var cu=hu,lu=Ps;function uu(i,t){var e=lu(this,i),s=e.size;return e.set(i,t),this.size+=e.size==s?0:1,this}var fu=uu,pu=Zl,du=ru,mu=au,xu=cu,yu=fu;function _e(i){var t=-1,e=i==null?0:i.length;for(this.clear();++t<e;){var s=i[t];this.set(s[0],s[1])}}_e.prototype.clear=pu,_e.prototype.delete=du,_e.prototype.get=mu,_e.prototype.has=xu,_e.prototype.set=yu;var gu=_e,bu=Fs,_u=Er,wu=gu,vu=200;function Mu(i,t){var e=this.__data__;if(e instanceof bu){var s=e.__data__;if(!_u||s.length<vu-1)return s.push([i,t]),this.size=++e.size,this;e=this.__data__=new wu(s)}return e.set(i,t),this.size=e.size,this}var Au=Mu,Su=Fs,ku=uc,Fu=pc,Tu=mc,Eu=yc,Pu=Au;function we(i){var t=this.__data__=new Su(i);this.size=t.size}we.prototype.clear=ku,we.prototype.delete=Fu,we.prototype.get=Tu,we.prototype.has=Eu,we.prototype.set=Pu;var zu=we;function Cu(i,t){for(var e=-1,s=i==null?0:i.length;++e<s&&t(i[e],e,i)!==!1;);return i}var Bu=Cu,Du=Xt,Iu=function(){try{var i=Du(Object,"defineProperty");return i({},"",{}),i}catch{}}(),Lu=Iu,Rn=Lu;function Ou(i,t,e){t=="__proto__"&&Rn?Rn(i,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):i[t]=e}var Nn=Ou,$u=Nn,Ru=Tn,Nu=Object.prototype,Hu=Nu.hasOwnProperty;function Vu(i,t,e){var s=i[t];(!(Hu.call(i,t)&&Ru(s,e))||e===void 0&&!(t in i))&&$u(i,t,e)}var Hn=Vu,ju=Hn,qu=Nn;function Uu(i,t,e,s){var r=!e;e||(e={});for(var n=-1,a=t.length;++n<a;){var o=t[n],h=s?s(e[o],i[o],o,e,i):void 0;h===void 0&&(h=i[o]),r?qu(e,o,h):ju(e,o,h)}return e}var zs=Uu;function Gu(i,t){for(var e=-1,s=Array(i);++e<i;)s[e]=t(e);return s}var Wu=Gu;function Xu(i){return i!=null&&typeof i=="object"}var Ue=Xu,Yu=Ts,Zu=Ue,Ju="[object Arguments]";function Ku(i){return Zu(i)&&Yu(i)==Ju}var Qu=Ku,Vn=Qu,tf=Ue,jn=Object.prototype,ef=jn.hasOwnProperty,sf=jn.propertyIsEnumerable,rf=Vn(function(){return arguments}())?Vn:function(i){return tf(i)&&ef.call(i,"callee")&&!sf.call(i,"callee")},nf=rf,af=Array.isArray,Pr=af,Cs={exports:{}};function of(){return!1}var hf=of;Cs.exports,function(i,t){var e=xt,s=hf,r=t&&!t.nodeType&&t,n=r&&!0&&i&&!i.nodeType&&i,a=n&&n.exports===r,o=a?e.Buffer:void 0,h=o?o.isBuffer:void 0,c=h||s;i.exports=c}(Cs,Cs.exports);var qn=Cs.exports,cf=9007199254740991,lf=/^(?:0|[1-9]\d*)$/;function uf(i,t){var e=typeof i;return t=t??cf,!!t&&(e=="number"||e!="symbol"&&lf.test(i))&&i>-1&&i%1==0&&i<t}var ff=uf,pf=9007199254740991;function df(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=pf}var Un=df,mf=Ts,xf=Un,yf=Ue,gf="[object Arguments]",bf="[object Array]",_f="[object Boolean]",wf="[object Date]",vf="[object Error]",Mf="[object Function]",Af="[object Map]",Sf="[object Number]",kf="[object Object]",Ff="[object RegExp]",Tf="[object Set]",Ef="[object String]",Pf="[object WeakMap]",zf="[object ArrayBuffer]",Cf="[object DataView]",Bf="[object Float32Array]",Df="[object Float64Array]",If="[object Int8Array]",Lf="[object Int16Array]",Of="[object Int32Array]",$f="[object Uint8Array]",Rf="[object Uint8ClampedArray]",Nf="[object Uint16Array]",Hf="[object Uint32Array]",z={};z[Bf]=z[Df]=z[If]=z[Lf]=z[Of]=z[$f]=z[Rf]=z[Nf]=z[Hf]=!0,z[gf]=z[bf]=z[zf]=z[_f]=z[Cf]=z[wf]=z[vf]=z[Mf]=z[Af]=z[Sf]=z[kf]=z[Ff]=z[Tf]=z[Ef]=z[Pf]=!1;function Vf(i){return yf(i)&&xf(i.length)&&!!z[mf(i)]}var jf=Vf;function qf(i){return function(t){return i(t)}}var zr=qf,Bs={exports:{}};Bs.exports,function(i,t){var e=En,s=t&&!t.nodeType&&t,r=s&&!0&&i&&!i.nodeType&&i,n=r&&r.exports===s,a=n&&e.process,o=function(){try{var h=r&&r.require&&r.require("util").types;return h||a&&a.binding&&a.binding("util")}catch{}}();i.exports=o}(Bs,Bs.exports);var Cr=Bs.exports,Uf=jf,Gf=zr,Gn=Cr,Wn=Gn&&Gn.isTypedArray,Wf=Wn?Gf(Wn):Uf,Xf=Wf,Yf=Wu,Zf=nf,Jf=Pr,Kf=qn,Qf=ff,tp=Xf,ep=Object.prototype,sp=ep.hasOwnProperty;function rp(i,t){var e=Jf(i),s=!e&&Zf(i),r=!e&&!s&&Kf(i),n=!e&&!s&&!r&&tp(i),a=e||s||r||n,o=a?Yf(i.length,String):[],h=o.length;for(var c in i)(t||sp.call(i,c))&&!(a&&(c=="length"||r&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Qf(c,h)))&&o.push(c);return o}var Xn=rp,ip=Object.prototype;function np(i){var t=i&&i.constructor,e=typeof t=="function"&&t.prototype||ip;return i===e}var Br=np;function ap(i,t){return function(e){return i(t(e))}}var Yn=ap,op=Yn,hp=op(Object.keys,Object),cp=hp,lp=Br,up=cp,fp=Object.prototype,pp=fp.hasOwnProperty;function dp(i){if(!lp(i))return up(i);var t=[];for(var e in Object(i))pp.call(i,e)&&e!="constructor"&&t.push(e);return t}var mp=dp,xp=Dn,yp=Un;function gp(i){return i!=null&&yp(i.length)&&!xp(i)}var Zn=gp,bp=Xn,_p=mp,wp=Zn;function vp(i){return wp(i)?bp(i):_p(i)}var Dr=vp,Mp=zs,Ap=Dr;function Sp(i,t){return i&&Mp(t,Ap(t),i)}var kp=Sp;function Fp(i){var t=[];if(i!=null)for(var e in Object(i))t.push(e);return t}var Tp=Fp,Ep=qe,Pp=Br,zp=Tp,Cp=Object.prototype,Bp=Cp.hasOwnProperty;function Dp(i){if(!Ep(i))return zp(i);var t=Pp(i),e=[];for(var s in i)s=="constructor"&&(t||!Bp.call(i,s))||e.push(s);return e}var Ip=Dp,Lp=Xn,Op=Ip,$p=Zn;function Rp(i){return $p(i)?Lp(i,!0):Op(i)}var Ir=Rp,Np=zs,Hp=Ir;function Vp(i,t){return i&&Np(t,Hp(t),i)}var jp=Vp,Ds={exports:{}};Ds.exports,function(i,t){var e=xt,s=t&&!t.nodeType&&t,r=s&&!0&&i&&!i.nodeType&&i,n=r&&r.exports===s,a=n?e.Buffer:void 0,o=a?a.allocUnsafe:void 0;function h(c,l){if(l)return c.slice();var u=c.length,f=o?o(u):new c.constructor(u);return c.copy(f),f}i.exports=h}(Ds,Ds.exports);var qp=Ds.exports;function Up(i,t){var e=-1,s=i.length;for(t||(t=Array(s));++e<s;)t[e]=i[e];return t}var Gp=Up;function Wp(i,t){for(var e=-1,s=i==null?0:i.length,r=0,n=[];++e<s;){var a=i[e];t(a,e,i)&&(n[r++]=a)}return n}var Xp=Wp;function Yp(){return[]}var Jn=Yp,Zp=Xp,Jp=Jn,Kp=Object.prototype,Qp=Kp.propertyIsEnumerable,Kn=Object.getOwnPropertySymbols,td=Kn?function(i){return i==null?[]:(i=Object(i),Zp(Kn(i),function(t){return Qp.call(i,t)}))}:Jp,Lr=td,ed=zs,sd=Lr;function rd(i,t){return ed(i,sd(i),t)}var id=rd;function nd(i,t){for(var e=-1,s=t.length,r=i.length;++e<s;)i[r+e]=t[e];return i}var Qn=nd,ad=Yn,od=ad(Object.getPrototypeOf,Object),ta=od,hd=Qn,cd=ta,ld=Lr,ud=Jn,fd=Object.getOwnPropertySymbols,pd=fd?function(i){for(var t=[];i;)hd(t,ld(i)),i=cd(i);return t}:ud,ea=pd,dd=zs,md=ea;function xd(i,t){return dd(i,md(i),t)}var yd=xd,gd=Qn,bd=Pr;function _d(i,t,e){var s=t(i);return bd(i)?s:gd(s,e(i))}var sa=_d,wd=sa,vd=Lr,Md=Dr;function Ad(i){return wd(i,Md,vd)}var Sd=Ad,kd=sa,Fd=ea,Td=Ir;function Ed(i){return kd(i,Td,Fd)}var Pd=Ed,zd=Xt,Cd=xt,Bd=zd(Cd,"DataView"),Dd=Bd,Id=Xt,Ld=xt,Od=Id(Ld,"Promise"),$d=Od,Rd=Xt,Nd=xt,Hd=Rd(Nd,"Set"),Vd=Hd,jd=Xt,qd=xt,Ud=jd(qd,"WeakMap"),Gd=Ud,Or=Dd,$r=Er,Rr=$d,Nr=Vd,Hr=Gd,ra=Ts,ve=Ln,ia="[object Map]",Wd="[object Object]",na="[object Promise]",aa="[object Set]",oa="[object WeakMap]",ha="[object DataView]",Xd=ve(Or),Yd=ve($r),Zd=ve(Rr),Jd=ve(Nr),Kd=ve(Hr),Yt=ra;(Or&&Yt(new Or(new ArrayBuffer(1)))!=ha||$r&&Yt(new $r)!=ia||Rr&&Yt(Rr.resolve())!=na||Nr&&Yt(new Nr)!=aa||Hr&&Yt(new Hr)!=oa)&&(Yt=function(i){var t=ra(i),e=t==Wd?i.constructor:void 0,s=e?ve(e):"";if(s)switch(s){case Xd:return ha;case Yd:return ia;case Zd:return na;case Jd:return aa;case Kd:return oa}return t});var Vr=Yt,Qd=Object.prototype,t0=Qd.hasOwnProperty;function e0(i){var t=i.length,e=new i.constructor(t);return t&&typeof i[0]=="string"&&t0.call(i,"index")&&(e.index=i.index,e.input=i.input),e}var s0=e0,r0=xt,i0=r0.Uint8Array,n0=i0,ca=n0;function a0(i){var t=new i.constructor(i.byteLength);return new ca(t).set(new ca(i)),t}var jr=a0,o0=jr;function h0(i,t){var e=t?o0(i.buffer):i.buffer;return new i.constructor(e,i.byteOffset,i.byteLength)}var c0=h0,l0=/\w*$/;function u0(i){var t=new i.constructor(i.source,l0.exec(i));return t.lastIndex=i.lastIndex,t}var f0=u0,la=Fr,ua=la?la.prototype:void 0,fa=ua?ua.valueOf:void 0;function p0(i){return fa?Object(fa.call(i)):{}}var d0=p0,m0=jr;function x0(i,t){var e=t?m0(i.buffer):i.buffer;return new i.constructor(e,i.byteOffset,i.length)}var y0=x0,g0=jr,b0=c0,_0=f0,w0=d0,v0=y0,M0="[object Boolean]",A0="[object Date]",S0="[object Map]",k0="[object Number]",F0="[object RegExp]",T0="[object Set]",E0="[object String]",P0="[object Symbol]",z0="[object ArrayBuffer]",C0="[object DataView]",B0="[object Float32Array]",D0="[object Float64Array]",I0="[object Int8Array]",L0="[object Int16Array]",O0="[object Int32Array]",$0="[object Uint8Array]",R0="[object Uint8ClampedArray]",N0="[object Uint16Array]",H0="[object Uint32Array]";function V0(i,t,e){var s=i.constructor;switch(t){case z0:return g0(i);case M0:case A0:return new s(+i);case C0:return b0(i,e);case B0:case D0:case I0:case L0:case O0:case $0:case R0:case N0:case H0:return v0(i,e);case S0:return new s;case k0:case E0:return new s(i);case F0:return _0(i);case T0:return new s;case P0:return w0(i)}}var j0=V0,q0=qe,pa=Object.create,U0=function(){function i(){}return function(t){if(!q0(t))return{};if(pa)return pa(t);i.prototype=t;var e=new i;return i.prototype=void 0,e}}(),G0=U0,W0=G0,X0=ta,Y0=Br;function Z0(i){return typeof i.constructor=="function"&&!Y0(i)?W0(X0(i)):{}}var J0=Z0,K0=Vr,Q0=Ue,tm="[object Map]";function em(i){return Q0(i)&&K0(i)==tm}var sm=em,rm=sm,im=zr,da=Cr,ma=da&&da.isMap,nm=ma?im(ma):rm,am=nm,om=Vr,hm=Ue,cm="[object Set]";function lm(i){return hm(i)&&om(i)==cm}var um=lm,fm=um,pm=zr,xa=Cr,ya=xa&&xa.isSet,dm=ya?pm(ya):fm,mm=dm,xm=zu,ym=Bu,gm=Hn,bm=kp,_m=jp,wm=qp,vm=Gp,Mm=id,Am=yd,Sm=Sd,km=Pd,Fm=Vr,Tm=s0,Em=j0,Pm=J0,zm=Pr,Cm=qn,Bm=am,Dm=qe,Im=mm,Lm=Dr,Om=Ir,$m=1,Rm=2,Nm=4,ga="[object Arguments]",Hm="[object Array]",Vm="[object Boolean]",jm="[object Date]",qm="[object Error]",ba="[object Function]",Um="[object GeneratorFunction]",Gm="[object Map]",Wm="[object Number]",_a="[object Object]",Xm="[object RegExp]",Ym="[object Set]",Zm="[object String]",Jm="[object Symbol]",Km="[object WeakMap]",Qm="[object ArrayBuffer]",tx="[object DataView]",ex="[object Float32Array]",sx="[object Float64Array]",rx="[object Int8Array]",ix="[object Int16Array]",nx="[object Int32Array]",ax="[object Uint8Array]",ox="[object Uint8ClampedArray]",hx="[object Uint16Array]",cx="[object Uint32Array]",P={};P[ga]=P[Hm]=P[Qm]=P[tx]=P[Vm]=P[jm]=P[ex]=P[sx]=P[rx]=P[ix]=P[nx]=P[Gm]=P[Wm]=P[_a]=P[Xm]=P[Ym]=P[Zm]=P[Jm]=P[ax]=P[ox]=P[hx]=P[cx]=!0,P[qm]=P[ba]=P[Km]=!1;function Is(i,t,e,s,r,n){var a,o=t&$m,h=t&Rm,c=t&Nm;if(e&&(a=r?e(i,s,r,n):e(i)),a!==void 0)return a;if(!Dm(i))return i;var l=zm(i);if(l){if(a=Tm(i),!o)return vm(i,a)}else{var u=Fm(i),f=u==ba||u==Um;if(Cm(i))return wm(i,o);if(u==_a||u==ga||f&&!r){if(a=h||f?{}:Pm(i),!o)return h?Am(i,_m(a,i)):Mm(i,bm(a,i))}else{if(!P[u])return r?i:{};a=Em(i,u,o)}}n||(n=new xm);var p=n.get(i);if(p)return p;n.set(i,a),Im(i)?i.forEach(function(x){a.add(Is(x,t,e,x,i,n))}):Bm(i)&&i.forEach(function(x,y){a.set(y,Is(x,t,e,y,i,n))});var d=c?h?km:Sm:h?Om:Lm,m=l?void 0:d(i);return ym(m||i,function(x,y){m&&(y=x,x=i[y]),gm(a,y,Is(x,t,e,y,i,n))}),a}var lx=Is,ux=lx,fx=1,px=4;function dx(i){return ux(i,fx|px)}var mx=dx;const wa=Mr(mx),qr=i=>{const t=i.blocks.reduce((s,r)=>(s[r.name]=r,s),{}),e=(s,r)=>{let n=[];return s.forEach(a=>{if(a.type==="INSERT"){const o=a,h=t[o.block];if(!h){Rt.error("no block found for insert. block:",o.block);return}const c=o.rowCount??1,l=o.columnCount??1,u=o.rowSpacing??0,f=o.columnSpacing??0,p=o.rotation??0;let d,m;if(c>1||l>1){const x=Math.cos(p*Math.PI/180),y=Math.sin(p*Math.PI/180);d={x:-y*u,y:x*u},m={x:x*f,y:y*f}}else d={x:0,y:0},m={x:0,y:0};for(let x=0;x<c;x++)for(let y=0;y<l;y++){const _={x:o.x+d.x*x+m.x*y,y:o.y+d.y*x+m.y*y,scaleX:o.scaleX,scaleY:o.scaleY,scaleZ:o.scaleZ,extrusionX:o.extrusionX,extrusionY:o.extrusionY,extrusionZ:o.extrusionZ,rotation:o.rotation},b=r.slice(0);b.push(_);const w=h.entities.map(A=>{const M=wa(A);switch(M.layer=o.layer,M.type){case"LINE":{M.start.x-=h.x,M.start.y-=h.y,M.end.x-=h.x,M.end.y-=h.y;break}case"LWPOLYLINE":case"POLYLINE":{M.vertices.forEach(v=>{v.x-=h.x,v.y-=h.y});break}case"CIRCLE":case"ELLIPSE":case"ARC":{M.x-=h.x,M.y-=h.y;break}case"SPLINE":{M.controlPoints.forEach(v=>{v.x-=h.x,v.y-=h.y});break}}return M});n=n.concat(e(w,b))}}else{const o=wa(a);o.transforms=r.slice().reverse(),n.push(o)}}),n};return e(i.entities,[])},xx=(i,t)=>typeof t>"u"||+t==0?Math.round(i):(i=+i,t=+t,isNaN(i)||!(typeof t=="number"&&t%1===0)?NaN:(i=i.toString().split("e"),i=Math.round(+(i[0]+"e"+(i[1]?+i[1]-t:-t))),i=i.toString().split("e"),+(i[0]+"e"+(i[1]?+i[1]+t:t)))),yx=(i,t,e,s,r)=>{const n=e.length,a=e[0].length;if(i<0||i>1)throw new Error("t out of bounds [0,1]: "+i);if(t<1)throw new Error("degree must be at least 1 (linear)");if(t>n-1)throw new Error("degree must be less than or equal to point count - 1");if(!r){r=[];for(let d=0;d<n;d++)r[d]=1}if(s){if(s.length!==n+t+1)throw new Error("bad knot vector length")}else{s=[];for(let d=0;d<n+t+1;d++)s[d]=d}const o=[t,s.length-1-t],h=s[o[0]],c=s[o[1]];i=i*(c-h)+h,i=Math.max(i,h),i=Math.min(i,c);let l;for(l=o[0];l<o[1]&&!(i>=s[l]&&i<=s[l+1]);l++);const u=[];for(let d=0;d<n;d++){u[d]=[];for(let m=0;m<a;m++)u[d][m]=e[d][m]*r[d];u[d][a]=r[d]}let f;for(let d=1;d<=t+1;d++)for(let m=l;m>l-t-1+d;m--){f=(i-s[m])/(s[m+t+1-d]-s[m]);for(let x=0;x<a+1;x++)u[m][x]=(1-f)*u[m-1][x]+f*u[m][x]}const p=[];for(let d=0;d<a;d++)p[d]=xx(u[l][d]/u[l][a],-9);return p},gx=(i,t,e,s)=>{s||(s=5);let r,n,a;e<0?(r=Math.atan(-e)*4,n=new N.V2(i[0],i[1]),a=new N.V2(t[0],t[1])):(r=Math.atan(e)*4,n=new N.V2(t[0],t[1]),a=new N.V2(i[0],i[1]));const o=a.sub(n),h=o.length(),c=n.add(o.multiply(.5)),l=Math.abs(h/2/Math.tan(r/2)),u=o.norm();let f;if(r<Math.PI){const b=new N.V2(u.x*Math.cos(Math.PI/2)-u.y*Math.sin(Math.PI/2),u.y*Math.cos(Math.PI/2)+u.x*Math.sin(Math.PI/2));f=c.add(b.multiply(-l))}else{const b=new N.V2(u.x*Math.cos(Math.PI/2)-u.y*Math.sin(Math.PI/2),u.y*Math.cos(Math.PI/2)+u.x*Math.sin(Math.PI/2));f=c.add(b.multiply(l))}const p=Math.atan2(a.y-f.y,a.x-f.x)/Math.PI*180;let d=Math.atan2(n.y-f.y,n.x-f.x)/Math.PI*180;d<p&&(d+=360);const m=a.sub(f).length(),x=Math.floor(p/s)*s+s,y=Math.ceil(d/s)*s-s,_=[];for(let b=x;b<=y;b+=s)_.push(f.add(new N.V2(Math.cos(b/180*Math.PI)*m,Math.sin(b/180*Math.PI)*m)));return e<0&&_.reverse(),_.map(b=>[b.x,b.y])},bx=(i,t)=>i.map(function(e){return[e[0]*Math.cos(t)-e[1]*Math.sin(t),e[1]*Math.cos(t)+e[0]*Math.sin(t)]}),Ur=(i,t,e,s,r,n,a)=>{n<r&&(n+=Math.PI*2);let o=[];const h=Math.PI*2/72,c=1e-6;for(let l=r;l<n-c;l+=h)o.push([Math.cos(l)*e,Math.sin(l)*s]);return o.push([Math.cos(n)*e,Math.sin(n)*s]),a&&(o=bx(o,a)),o=o.map(function(l){return[i+l[0],t+l[1]]}),o},_x=(i,t,e,s,r)=>{const n=[],a=i.map(function(c){return[c.x,c.y]}),o=[e[t]],h=[e[t],e[e.length-1-t]];for(let c=t+1;c<e.length-t;++c)o[o.length-1]!==e[c]&&o.push(e[c]);s=s||25;for(let c=1;c<o.length;++c){const l=o[c-1],u=o[c];for(let f=0;f<=s;++f){let d=(f/s*(u-l)+l-h[0])/(h[1]-h[0]);d=Math.max(d,0),d=Math.min(d,1);const m=yx(d,t,a,e,r);n.push(m)}}return n},wx=i=>{const t=[],e=[];for(const n of i.vertices)if(n.faces){const a={indices:[],hiddens:[]};for(const o of n.faces){if(o===0)break;a.indices.push(o<0?-o-1:o-1),a.hiddens.push(o<0)}[3,4].includes(a.indices.length)&&e.push(a)}else t.push({x:n.x,y:n.y});const s=[],r=(n,a)=>{for(const o of s)if(o.slice(-1)[0]===n)return o.push(a);s.push([n,a])};for(const n of e)for(let a=0;a<n.indices.length;a++){if(n.hiddens[a])continue;const o=(a+1)%n.indices.length;r(n.indices[a],n.indices[o])}for(const n of s)for(const a of s)if(n!==a&&n[0]===a.slice(-1)[0]){a.push(...n.slice(1)),n.splice(0,n.length);break}return s.filter(n=>n.length).map(n=>n.map(a=>t[a]).map(a=>[a.x,a.y]))},va=(i,t)=>{t=t||{};let e;if(i.type==="LINE"&&(e=[[i.start.x,i.start.y],[i.end.x,i.end.y]]),i.type==="LWPOLYLINE"||i.type==="POLYLINE"){if(e=[],i.polyfaceMesh)e.push(...wx(i)[0]);else if(!i.polygonMesh){if(i.vertices.length){i.closed&&(i.vertices=i.vertices.concat(i.vertices[0]));for(let s=0,r=i.vertices.length;s<r-1;++s){const n=[i.vertices[s].x,i.vertices[s].y],a=[i.vertices[s+1].x,i.vertices[s+1].y];e.push(n),i.vertices[s].bulge&&(e=e.concat(gx(n,a,i.vertices[s].bulge))),s===r-2&&e.push(a)}}}}if(i.type==="CIRCLE"&&(e=Ur(i.x,i.y,i.r,i.r,0,Math.PI*2),i.extrusionZ===-1&&(e=e.map(function(s){return[-s[0],s[1]]}))),i.type==="ELLIPSE"){const s=Math.sqrt(i.majorX*i.majorX+i.majorY*i.majorY),r=i.axisRatio*s,n=-Math.atan2(-i.majorY,i.majorX);e=Ur(i.x,i.y,s,r,i.startAngle,i.endAngle,n),i.extrusionZ===-1&&(e=e.map(function(a){return[-a[0],a[1]]}))}return i.type==="ARC"&&(e=Ur(i.x,i.y,i.r,i.r,i.startAngle,i.endAngle,void 0),i.extrusionZ===-1&&(e=e.map(function(s){return[-s[0],s[1]]}))),i.type==="SPLINE"&&(e=_x(i.controlPoints,i.degree,i.knots,t.interpolationsPerSplineSegment,i.weights)),e||(Rt.warn("unsupported entity for converting to polyline:",i.type),[])},Ma=[[0,0,0],[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,255,255],[65,65,65],[128,128,128],[255,0,0],[255,170,170],[189,0,0],[189,126,126],[129,0,0],[129,86,86],[104,0,0],[104,69,69],[79,0,0],[79,53,53],[255,63,0],[255,191,170],[189,46,0],[189,141,126],[129,31,0],[129,96,86],[104,25,0],[104,78,69],[79,19,0],[79,59,53],[255,127,0],[255,212,170],[189,94,0],[189,157,126],[129,64,0],[129,107,86],[104,52,0],[104,86,69],[79,39,0],[79,66,53],[255,191,0],[255,234,170],[189,141,0],[189,173,126],[129,96,0],[129,118,86],[104,78,0],[104,95,69],[79,59,0],[79,73,53],[255,255,0],[255,255,170],[189,189,0],[189,189,126],[129,129,0],[129,129,86],[104,104,0],[104,104,69],[79,79,0],[79,79,53],[191,255,0],[234,255,170],[141,189,0],[173,189,126],[96,129,0],[118,129,86],[78,104,0],[95,104,69],[59,79,0],[73,79,53],[127,255,0],[212,255,170],[94,189,0],[157,189,126],[64,129,0],[107,129,86],[52,104,0],[86,104,69],[39,79,0],[66,79,53],[63,255,0],[191,255,170],[46,189,0],[141,189,126],[31,129,0],[96,129,86],[25,104,0],[78,104,69],[19,79,0],[59,79,53],[0,255,0],[170,255,170],[0,189,0],[126,189,126],[0,129,0],[86,129,86],[0,104,0],[69,104,69],[0,79,0],[53,79,53],[0,255,63],[170,255,191],[0,189,46],[126,189,141],[0,129,31],[86,129,96],[0,104,25],[69,104,78],[0,79,19],[53,79,59],[0,255,127],[170,255,212],[0,189,94],[126,189,157],[0,129,64],[86,129,107],[0,104,52],[69,104,86],[0,79,39],[53,79,66],[0,255,191],[170,255,234],[0,189,141],[126,189,173],[0,129,96],[86,129,118],[0,104,78],[69,104,95],[0,79,59],[53,79,73],[0,255,255],[170,255,255],[0,189,189],[126,189,189],[0,129,129],[86,129,129],[0,104,104],[69,104,104],[0,79,79],[53,79,79],[0,191,255],[170,234,255],[0,141,189],[126,173,189],[0,96,129],[86,118,129],[0,78,104],[69,95,104],[0,59,79],[53,73,79],[0,127,255],[170,212,255],[0,94,189],[126,157,189],[0,64,129],[86,107,129],[0,52,104],[69,86,104],[0,39,79],[53,66,79],[0,63,255],[170,191,255],[0,46,189],[126,141,189],[0,31,129],[86,96,129],[0,25,104],[69,78,104],[0,19,79],[53,59,79],[0,0,255],[170,170,255],[0,0,189],[126,126,189],[0,0,129],[86,86,129],[0,0,104],[69,69,104],[0,0,79],[53,53,79],[63,0,255],[191,170,255],[46,0,189],[141,126,189],[31,0,129],[96,86,129],[25,0,104],[78,69,104],[19,0,79],[59,53,79],[127,0,255],[212,170,255],[94,0,189],[157,126,189],[64,0,129],[107,86,129],[52,0,104],[86,69,104],[39,0,79],[66,53,79],[191,0,255],[234,170,255],[141,0,189],[173,126,189],[96,0,129],[118,86,129],[78,0,104],[95,69,104],[59,0,79],[73,53,79],[255,0,255],[255,170,255],[189,0,189],[189,126,189],[129,0,129],[129,86,129],[104,0,104],[104,69,104],[79,0,79],[79,53,79],[255,0,191],[255,170,234],[189,0,141],[189,126,173],[129,0,96],[129,86,118],[104,0,78],[104,69,95],[79,0,59],[79,53,73],[255,0,127],[255,170,212],[189,0,94],[189,126,157],[129,0,64],[129,86,107],[104,0,52],[104,69,86],[79,0,39],[79,53,66],[255,0,63],[255,170,191],[189,0,46],[189,126,141],[129,0,31],[129,86,96],[104,0,25],[104,69,78],[79,0,19],[79,53,59],[51,51,51],[80,80,80],[105,105,105],[130,130,130],[190,190,190],[255,255,255]],vx=(i,t)=>{const e=i[t.layer];if(e){const r="colorNumber"in t&&t.colorNumber!==256?t.colorNumber:e.colorNumber,n=Ma[r];return n||[0,0,0]}else return Rt.warn("no layer table for layer:"+t.layer),[0,0,0]},Aa=(i,t)=>({x:i.x*Math.cos(t)-i.y*Math.sin(t),y:i.y*Math.cos(t)+i.x*Math.sin(t)}),Mx=i=>i[0]===255&&i[1]===255&&i[2]===255?"rgb(0, 0, 0)":`rgb(${i[0]}, ${i[1]}, ${i[2]})`,Ax=(i,t,e,s)=>{const r=e,n=t,a=t.length;let o=0,h=!1;for(let f=0;f<a+i;f++)if(s>r[f]&&s<=r[f+1]){o=f,h=!0;break}if(!h)throw new Error("invalid new knot");const c=[];for(let f=0;f<a+i+1;f++)f<=o?c[f]=r[f]:f===o+1?c[f]=s:c[f]=r[f-1];let l;const u=[];for(let f=0;f<a+1;f++)f<=o-i+1?l=1:o-i+2<=f&&f<=o?r[f+i-1]-r[f]===0?l=0:l=(s-r[f])/(r[f+i-1]-r[f]):l=0,l===0?u[f]=n[f-1]:l===1?u[f]=n[f]:u[f]={x:(1-l)*n[f-1].x+l*n[f].x,y:(1-l)*n[f-1].y+l*n[f].y};return{controlPoints:u,knots:c}},Sx=(i,t)=>{for(let e=1;e<i;++e)if(t[e]!==t[0])throw Error(`not pinned. order: ${i} knots: ${t}`);for(let e=t.length-2;e>t.length-i-1;--e)if(t[e]!==t[t.length-1])throw Error(`not pinned. order: ${i} knots: ${t}`)},Sa=(i,t)=>{let e=1;for(let s=t+1;s<i.length&&i[s]===i[t];++s)++e;return e},kx=(i,t)=>{const e=[];let s=i;for(;s<t.length-i;){const r=t[s],n=Sa(t,s);for(let a=0;a<i-n-1;++a)e.push(r);s=s+n}return e},Fx=(i,t,e)=>(Sx(i,e),kx(i,e).reduce((r,n)=>Ax(i,r.controlPoints,r.knots,n),{controlPoints:t,knots:e})),Ge=(i,t,e)=>{let s="";const r=e.map(a=>{const o=a.x||0,h=a.y||0,c=a.scaleX||1,l=a.scaleY||1,u=(a.rotation||0)/180*Math.PI,{cos:f,sin:p}=Math;let d,m,x,y,_,b;return a.extrusionZ===-1?(d=-c*f(u),m=c*p(u),x=l*p(u),y=l*f(u),_=-o,b=h):(d=c*f(u),m=c*p(u),x=-l*p(u),y=l*f(u),_=o,b=h),[d,m,x,y,_,b]});let n=new N.Box2;if(i.valid){let a=[{x:i.min.x,y:i.min.y},{x:i.max.x,y:i.min.y},{x:i.max.x,y:i.max.y},{x:i.min.x,y:i.max.y}];r.forEach(([o,h,c,l,u,f])=>{a=a.map(p=>({x:p.x*o+p.y*c+u,y:p.x*h+p.y*l+f}))}),n=a.reduce((o,h)=>o.expandByPoint(h),new N.Box2)}return r.reverse(),r.forEach(([a,o,h,c,l,u])=>{s+=`<g transform="matrix(${a} ${o} ${h} ${c} ${l} ${u})">`}),s+=t,r.forEach(a=>{s+="</g>"}),{bbox:n,element:s}},Gr=(i,{bbox:t,element:e})=>i.extrusionZ===-1?{bbox:new N.Box2().expandByPoint({x:-t.min.x,y:t.min.y}).expandByPoint({x:-t.max.x,y:t.max.y}),element:`<g transform="matrix(-1 0 0 1 0 0)">
        ${e}
      </g>`}:{bbox:t,element:e},Wr=i=>{const t=va(i),e=t.reduce((r,[n,a])=>r.expandByPoint({x:n,y:a}),new N.Box2),s=t.reduce((r,n,a)=>(r+=a===0?"M":"L",r+=n[0]+","+n[1],r),"");return Ge(e,`<path d="${s}" />`,i.transforms)},Tx=i=>{const t=new N.Box2().expandByPoint({x:i.x+i.r,y:i.y+i.r}).expandByPoint({x:i.x-i.r,y:i.y-i.r}),e=`<circle cx="${i.x}" cy="${i.y}" r="${i.r}" />`,{bbox:s,element:r}=Gr(i,{bbox:t,element:e});return Ge(s,r,i.transforms)},ka=(i,t,e,s,r,n,a,o)=>{const h=Math.sqrt(e*e+s*s),c=r*h,l=-Math.atan2(-s,e),u=Ex(i,t,e,s,r,n,a);if(Math.abs(n-a)<1e-9||Math.abs(n-a+Math.PI*2)<1e-9){const f=`<g transform="rotate(${l/Math.PI*180} ${i}, ${t})">
      <ellipse cx="${i}" cy="${t}" rx="${h}" ry="${c}" />
    </g>`;return{bbox:u,element:f}}else{const f=Aa({x:Math.cos(n)*h,y:Math.sin(n)*c},l),p={x:i+f.x,y:t+f.y},d=Aa({x:Math.cos(a)*h,y:Math.sin(a)*c},l),m={x:i+d.x,y:t+d.y},y=(a<n?a+Math.PI*2:a)-n<Math.PI?0:1,b=`<path d="${`M ${p.x} ${p.y} A ${h} ${c} ${l/Math.PI*180} ${y} 1 ${m.x} ${m.y}`}" />`;return{bbox:u,element:b}}},Ex=(i,t,e,s,r,n,a,o)=>{for(;n<0;)n+=Math.PI*2;for(;a<=n;)a+=Math.PI*2;const h=[];if(Math.abs(e)<1e-12||Math.abs(s)<1e-12)for(let p=0;p<4;p++)h.push(p/2*Math.PI);else h[0]=Math.atan(-s*r/e)-Math.PI,h[1]=Math.atan(e*r/s)-Math.PI,h[2]=h[0]-Math.PI,h[3]=h[1]-Math.PI;for(let p=4;p>=0;p--){for(;h[p]<n;)h[p]+=Math.PI*2;h[p]>a&&h.splice(p,1)}h.push(n),h.push(a);const c=h.map(p=>({x:Math.cos(p),y:Math.sin(p)})),l=[[e,-s*r],[s,e*r]];return c.map(p=>({x:p.x*l[0][0]+p.y*l[0][1]+i,y:p.x*l[1][0]+p.y*l[1][1]+t})).reduce((p,d)=>(p.expandByPoint(d),p),new N.Box2)},Px=i=>{const{bbox:t,element:e}=ka(i.x,i.y,i.majorX,i.majorY,i.axisRatio,i.startAngle,i.endAngle),{bbox:s,element:r}=Gr(i,{bbox:t,element:e});return Ge(s,r,i.transforms)},zx=i=>{const{bbox:t,element:e}=ka(i.x,i.y,i.r,0,1,i.startAngle,i.endAngle,i.extrusionZ===-1),{bbox:s,element:r}=Gr(i,{bbox:t,element:e});return Ge(s,r,i.transforms)},Cx=(i,t,e)=>{const s=[];let r=0,n=i;for(;n<t.length-i+1;){const a=Sa(t,n),o=e.slice(r,r+i);i===4?s.push(`<path d="M ${o[0].x} ${o[0].y} C ${o[1].x} ${o[1].y} ${o[2].x} ${o[2].y} ${o[3].x} ${o[3].y}" />`):i===3&&s.push(`<path d="M ${o[0].x} ${o[0].y} Q ${o[1].x} ${o[1].y} ${o[2].x} ${o[2].y}" />`),r+=a,n+=a}return s},Bx=i=>{let t=new N.Box2;i.controlPoints.forEach(a=>{t=t.expandByPoint(a)});const e=i.degree+1,s=Fx(e,i.controlPoints,i.knots),n=`<g>${Cx(e,s.knots,s.controlPoints).join("")}</g>`;return Ge(t,n,i.transforms)},Dx=i=>{switch(i.type){case"CIRCLE":return Tx(i);case"ELLIPSE":return Px(i);case"ARC":return zx(i);case"SPLINE":{const t=i.weights&&i.weights.some(e=>e!==1);if((i.degree===2||i.degree===3)&&!t)try{return Bx(i)}catch{return Wr(i)}else return Wr(i)}case"LINE":case"LWPOLYLINE":case"POLYLINE":return Wr(i);default:return Rt.warn("entity type not supported in SVG rendering:",i.type),null}},Ix=i=>{const t=qr(i),{bbox:e,elements:s}=t.reduce((n,a,o)=>{const h=vx(i.tables.layers,a),c=Dx(a);if(c){const{bbox:l,element:u}=c;l.valid&&(n.bbox.expandByPoint(l.min),n.bbox.expandByPoint(l.max)),n.elements.push(`<g stroke="${Mx(h)}">${u}</g>`)}return n},{bbox:new N.Box2,elements:[]}),r=e.valid?{x:e.min.x,y:-e.max.y,width:e.max.x-e.min.x,height:e.max.y-e.min.y}:{x:0,y:0,width:0,height:0};return`<?xml version="1.0"?>
<svg
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
  preserveAspectRatio="xMinYMin meet"
  viewBox="${r.x} ${r.y} ${r.width} ${r.height}"
  width="100%" height="100%"
>
  <g stroke="#000000" stroke-width="0.1%" fill="none" transform="matrix(1,0,0,-1,0,0)">
    ${s.join(`
`)}
  </g>
</svg>`},Lx=(i,t)=>(t.forEach(e=>{i=i.map(function(s){let r=[s[0],s[1]];if(e.scaleX&&(r[0]=r[0]*e.scaleX),e.scaleY&&(r[1]=r[1]*e.scaleY),e.rotation){const n=e.rotation/180*Math.PI;r=[r[0]*Math.cos(n)-r[1]*Math.sin(n),r[1]*Math.cos(n)+r[0]*Math.sin(n)]}return e.x&&(r[0]=r[0]+e.x),e.y&&(r[1]=r[1]+e.y),e.extrusionZ===-1&&(r[0]=-r[0]),r})}),i),Ox=i=>{const e=qr(i).map(r=>{const n=i.tables.layers[r.layer];let a;if(n){const o="colorNumber"in r?r.colorNumber:n.colorNumber;a=Ma[o],a===void 0&&(a=[0,0,0])}else Rt.warn("no layer table for layer:"+r.layer),a=[0,0,0];return{rgb:a,vertices:Lx(va(r),r.transforms)}}),s=new N.Box2;return e.forEach(r=>{r.vertices.forEach(n=>{s.expandByPoint({x:n[0],y:n[1]})})}),{bbox:s,polylines:e}},$x=i=>i.reduce((t,e)=>{const s=e.layer;return t[s]||(t[s]=[]),t[s].push(e),t},{});class Rx{constructor(t){if(typeof t!="string")throw Error("Helper constructor expects a DXF string");this._contents=t,this._parsed=null,this._denormalised=null}parse(){return this._parsed=$h(this._contents),Rt.info("parsed:",this.parsed),this._parsed}get parsed(){return this._parsed===null&&this.parse(),this._parsed}denormalise(){return this._denormalised=qr(this.parsed),Rt.info("denormalised:",this._denormalised),this._denormalised}get denormalised(){return this._denormalised||this.denormalise(),this._denormalised}group(){this._groups=$x(this.denormalised)}get groups(){return this._groups||this.group(),this._groups}toSVG(){return Ix(this.parsed)}toPolylines(){return Ox(this.parsed)}}class Nx{constructor(){this._cache={},this.useCache=!0,this.onBeforeTextChanged=null,this.colorHelper=new wr,this.LayerHelper=new Vi}async getFromFile(t,e){let s=URL.createObjectURL(t);return await this.getFromPath(s,e)}async getFromPath(t,e){return await this._loadFont(e),this._font?new Promise(async s=>{let r=this._fromCache(t);if(r){s(this._drawDXF(r.data?r.data:r));return}let n=await fetch(t);if(n.status!==200)return null;let a=await n.text(),o=new Rx(a).parse();this._toCache(t,o),this._lastDXF=o,o.tables.layers=this.LayerHelper.parse(o.tables.layers),this.layers=o.tables.layers,s(await this._drawDXF(o))}):null}async _drawDXF(t){let e=new st;e.name="DXFViewer",this.useCache||(O.cache=!1);let s=new vs(t),r=new Zi(t),n=new Sr(t),a=new Ar(t),o=new Jo(t,this._font),h=new vr(t,this._font),c=new nn(t,this._font),l=new Qi(t,this._font);return O.onBeforeTextDraw=this.onBeforeTextDraw,s=s.draw(t),r=r.draw(t),n=n.draw(t),a=a.draw(t),o=o.draw(t),h=h.draw(t),c=c.draw(t,t),l=l.draw(t),s&&e.add(s),r&&e.add(r),n&&e.add(n),a&&e.add(a),o&&e.add(o),h&&e.add(h),c&&e.add(c),l&&e.add(l),this._rotateByView(e,t),e}_toCache(t,e){this._cache[this._replaceEspecialChars(t)]=e}_fromCache(t){let e=this._cache[this._replaceEspecialChars(t)];return e||null}_replaceEspecialChars(t){return t.replaceAll("/","").replaceAll(".","").replaceAll("_","").replaceAll("-","")}async _loadFont(t){if(!this._font)try{this._font=await new Promise((e,s)=>{new Ro().load(t,e,null,s)})}catch(e){console.log(e),this._font=null}}_writeCount(t,e,s,r,n,a,o){t&&console.log("lines ",t.children.length),e&&console.log("circles ",e.children.length),s&&console.log("splines ",s.children.length),r&&console.log("solids ",r.children.length),n&&console.log("dimensions ",n.children.length),a&&console.log("texts ",a.children.length),o&&console.log("inserts ",o.children.length)}_rotateByView(t,e){let s=e.objects&&e.objects.layouts?e.objects.layouts.find(n=>n.name.toLowerCase()==="model"):null;if(!s)return;let r=Object.keys(e.tables.vports);for(let n=0;n<r.length;n++){let a=e.tables.vports[r[n]];if(a.handle===s.lastActiveViewport&&a.angle!==0){t.rotateOnAxis(new g(0,0,1),a.angle*Math.PI/180);return}}}}class Fa{constructor(){this.snaps=[],this.min=new g(1/0,1/0,1/0),this.max=new g(-1/0,-1/0,-1/0),this.cuts=5,this.voxel=null,this.decimals=6}process(t){t=t instanceof Array?t:[t],this._getSnaps(t,!0,!1),this._getSize(t),this.voxel=this._generateVoxels(this.min,this.max,1)[0],this.snaps.forEach(e=>this._addPointToVoxel(e,this.voxel.voxels))}findVoxel(t,e=null){let s={x:Number(t.x.toFixed(this.decimals)),y:Number(t.y.toFixed(this.decimals)),z:Number(t.z.toFixed(this.decimals))};e=e||this.voxel.voxels;for(let r=0;r<e.length;r++){let n=e[r];if(n.min.x<=s.x&&s.x<=n.max.x&&n.min.y<=s.y&&s.y<=n.max.y&&n.min.z<=s.z&&s.z<=n.max.z)return n.voxels.length>0?this.findVoxel(t,n.voxels):n}return null}_getSnaps(t,e=!0,s=!0){for(let r=0;r<t.length;r++)t[r].traverse(a=>{if(e&&(a.isLine||a.isLineSegments)){a.updateWorldMatrix(!0,!1),this.snaps.push({entity:a,point:new g(a.geometry.attributes.position.getX(0),a.geometry.attributes.position.getY(0),a.geometry.attributes.position.getZ(0)).applyMatrix4(a.matrixWorld)});let o=a.geometry.attributes.position.count-1;this.snaps.push({entity:a,point:new g(a.geometry.attributes.position.getX(o),a.geometry.attributes.position.getY(o),a.geometry.attributes.position.getZ(o)).applyMatrix4(a.matrixWorld)})}if(s&&a.isMesh){a.updateWorldMatrix(!0,!1);for(let o=0;o<a.geometry.attributes.position.count;o++)this.snaps.push({entity:a,point:new g(a.geometry.attributes.position.getX(o),a.geometry.attributes.position.getY(o),a.geometry.attributes.position.getZ(o)).applyMatrix4(a.matrixWorld)})}})}_generateVoxels(t,e,s){if(s===this.cuts)return[];let r=[],n=e.clone().sub(t).multiplyScalar(1/s);for(let a=0;a<s;a++)for(let o=0;o<s;o++)for(let h=0;h<s;h++){let c={name:"VOXEL_"+a+"_"+o+"_"+h,min:new g(t.x+a*n.x,t.y+o*n.y,t.z+h*n.z),max:new g(t.x+(a+1)*n.x,t.y+(o+1)*n.y,t.z+(h+1)*n.z),snaps:[]};c.voxels=this._generateVoxels(c.min,c.max,s+1),r.push(c)}return r}_addPointToVoxel(t,e){for(let s=0;s<e.length;s++){let r=e[s];if(r.min.x<=t.point.x&&t.point.x<=r.max.x&&r.min.y<=t.point.y&&t.point.y<=r.max.y&&r.min.z<=t.point.z&&t.point.z<=r.max.z){r.voxels.length===0?r.snaps.push(t):this._addPointToVoxel(t,r.voxels);return}}}_getSize(t){t.forEach(e=>{let s=new bt().setFromObject(e);this.min.set(Math.min(this.min.x,s.min.x),Math.min(this.min.y,s.min.y),Math.min(this.min.z,s.min.z)),this.max.set(Math.max(this.max.x,s.max.x),Math.max(this.max.y,s.max.y),Math.max(this.max.z,s.max.z))})}clear(){this.snaps.length=0,this.min=null,this.max=null,this.voxel=null}}class Hx{constructor(t,e,s,r,n){this.container=e.domElement,this.scene=s,this.camera=r,this.controls=n,this.snaps=new Fa,this.snaps.process(t),this._mouseDownEvent=a=>{this._mouseDown(a)},this._mouseUpEvent=a=>{this._mouseUp(a)},this._mouseMoveEvent=a=>{this._mouseMove(a)},this.container.addEventListener("pointerdown",this._mouseDownEvent),this.container.addEventListener("pointerup",this._mouseUpEvent),this.container.addEventListener("pointermove",this._mouseMoveEvent),this.raycaster=new $i,this.mouse=new k,this.plane=new Qa,this.planeNormal=new g,this.mousePos=new g,this.vectorHelper=new g,document.addEventListener("wheel",()=>{this._changeSquareSize=!0})}_mouseDown(){}_mouseUp(){}_mouseMove(t){if(this.snaps){t.mousePosInScene=this._getMousePosInScene(t);let e={x:t.mousePosInScene.x,y:t.mousePosInScene.y,z:t.mousePosInScene.z},s=this.snaps.findVoxel(e);if(s){let r=this._findNearestSnapPoint(e,s);if(!r.snap){this._hideSnapSquare();return}r.distance<5?(t.mousePosInScene={x:r.snap.point.x,y:r.snap.point.y,z:r.snap.point.z},this._showSnapSquare(r)):this._hideSnapSquare()}}}resetSnaps(){this._clearSnapSquare(),this.snaps=new Fa,this.snaps.process(this.__cache.meshes)}_findNearestSnapPoint(t,e){let s={snap:null,distance:1/0};for(let r=0;r<e.snaps.length;r++){const n=e.snaps[r];let a=n.point.distanceTo(t);a<s.distance&&(s.snap=n,s.distance=a)}return s}_hideSnapSquare(){this._snapSquare&&(this._snapSquare.visible=!1)}_showSnapSquare(t){if(!this._snapSquare||this._changeSquareSize){this._clearSnapSquare();let e=this._getSize();this._snapSquare=new kt(new nr(e,e,e),new Pe({color:16753920,wireframe:!0})),this._snapSquare.visible=!1,this._snapSquare.initial=!0,this.scene.add(this._snapSquare)}this._snapSquare.position.copy(t.snap.point),this._snapSquare.visible=!0,console.log(`distance from Mouse: ${t.distance}, 3d entity: ${t.snap.entity.uuid}, DXF entity: ${t.snap.entity.userData.handle}`)}_getSize(){const t={width:this.camera.right/this.camera.zoom-this.camera.left/this.camera.zoom,height:this.camera.top/this.camera.zoom-this.camera.bottom/this.camera.zoom};return delete this._changeSquareSize,Math.max(t.width,t.height)/100}_getMousePosInScene(t){let e=t.currentTarget,s=this.camera.position.distanceTo(this.controls.target);this.mouse.x=t.offsetX/e.offsetWidth*2-1,this.mouse.y=-(t.offsetY/e.offsetHeight)*2+1,this.planeNormal.copy(this.camera.getWorldDirection(this.vectorHelper));let r=this.camera.position.clone();return r.add(this.planeNormal.multiplyScalar(s)),this.plane.setFromNormalAndCoplanarPoint(this.planeNormal,r),this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.mousePos),this.mousePos}clear(){this._clearSnapSquare(),this.snaps.clear(),this.container.removeEventListener("pointerdown",this._mouseDownEvent),this.container.removeEventListener("pointerup",this._mouseUpEvent),this.container.removeEventListener("pointermove",this._mouseMoveEvent),this.snaps=null,this.container=null,this.scene=null,this.camera=null,this.controls=null,this.raycaster=null,this.mouse=null,this.plane=null,this.planeNormal=null,this.mousePos=null,this.vectorHelper=null}_clearSnapSquare(){this._snapSquare&&(this._snapSquare.parent&&this._snapSquare.parent.remove(this._snapSquare),this._snapSquare.geometry.dispose(),this._snapSquare.material.dispose(),this._snapSquare=null)}}class Vx{constructor(t,e,s){this.camera=e,this.container=t,this.raycaster=new $i,this._calculateThreshold(),this.targets=s,this.container.addEventListener("wheel",()=>{this._calculateThreshold()})}raycast(t){this.raycaster.setFromCamera(t,this.camera);const e=this.raycaster.intersectObjects(this.targets,!0);return e.length===0?null:e[0]}_calculateThreshold(){const t={width:this.camera.right/this.camera.zoom-this.camera.left/this.camera.zoom,height:this.camera.top/this.camera.zoom-this.camera.bottom/this.camera.zoom},e=Math.min(t.width,t.height);this.raycaster.params.Line.threshold=e/500}}class jx{constructor(){this.callbacks=[]}subscribe(t,e){const s=this.callbacks.find(r=>r.name===t);typeof s<"u"?s.callbacks.push(e):this.callbacks.push({name:t,callbacks:[e]})}unSubscribe(t,e){const s=this.callbacks.find(r=>r.name===t);if(typeof s<"u"){let r=s.callbacks.indexOf(e);r>-1&&s.callbacks.splice(r,1),s.callbacks.length===0&&(r=this.callbacks.indexOf(s),r>-1&&this.callbacks.splice(r,1))}}hasSubscribers(t){return typeof this.callbacks.find(s=>s.name===t)<"u"}async trigger(t,...e){const s=this.callbacks.find(r=>r.name===t);if(typeof s<"u")for(const r of s.callbacks)r&&r.constructor.name==="AsyncFunction"?await r(...e):r(...e)}}class Ta extends jx{constructor(){super()}_initRaycasting(t,e,s,r){const n=[];s.traverse(a=>{a.geometry&&n.push(a)}),this.pointer=new k,this.raycast=r||new Vx(t,e,n)}_clone(t){const e={};t.traverse(r=>{e[r.uuid]=r.userData,r.userData=null});const s=t.clone();return t.traverse(r=>{r.userData=e[r.uuid]}),s}_setMaterial(t){this._material=new Pe({depthTest:!1,depthWrite:!1}),this._material.color.setHex(t),this._material.color.convertSRGBToLinear()}}class qx extends Ta{constructor(t,e,s,r=null){super(),this.container=t,this._clonedObjects={},this._initRaycasting(t,e,s,r),this._setMaterial(16753920),this.container.addEventListener("pointermove",async n=>await this._onPointerMove(n),!1)}async _onPointerMove(t){t.preventDefault();var e=t.target.getBoundingClientRect();const s=t.clientX-e.left,r=t.clientY-e.top;this.pointer.x=s/this.container.clientWidth*2-1,this.pointer.y=-(r/this.container.clientHeight)*2+1;const n=this.raycast.raycast(this.pointer);if(this.removeHover(),n){const a=n.object.parent;if(!a.userData)return;this.hover(a),await this.trigger("hover",a)}}hover(t,e=null){this._clonedObjects[t.uuid]||(this._clonedObjects[t.uuid]={clone:this._clone(t),parent:t.parent});const s=this._clonedObjects[t.uuid];s.clone.hovered=!0,s.clone.traverse(r=>{r.material&&(r.material=e||this._material)}),this._hovered=s.clone,s.parent.add(this._hovered)}removeHover(){this._hovered&&this._hovered.parent&&(this._hovered.parent.remove(this._hovered),this._hovered=null)}}class Ux extends Ta{constructor(t,e,s,r=null){super(),this.container=t,this.camera=e,this.dxf=s,this._initRaycasting(t,e,s,r),this._setMaterial(255),this.selecteds=[],this._boxHelpers={start3dpoint:new g,end3dpoint:new g,boxMin:new g,boxMax:new g},this._isMouseDown=!1,this._isMouseMoving=!1,this.container.addEventListener("pointerdown",async n=>await this._onPointerDown(n),!1),this.container.addEventListener("pointerup",async n=>await this._onPointerUp(n),!1),this.container.addEventListener("pointermove",async n=>await this._onPointerMove(n),!1)}async _onPointerDown(t){if(t.button===0&&(this._isMouseDown=!0,t.ctrlKey)){var e=t.target.getBoundingClientRect();const s=t.clientX-e.left,r=t.clientY-e.top;this._onSelectionBox={start:{x:s,y:r},end:{x:s,y:r}}}}async _onPointerUp(t){if(this._isMouseDown=!1,this._isMouseMoving){this._isMouseMoving=!1;return}if(t.button!==0)return;t.preventDefault(),this.deselectAll();let e=null;if(this._onSelectionBox){const r=this._getEntitiesUnderSelectionBox(this._onSelectionBox.start,this._onSelectionBox.end);r&&(e=r)}else{var s=t.target.getBoundingClientRect();const r=t.clientX-s.left,n=t.clientY-s.top;this.pointer.x=r/this.container.clientWidth*2-1,this.pointer.y=-(n/this.container.clientHeight)*2+1;const a=await this.raycast.raycast(this.pointer);a&&(e=a.object.parent)}e&&(this.select(e),await this.trigger("select",e)),this._removeSelectionBox(),this._onSelectionBox=null}async _onPointerMove(t){if(this._onSelectionBox){var e=t.target.getBoundingClientRect();const s=t.clientX-e.left,r=t.clientY-e.top;this._onSelectionBox.end={x:s,y:r},this.drawSelectionBox(this._onSelectionBox.start,this._onSelectionBox.end,e);return}else this._isMouseDown&&(this._isMouseMoving=!0)}drawSelectionBox(t,e,s){this._removeSelectionBox();const r=Math.max(t.x,e.x)-Math.min(t.x,e.x),n=Math.max(t.y,e.y)-Math.min(t.y,e.y);this._selectionBox=document.createElement("div"),this._selectionBox.style.position="absolute",this._selectionBox.style.border="1px solid white",this._selectionBox.style.left=Math.min(t.x,e.x)+s.left+"px",this._selectionBox.style.top=Math.min(t.y,e.y)+s.top+"px",this._selectionBox.style.width=r+"px",this._selectionBox.style.height=n+"px",this._selectionBox.style.pointerEvents="none",this._selectionBox.style.background="blue",this._selectionBox.style.opacity=.25,document.body.appendChild(this._selectionBox)}_removeSelectionBox(){this._selectionBox&&(document.body.removeChild(this._selectionBox),this._selectionBox=null)}_getEntitiesUnderSelectionBox(t,e){t.x=t.x/this.container.clientWidth*2-1,t.y=-(t.y/this.container.clientHeight)*2+1,e.x=e.x/this.container.clientWidth*2-1,e.y=-(e.y/this.container.clientHeight)*2+1,this._boxHelpers.start3dpoint=new g(t.x,t.y,0).unproject(this.camera),this._boxHelpers.end3dpoint=new g(e.x,e.y,0).unproject(this.camera),this._boxHelpers.boxMin.set(Math.min(this._boxHelpers.start3dpoint.x,this._boxHelpers.end3dpoint.x),Math.min(this._boxHelpers.start3dpoint.y,this._boxHelpers.end3dpoint.y),0),this._boxHelpers.boxMax.set(Math.max(this._boxHelpers.start3dpoint.x,this._boxHelpers.end3dpoint.x),Math.max(this._boxHelpers.start3dpoint.y,this._boxHelpers.end3dpoint.y),0);const s=new bt(this._boxHelpers.boxMin,this._boxHelpers.boxMax),r=this._getBlocksUnderBox(s,this.dxf);return r.length>0?r:null}_getBlocksUnderBox(t,e){const s=[];if(!e||!e.children)return s;if(e.name!==""&&this._fitInsideBox(t,e))s.push(e);else for(let r=0;r<e.children.length;r++){const n=e.children[r],a=this._getBlocksUnderBox(t,n);a.length>0&&s.push(...a)}return s}_fitInsideBox(t,e){let s=new bt().setFromObject(e);return t.containsBox(s)}select(t,e=null){(t instanceof Array?t:[t]).forEach(r=>{const n=this._clone(r);n.selected=!0,n.traverse(a=>{a.material&&(a.material=e||this._material)}),r.parent.add(n),this.selecteds.push(n)})}deselectAll(){this.selecteds&&(this.selecteds.forEach(t=>t.parent.remove(t)),this.selecteds.length=0)}}j.DXFViewer=Nx,j.Hover=qx,j.Merger=sn,j.Select=Ux,j.SnapsHelper=Hx,Object.defineProperty(j,Symbol.toStringTag,{value:"Module"})});
